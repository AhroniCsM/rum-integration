{"ast":null,"code":"import { __rest } from \"tslib\";\nimport { isObject } from './utils/object';\nexport function processBeforeSend(cxSpan, options) {\n  if (!(options === null || options === void 0 ? void 0 : options.beforeSend)) {\n    return cxSpan;\n  }\n  const cxRumEvent = cxSpan.text.cx_rum;\n  const editableCxRumEvent = cxRumEventToEditable(cxRumEvent);\n  const beforeSendResult = options.beforeSend(editableCxRumEvent);\n  if (!validateBeforeSendResult(beforeSendResult)) {\n    return null;\n  }\n  const {\n    version_metadata: {\n      app_name: applicationName\n    },\n    event_context: {\n      severity\n    }\n  } = beforeSendResult;\n  return Object.assign(Object.assign({}, cxSpan), {\n    applicationName,\n    severity,\n    text: {\n      cx_rum: editableToCxRumEvent(beforeSendResult, cxRumEvent)\n    }\n  });\n}\nfunction validateBeforeSendResult(beforeSendResult) {\n  if (beforeSendResult == null) return null;\n  const requiredKeys = ['version_metadata', 'session_context', 'page_context', 'event_context'];\n  const isMissingRequiredKey = () => requiredKeys.some(key => !(beforeSendResult === null || beforeSendResult === void 0 ? void 0 : beforeSendResult[key]));\n  if (!isObject(beforeSendResult) || isMissingRequiredKey()) {\n    console.warn('CoralogixRum: beforeSend must return null, undefined or a valid event.');\n    return null;\n  }\n  return beforeSendResult;\n}\nfunction cxRumEventToEditable(cxRumEvent) {\n  const {\n      session_context: {\n        user_id,\n        user_name,\n        user_email,\n        user_metadata\n      },\n      browser_sdk,\n      timestamp\n    } = cxRumEvent,\n    rest = __rest(cxRumEvent, [\"session_context\", \"browser_sdk\", \"timestamp\"]);\n  return Object.assign(Object.assign({}, rest), {\n    session_context: {\n      user_id,\n      user_email,\n      user_name,\n      user_metadata\n    }\n  });\n}\nfunction editableToCxRumEvent(editable, cxRumEvent) {\n  return Object.assign(Object.assign(Object.assign({}, cxRumEvent), editable), {\n    session_context: Object.assign(Object.assign({}, cxRumEvent.session_context), editable.session_context)\n  });\n}","map":{"version":3,"names":["isObject","processBeforeSend","cxSpan","options","beforeSend","cxRumEvent","text","cx_rum","editableCxRumEvent","cxRumEventToEditable","beforeSendResult","validateBeforeSendResult","version_metadata","app_name","applicationName","event_context","severity","Object","assign","editableToCxRumEvent","requiredKeys","isMissingRequiredKey","some","key","console","warn","session_context","user_id","user_name","user_email","user_metadata","browser_sdk","timestamp","rest","__rest","editable"],"sources":["../../../../libs/browser/src/before-send.ts"],"sourcesContent":[null],"mappings":";AAOA,SAASA,QAAQ,QAAQ,gBAAgB;AAEzC,OAAM,SAAUC,iBAAiBA,CAC/BC,MAAc,EACdC,OAAkC;EAElC,IAAI,EAACA,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEC,UAAU,GAAE;IACxB,OAAOF,MAAM;;EAGf,MAAMG,UAAU,GAAGH,MAAM,CAACI,IAAI,CAACC,MAAM;EACrC,MAAMC,kBAAkB,GAAGC,oBAAoB,CAACJ,UAAU,CAAC;EAC3D,MAAMK,gBAAgB,GAAGP,OAAO,CAACC,UAAU,CAACI,kBAAkB,CAAC;EAE/D,IAAI,CAACG,wBAAwB,CAACD,gBAAgB,CAAC,EAAE;IAC/C,OAAO,IAAI;;EAGb,MAAM;IACJE,gBAAgB,EAAE;MAAEC,QAAQ,EAAEC;IAAe,CAAE;IAC/CC,aAAa,EAAE;MAAEC;IAAQ;EAAE,CAC5B,GAAGN,gBAAiB;EAErB,OAAAO,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAC,MAAA,KACKhB,MAAM;IACTY,eAAe;IACfE,QAAQ;IACRV,IAAI,EAAE;MAAEC,MAAM,EAAEY,oBAAoB,CAACT,gBAAiB,EAAEL,UAAU;IAAC;EAAE;AAEzE;AAEA,SAASM,wBAAwBA,CAC/BD,gBAAkC;EAElC,IAAIA,gBAAgB,IAAI,IAAI,EAAE,OAAO,IAAI;EAEzC,MAAMU,YAAY,GAA6C,CAC7D,kBAAkB,EAClB,iBAAiB,EACjB,cAAc,EACd,eAAe,CAChB;EAED,MAAMC,oBAAoB,GAAGA,CAAA,KAC3BD,YAAY,CAACE,IAAI,CAAEC,GAAG,IAAK,EAACb,gBAAgB,aAAhBA,gBAAgB,uBAAhBA,gBAAgB,CAAGa,GAAG,CAAC,EAAC;EAEtD,IAAI,CAACvB,QAAQ,CAACU,gBAAgB,CAAC,IAAIW,oBAAoB,EAAE,EAAE;IACzDG,OAAO,CAACC,IAAI,CACV,wEAAwE,CACzE;IACD,OAAO,IAAI;;EAGb,OAAOf,gBAAgB;AACzB;AAEA,SAASD,oBAAoBA,CAACJ,UAAsB;EAClD,MAAM;MACJqB,eAAe,EAAE;QAAEC,OAAO;QAAEC,SAAS;QAAEC,UAAU;QAAEC;MAAa,CAAE;MAClEC,WAAW;MACXC;IAAS,IAEP3B,UAAU;IADT4B,IAAI,GAAAC,MAAA,CACL7B,UAAU,EALR,+CAKL,CAAa;EAEd,OAAAY,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAC,MAAA,KACKe,IAAI;IACPP,eAAe,EAAE;MAAEC,OAAO;MAAEE,UAAU;MAAED,SAAS;MAAEE;IAAa;EAAE;AAEtE;AAEA,SAASX,oBAAoBA,CAC3BgB,QAA4B,EAC5B9B,UAAsB;EAEtB,OAAAY,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAC,MAAA,KACKb,UAAU,GACV8B,QAAQ;IACXT,eAAe,EAAAT,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAC,MAAA,KACVb,UAAU,CAACqB,eAAe,GAC1BS,QAAQ,CAACT,eAAe;EAAA;AAGjC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}