{"ast":null,"code":"/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar _a;\nimport * as api from '@opentelemetry/api';\nimport { isWrapped, InstrumentationBase, safeExecuteInTheMiddle } from '@opentelemetry/instrumentation';\nimport * as core from '@opentelemetry/core';\nimport * as web from '@opentelemetry/sdk-trace-web';\nimport { AttributeNames } from './enums/AttributeNames';\nimport { SEMATTRS_HTTP_STATUS_CODE, SEMATTRS_HTTP_HOST, SEMATTRS_HTTP_USER_AGENT, SEMATTRS_HTTP_SCHEME, SEMATTRS_HTTP_URL, SEMATTRS_HTTP_METHOD } from '@opentelemetry/semantic-conventions';\nimport { VERSION } from './version';\nimport { _globalThis } from '@opentelemetry/core';\n// how long to wait for observer to collect information about resources\n// this is needed as event \"load\" is called before observer\n// hard to say how long it should really wait, seems like 300ms is\n// safe enough\nvar OBSERVER_WAIT_TIME_MS = 300;\nvar isNode = typeof process === 'object' && ((_a = process.release) === null || _a === void 0 ? void 0 : _a.name) === 'node';\n/**\n * This class represents a fetch plugin for auto instrumentation\n */\nvar FetchInstrumentation = /** @class */function (_super) {\n  __extends(FetchInstrumentation, _super);\n  function FetchInstrumentation(config) {\n    if (config === void 0) {\n      config = {};\n    }\n    var _this = _super.call(this, '@opentelemetry/instrumentation-fetch', VERSION, config) || this;\n    _this.component = 'fetch';\n    _this.version = VERSION;\n    _this.moduleName = _this.component;\n    _this._usedResources = new WeakSet();\n    _this._tasksCount = 0;\n    return _this;\n  }\n  FetchInstrumentation.prototype.init = function () {};\n  /**\n   * Add cors pre flight child span\n   * @param span\n   * @param corsPreFlightRequest\n   */\n  FetchInstrumentation.prototype._addChildSpan = function (span, corsPreFlightRequest) {\n    var childSpan = this.tracer.startSpan('CORS Preflight', {\n      startTime: corsPreFlightRequest[web.PerformanceTimingNames.FETCH_START]\n    }, api.trace.setSpan(api.context.active(), span));\n    if (!this.getConfig().ignoreNetworkEvents) {\n      web.addSpanNetworkEvents(childSpan, corsPreFlightRequest);\n    }\n    childSpan.end(corsPreFlightRequest[web.PerformanceTimingNames.RESPONSE_END]);\n  };\n  /**\n   * Adds more attributes to span just before ending it\n   * @param span\n   * @param response\n   */\n  FetchInstrumentation.prototype._addFinalSpanAttributes = function (span, response) {\n    var parsedUrl = web.parseUrl(response.url);\n    span.setAttribute(SEMATTRS_HTTP_STATUS_CODE, response.status);\n    if (response.statusText != null) {\n      span.setAttribute(AttributeNames.HTTP_STATUS_TEXT, response.statusText);\n    }\n    span.setAttribute(SEMATTRS_HTTP_HOST, parsedUrl.host);\n    span.setAttribute(SEMATTRS_HTTP_SCHEME, parsedUrl.protocol.replace(':', ''));\n    if (typeof navigator !== 'undefined') {\n      span.setAttribute(SEMATTRS_HTTP_USER_AGENT, navigator.userAgent);\n    }\n  };\n  /**\n   * Add headers\n   * @param options\n   * @param spanUrl\n   */\n  FetchInstrumentation.prototype._addHeaders = function (options, spanUrl) {\n    if (!web.shouldPropagateTraceHeaders(spanUrl, this.getConfig().propagateTraceHeaderCorsUrls)) {\n      var headers = {};\n      api.propagation.inject(api.context.active(), headers);\n      if (Object.keys(headers).length > 0) {\n        this._diag.debug('headers inject skipped due to CORS policy');\n      }\n      return;\n    }\n    if (options instanceof Request) {\n      api.propagation.inject(api.context.active(), options.headers, {\n        set: function (h, k, v) {\n          return h.set(k, typeof v === 'string' ? v : String(v));\n        }\n      });\n    } else if (options.headers instanceof Headers) {\n      api.propagation.inject(api.context.active(), options.headers, {\n        set: function (h, k, v) {\n          return h.set(k, typeof v === 'string' ? v : String(v));\n        }\n      });\n    } else if (options.headers instanceof Map) {\n      api.propagation.inject(api.context.active(), options.headers, {\n        set: function (h, k, v) {\n          return h.set(k, typeof v === 'string' ? v : String(v));\n        }\n      });\n    } else {\n      var headers = {};\n      api.propagation.inject(api.context.active(), headers);\n      options.headers = Object.assign({}, headers, options.headers || {});\n    }\n  };\n  /**\n   * Clears the resource timings and all resources assigned with spans\n   *     when {@link FetchPluginConfig.clearTimingResources} is\n   *     set to true (default false)\n   * @private\n   */\n  FetchInstrumentation.prototype._clearResources = function () {\n    if (this._tasksCount === 0 && this.getConfig().clearTimingResources) {\n      performance.clearResourceTimings();\n      this._usedResources = new WeakSet();\n    }\n  };\n  /**\n   * Creates a new span\n   * @param url\n   * @param options\n   */\n  FetchInstrumentation.prototype._createSpan = function (url, options) {\n    var _a;\n    if (options === void 0) {\n      options = {};\n    }\n    if (core.isUrlIgnored(url, this.getConfig().ignoreUrls)) {\n      this._diag.debug('ignoring span as url matches ignored url');\n      return;\n    }\n    var method = (options.method || 'GET').toUpperCase();\n    var spanName = \"HTTP \" + method;\n    return this.tracer.startSpan(spanName, {\n      kind: api.SpanKind.CLIENT,\n      attributes: (_a = {}, _a[AttributeNames.COMPONENT] = this.moduleName, _a[SEMATTRS_HTTP_METHOD] = method, _a[SEMATTRS_HTTP_URL] = url, _a)\n    });\n  };\n  /**\n   * Finds appropriate resource and add network events to the span\n   * @param span\n   * @param resourcesObserver\n   * @param endTime\n   */\n  FetchInstrumentation.prototype._findResourceAndAddNetworkEvents = function (span, resourcesObserver, endTime) {\n    var resources = resourcesObserver.entries;\n    if (!resources.length) {\n      if (!performance.getEntriesByType) {\n        return;\n      }\n      // fallback - either Observer is not available or it took longer\n      // then OBSERVER_WAIT_TIME_MS and observer didn't collect enough\n      // information\n      resources = performance.getEntriesByType('resource');\n    }\n    var resource = web.getResource(resourcesObserver.spanUrl, resourcesObserver.startTime, endTime, resources, this._usedResources, 'fetch');\n    if (resource.mainRequest) {\n      var mainRequest = resource.mainRequest;\n      this._markResourceAsUsed(mainRequest);\n      var corsPreFlightRequest = resource.corsPreFlightRequest;\n      if (corsPreFlightRequest) {\n        this._addChildSpan(span, corsPreFlightRequest);\n        this._markResourceAsUsed(corsPreFlightRequest);\n      }\n      if (!this.getConfig().ignoreNetworkEvents) {\n        web.addSpanNetworkEvents(span, mainRequest);\n      }\n    }\n  };\n  /**\n   * Marks certain [resource]{@link PerformanceResourceTiming} when information\n   * from this is used to add events to span.\n   * This is done to avoid reusing the same resource again for next span\n   * @param resource\n   */\n  FetchInstrumentation.prototype._markResourceAsUsed = function (resource) {\n    this._usedResources.add(resource);\n  };\n  /**\n   * Finish span, add attributes, network events etc.\n   * @param span\n   * @param spanData\n   * @param response\n   */\n  FetchInstrumentation.prototype._endSpan = function (span, spanData, response) {\n    var _this = this;\n    var endTime = core.millisToHrTime(Date.now());\n    var performanceEndTime = core.hrTime();\n    this._addFinalSpanAttributes(span, response);\n    setTimeout(function () {\n      var _a;\n      (_a = spanData.observer) === null || _a === void 0 ? void 0 : _a.disconnect();\n      _this._findResourceAndAddNetworkEvents(span, spanData, performanceEndTime);\n      _this._tasksCount--;\n      _this._clearResources();\n      span.end(endTime);\n    }, OBSERVER_WAIT_TIME_MS);\n  };\n  /**\n   * Patches the constructor of fetch\n   */\n  FetchInstrumentation.prototype._patchConstructor = function () {\n    var _this = this;\n    return function (original) {\n      var plugin = _this;\n      return function patchConstructor() {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        var self = this;\n        var url = web.parseUrl(args[0] instanceof Request ? args[0].url : String(args[0])).href;\n        var options = args[0] instanceof Request ? args[0] : args[1] || {};\n        var createdSpan = plugin._createSpan(url, options);\n        if (!createdSpan) {\n          return original.apply(this, args);\n        }\n        var spanData = plugin._prepareSpanData(url);\n        function endSpanOnError(span, error) {\n          plugin._applyAttributesAfterFetch(span, options, error);\n          plugin._endSpan(span, spanData, {\n            status: error.status || 0,\n            statusText: error.message,\n            url: url\n          });\n        }\n        function endSpanOnSuccess(span, response) {\n          plugin._applyAttributesAfterFetch(span, options, response);\n          if (response.status >= 200 && response.status < 400) {\n            plugin._endSpan(span, spanData, response);\n          } else {\n            plugin._endSpan(span, spanData, {\n              status: response.status,\n              statusText: response.statusText,\n              url: url\n            });\n          }\n        }\n        function onSuccess(span, resolve, response) {\n          try {\n            var resClone = response.clone();\n            var resClone4Hook_1 = response.clone();\n            var body = resClone.body;\n            if (body) {\n              var reader_1 = body.getReader();\n              var read_1 = function () {\n                reader_1.read().then(function (_a) {\n                  var done = _a.done;\n                  if (done) {\n                    endSpanOnSuccess(span, resClone4Hook_1);\n                  } else {\n                    read_1();\n                  }\n                }, function (error) {\n                  endSpanOnError(span, error);\n                });\n              };\n              read_1();\n            } else {\n              // some older browsers don't have .body implemented\n              endSpanOnSuccess(span, response);\n            }\n          } finally {\n            resolve(response);\n          }\n        }\n        function onError(span, reject, error) {\n          try {\n            endSpanOnError(span, error);\n          } finally {\n            reject(error);\n          }\n        }\n        return new Promise(function (resolve, reject) {\n          return api.context.with(api.trace.setSpan(api.context.active(), createdSpan), function () {\n            plugin._addHeaders(options, url);\n            plugin._tasksCount++;\n            // TypeScript complains about arrow function captured a this typed as globalThis\n            // ts(7041)\n            return original.apply(self, options instanceof Request ? [options] : [url, options]).then(onSuccess.bind(self, createdSpan, resolve), onError.bind(self, createdSpan, reject));\n          });\n        });\n      };\n    };\n  };\n  FetchInstrumentation.prototype._applyAttributesAfterFetch = function (span, request, result) {\n    var _this = this;\n    var applyCustomAttributesOnSpan = this.getConfig().applyCustomAttributesOnSpan;\n    if (applyCustomAttributesOnSpan) {\n      safeExecuteInTheMiddle(function () {\n        return applyCustomAttributesOnSpan(span, request, result);\n      }, function (error) {\n        if (!error) {\n          return;\n        }\n        _this._diag.error('applyCustomAttributesOnSpan', error);\n      }, true);\n    }\n  };\n  /**\n   * Prepares a span data - needed later for matching appropriate network\n   *     resources\n   * @param spanUrl\n   */\n  FetchInstrumentation.prototype._prepareSpanData = function (spanUrl) {\n    var startTime = core.hrTime();\n    var entries = [];\n    if (typeof PerformanceObserver !== 'function') {\n      return {\n        entries: entries,\n        startTime: startTime,\n        spanUrl: spanUrl\n      };\n    }\n    var observer = new PerformanceObserver(function (list) {\n      var perfObsEntries = list.getEntries();\n      perfObsEntries.forEach(function (entry) {\n        if (entry.initiatorType === 'fetch' && entry.name === spanUrl) {\n          entries.push(entry);\n        }\n      });\n    });\n    observer.observe({\n      entryTypes: ['resource']\n    });\n    return {\n      entries: entries,\n      observer: observer,\n      startTime: startTime,\n      spanUrl: spanUrl\n    };\n  };\n  /**\n   * implements enable function\n   */\n  FetchInstrumentation.prototype.enable = function () {\n    if (isNode) {\n      // Node.js v18+ *does* have a global `fetch()`, but this package does not\n      // support instrumenting it.\n      this._diag.warn(\"this instrumentation is intended for web usage only, it does not instrument Node.js's fetch()\");\n      return;\n    }\n    if (isWrapped(fetch)) {\n      this._unwrap(_globalThis, 'fetch');\n      this._diag.debug('removing previous patch for constructor');\n    }\n    this._wrap(_globalThis, 'fetch', this._patchConstructor());\n  };\n  /**\n   * implements unpatch function\n   */\n  FetchInstrumentation.prototype.disable = function () {\n    if (isNode) {\n      return;\n    }\n    this._unwrap(_globalThis, 'fetch');\n    this._usedResources = new WeakSet();\n  };\n  return FetchInstrumentation;\n}(InstrumentationBase);\nexport { FetchInstrumentation };","map":{"version":3,"names":["api","isWrapped","InstrumentationBase","safeExecuteInTheMiddle","core","web","AttributeNames","SEMATTRS_HTTP_STATUS_CODE","SEMATTRS_HTTP_HOST","SEMATTRS_HTTP_USER_AGENT","SEMATTRS_HTTP_SCHEME","SEMATTRS_HTTP_URL","SEMATTRS_HTTP_METHOD","VERSION","_globalThis","OBSERVER_WAIT_TIME_MS","isNode","process","_a","release","name","FetchInstrumentation","_super","__extends","config","_this","call","component","version","moduleName","_usedResources","WeakSet","_tasksCount","prototype","init","_addChildSpan","span","corsPreFlightRequest","childSpan","tracer","startSpan","startTime","PerformanceTimingNames","FETCH_START","trace","setSpan","context","active","getConfig","ignoreNetworkEvents","addSpanNetworkEvents","end","RESPONSE_END","_addFinalSpanAttributes","response","parsedUrl","parseUrl","url","setAttribute","status","statusText","HTTP_STATUS_TEXT","host","protocol","replace","navigator","userAgent","_addHeaders","options","spanUrl","shouldPropagateTraceHeaders","propagateTraceHeaderCorsUrls","headers","propagation","inject","Object","keys","length","_diag","debug","Request","set","h","k","v","String","Headers","Map","assign","_clearResources","clearTimingResources","performance","clearResourceTimings","_createSpan","isUrlIgnored","ignoreUrls","method","toUpperCase","spanName","kind","SpanKind","CLIENT","attributes","COMPONENT","_findResourceAndAddNetworkEvents","resourcesObserver","endTime","resources","entries","getEntriesByType","resource","getResource","mainRequest","_markResourceAsUsed","add","_endSpan","spanData","millisToHrTime","Date","now","performanceEndTime","hrTime","setTimeout","observer","disconnect","_patchConstructor","original","plugin","patchConstructor","args","_i","arguments","self","href","createdSpan","apply","_prepareSpanData","endSpanOnError","error","_applyAttributesAfterFetch","message","endSpanOnSuccess","onSuccess","resolve","resClone","clone","resClone4Hook_1","body","reader_1","getReader","read_1","read","then","done","onError","reject","Promise","with","bind","request","result","applyCustomAttributesOnSpan","PerformanceObserver","list","perfObsEntries","getEntries","forEach","entry","initiatorType","push","observe","entryTypes","enable","warn","fetch","_unwrap","_wrap","disable"],"sources":["/Users/aharon.shahar/Desktop/tasks/NodeJS/coralogix-frontend/node_modules/@opentelemetry/instrumentation-fetch/src/fetch.ts"],"sourcesContent":["/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as api from '@opentelemetry/api';\nimport {\n  isWrapped,\n  InstrumentationBase,\n  InstrumentationConfig,\n  safeExecuteInTheMiddle,\n} from '@opentelemetry/instrumentation';\nimport * as core from '@opentelemetry/core';\nimport * as web from '@opentelemetry/sdk-trace-web';\nimport { AttributeNames } from './enums/AttributeNames';\nimport {\n  SEMATTRS_HTTP_STATUS_CODE,\n  SEMATTRS_HTTP_HOST,\n  SEMATTRS_HTTP_USER_AGENT,\n  SEMATTRS_HTTP_SCHEME,\n  SEMATTRS_HTTP_URL,\n  SEMATTRS_HTTP_METHOD,\n} from '@opentelemetry/semantic-conventions';\nimport { FetchError, FetchResponse, SpanData } from './types';\nimport { VERSION } from './version';\nimport { _globalThis } from '@opentelemetry/core';\n\n// how long to wait for observer to collect information about resources\n// this is needed as event \"load\" is called before observer\n// hard to say how long it should really wait, seems like 300ms is\n// safe enough\nconst OBSERVER_WAIT_TIME_MS = 300;\n\nconst isNode = typeof process === 'object' && process.release?.name === 'node';\n\nexport interface FetchCustomAttributeFunction {\n  (\n    span: api.Span,\n    request: Request | RequestInit,\n    result: Response | FetchError\n  ): void;\n}\n\n/**\n * FetchPlugin Config\n */\nexport interface FetchInstrumentationConfig extends InstrumentationConfig {\n  // the number of timing resources is limited, after the limit\n  // (chrome 250, safari 150) the information is not collected anymore\n  // the only way to prevent that is to regularly clean the resources\n  // whenever it is possible, this is needed only when PerformanceObserver\n  // is not available\n  clearTimingResources?: boolean;\n  // urls which should include trace headers when origin doesn't match\n  propagateTraceHeaderCorsUrls?: web.PropagateTraceHeaderCorsUrls;\n  /**\n   * URLs that partially match any regex in ignoreUrls will not be traced.\n   * In addition, URLs that are _exact matches_ of strings in ignoreUrls will\n   * also not be traced.\n   */\n  ignoreUrls?: Array<string | RegExp>;\n  /** Function for adding custom attributes on the span */\n  applyCustomAttributesOnSpan?: FetchCustomAttributeFunction;\n  // Ignore adding network events as span events\n  ignoreNetworkEvents?: boolean;\n}\n\n/**\n * This class represents a fetch plugin for auto instrumentation\n */\nexport class FetchInstrumentation extends InstrumentationBase<FetchInstrumentationConfig> {\n  readonly component: string = 'fetch';\n  readonly version: string = VERSION;\n  moduleName = this.component;\n  private _usedResources = new WeakSet<PerformanceResourceTiming>();\n  private _tasksCount = 0;\n\n  constructor(config: FetchInstrumentationConfig = {}) {\n    super('@opentelemetry/instrumentation-fetch', VERSION, config);\n  }\n\n  init(): void {}\n\n  /**\n   * Add cors pre flight child span\n   * @param span\n   * @param corsPreFlightRequest\n   */\n  private _addChildSpan(\n    span: api.Span,\n    corsPreFlightRequest: PerformanceResourceTiming\n  ): void {\n    const childSpan = this.tracer.startSpan(\n      'CORS Preflight',\n      {\n        startTime: corsPreFlightRequest[web.PerformanceTimingNames.FETCH_START],\n      },\n      api.trace.setSpan(api.context.active(), span)\n    );\n    if (!this.getConfig().ignoreNetworkEvents) {\n      web.addSpanNetworkEvents(childSpan, corsPreFlightRequest);\n    }\n    childSpan.end(\n      corsPreFlightRequest[web.PerformanceTimingNames.RESPONSE_END]\n    );\n  }\n\n  /**\n   * Adds more attributes to span just before ending it\n   * @param span\n   * @param response\n   */\n  private _addFinalSpanAttributes(\n    span: api.Span,\n    response: FetchResponse\n  ): void {\n    const parsedUrl = web.parseUrl(response.url);\n    span.setAttribute(SEMATTRS_HTTP_STATUS_CODE, response.status);\n    if (response.statusText != null) {\n      span.setAttribute(AttributeNames.HTTP_STATUS_TEXT, response.statusText);\n    }\n    span.setAttribute(SEMATTRS_HTTP_HOST, parsedUrl.host);\n    span.setAttribute(\n      SEMATTRS_HTTP_SCHEME,\n      parsedUrl.protocol.replace(':', '')\n    );\n    if (typeof navigator !== 'undefined') {\n      span.setAttribute(SEMATTRS_HTTP_USER_AGENT, navigator.userAgent);\n    }\n  }\n\n  /**\n   * Add headers\n   * @param options\n   * @param spanUrl\n   */\n  private _addHeaders(options: Request | RequestInit, spanUrl: string): void {\n    if (\n      !web.shouldPropagateTraceHeaders(\n        spanUrl,\n        this.getConfig().propagateTraceHeaderCorsUrls\n      )\n    ) {\n      const headers: Partial<Record<string, unknown>> = {};\n      api.propagation.inject(api.context.active(), headers);\n      if (Object.keys(headers).length > 0) {\n        this._diag.debug('headers inject skipped due to CORS policy');\n      }\n      return;\n    }\n\n    if (options instanceof Request) {\n      api.propagation.inject(api.context.active(), options.headers, {\n        set: (h, k, v) => h.set(k, typeof v === 'string' ? v : String(v)),\n      });\n    } else if (options.headers instanceof Headers) {\n      api.propagation.inject(api.context.active(), options.headers, {\n        set: (h, k, v) => h.set(k, typeof v === 'string' ? v : String(v)),\n      });\n    } else if (options.headers instanceof Map) {\n      api.propagation.inject(api.context.active(), options.headers, {\n        set: (h, k, v) => h.set(k, typeof v === 'string' ? v : String(v)),\n      });\n    } else {\n      const headers: Partial<Record<string, unknown>> = {};\n      api.propagation.inject(api.context.active(), headers);\n      options.headers = Object.assign({}, headers, options.headers || {});\n    }\n  }\n\n  /**\n   * Clears the resource timings and all resources assigned with spans\n   *     when {@link FetchPluginConfig.clearTimingResources} is\n   *     set to true (default false)\n   * @private\n   */\n  private _clearResources() {\n    if (this._tasksCount === 0 && this.getConfig().clearTimingResources) {\n      performance.clearResourceTimings();\n      this._usedResources = new WeakSet<PerformanceResourceTiming>();\n    }\n  }\n\n  /**\n   * Creates a new span\n   * @param url\n   * @param options\n   */\n  private _createSpan(\n    url: string,\n    options: Partial<Request | RequestInit> = {}\n  ): api.Span | undefined {\n    if (core.isUrlIgnored(url, this.getConfig().ignoreUrls)) {\n      this._diag.debug('ignoring span as url matches ignored url');\n      return;\n    }\n    const method = (options.method || 'GET').toUpperCase();\n    const spanName = `HTTP ${method}`;\n    return this.tracer.startSpan(spanName, {\n      kind: api.SpanKind.CLIENT,\n      attributes: {\n        [AttributeNames.COMPONENT]: this.moduleName,\n        [SEMATTRS_HTTP_METHOD]: method,\n        [SEMATTRS_HTTP_URL]: url,\n      },\n    });\n  }\n\n  /**\n   * Finds appropriate resource and add network events to the span\n   * @param span\n   * @param resourcesObserver\n   * @param endTime\n   */\n  private _findResourceAndAddNetworkEvents(\n    span: api.Span,\n    resourcesObserver: SpanData,\n    endTime: api.HrTime\n  ): void {\n    let resources: PerformanceResourceTiming[] = resourcesObserver.entries;\n    if (!resources.length) {\n      if (!performance.getEntriesByType) {\n        return;\n      }\n      // fallback - either Observer is not available or it took longer\n      // then OBSERVER_WAIT_TIME_MS and observer didn't collect enough\n      // information\n      resources = performance.getEntriesByType(\n        'resource'\n      ) as PerformanceResourceTiming[];\n    }\n    const resource = web.getResource(\n      resourcesObserver.spanUrl,\n      resourcesObserver.startTime,\n      endTime,\n      resources,\n      this._usedResources,\n      'fetch'\n    );\n\n    if (resource.mainRequest) {\n      const mainRequest = resource.mainRequest;\n      this._markResourceAsUsed(mainRequest);\n\n      const corsPreFlightRequest = resource.corsPreFlightRequest;\n      if (corsPreFlightRequest) {\n        this._addChildSpan(span, corsPreFlightRequest);\n        this._markResourceAsUsed(corsPreFlightRequest);\n      }\n      if (!this.getConfig().ignoreNetworkEvents) {\n        web.addSpanNetworkEvents(span, mainRequest);\n      }\n    }\n  }\n\n  /**\n   * Marks certain [resource]{@link PerformanceResourceTiming} when information\n   * from this is used to add events to span.\n   * This is done to avoid reusing the same resource again for next span\n   * @param resource\n   */\n  private _markResourceAsUsed(resource: PerformanceResourceTiming): void {\n    this._usedResources.add(resource);\n  }\n\n  /**\n   * Finish span, add attributes, network events etc.\n   * @param span\n   * @param spanData\n   * @param response\n   */\n  private _endSpan(\n    span: api.Span,\n    spanData: SpanData,\n    response: FetchResponse\n  ) {\n    const endTime = core.millisToHrTime(Date.now());\n    const performanceEndTime = core.hrTime();\n    this._addFinalSpanAttributes(span, response);\n\n    setTimeout(() => {\n      spanData.observer?.disconnect();\n      this._findResourceAndAddNetworkEvents(span, spanData, performanceEndTime);\n      this._tasksCount--;\n      this._clearResources();\n      span.end(endTime);\n    }, OBSERVER_WAIT_TIME_MS);\n  }\n\n  /**\n   * Patches the constructor of fetch\n   */\n  private _patchConstructor(): (original: typeof fetch) => typeof fetch {\n    return original => {\n      const plugin = this;\n      return function patchConstructor(\n        this: typeof globalThis,\n        ...args: Parameters<typeof fetch>\n      ): Promise<Response> {\n        const self = this;\n        const url = web.parseUrl(\n          args[0] instanceof Request ? args[0].url : String(args[0])\n        ).href;\n\n        const options = args[0] instanceof Request ? args[0] : args[1] || {};\n        const createdSpan = plugin._createSpan(url, options);\n        if (!createdSpan) {\n          return original.apply(this, args);\n        }\n        const spanData = plugin._prepareSpanData(url);\n\n        function endSpanOnError(span: api.Span, error: FetchError) {\n          plugin._applyAttributesAfterFetch(span, options, error);\n          plugin._endSpan(span, spanData, {\n            status: error.status || 0,\n            statusText: error.message,\n            url,\n          });\n        }\n\n        function endSpanOnSuccess(span: api.Span, response: Response) {\n          plugin._applyAttributesAfterFetch(span, options, response);\n          if (response.status >= 200 && response.status < 400) {\n            plugin._endSpan(span, spanData, response);\n          } else {\n            plugin._endSpan(span, spanData, {\n              status: response.status,\n              statusText: response.statusText,\n              url,\n            });\n          }\n        }\n\n        function onSuccess(\n          span: api.Span,\n          resolve: (value: Response | PromiseLike<Response>) => void,\n          response: Response\n        ): void {\n          try {\n            const resClone = response.clone();\n            const resClone4Hook = response.clone();\n            const body = resClone.body;\n            if (body) {\n              const reader = body.getReader();\n              const read = (): void => {\n                reader.read().then(\n                  ({ done }) => {\n                    if (done) {\n                      endSpanOnSuccess(span, resClone4Hook);\n                    } else {\n                      read();\n                    }\n                  },\n                  error => {\n                    endSpanOnError(span, error);\n                  }\n                );\n              };\n              read();\n            } else {\n              // some older browsers don't have .body implemented\n              endSpanOnSuccess(span, response);\n            }\n          } finally {\n            resolve(response);\n          }\n        }\n\n        function onError(\n          span: api.Span,\n          reject: (reason?: unknown) => void,\n          error: FetchError\n        ) {\n          try {\n            endSpanOnError(span, error);\n          } finally {\n            reject(error);\n          }\n        }\n\n        return new Promise((resolve, reject) => {\n          return api.context.with(\n            api.trace.setSpan(api.context.active(), createdSpan),\n            () => {\n              plugin._addHeaders(options, url);\n              plugin._tasksCount++;\n              // TypeScript complains about arrow function captured a this typed as globalThis\n              // ts(7041)\n              return original\n                .apply(\n                  self,\n                  options instanceof Request ? [options] : [url, options]\n                )\n                .then(\n                  onSuccess.bind(self, createdSpan, resolve),\n                  onError.bind(self, createdSpan, reject)\n                );\n            }\n          );\n        });\n      };\n    };\n  }\n\n  private _applyAttributesAfterFetch(\n    span: api.Span,\n    request: Request | RequestInit,\n    result: Response | FetchError\n  ) {\n    const applyCustomAttributesOnSpan =\n      this.getConfig().applyCustomAttributesOnSpan;\n    if (applyCustomAttributesOnSpan) {\n      safeExecuteInTheMiddle(\n        () => applyCustomAttributesOnSpan(span, request, result),\n        error => {\n          if (!error) {\n            return;\n          }\n\n          this._diag.error('applyCustomAttributesOnSpan', error);\n        },\n        true\n      );\n    }\n  }\n\n  /**\n   * Prepares a span data - needed later for matching appropriate network\n   *     resources\n   * @param spanUrl\n   */\n  private _prepareSpanData(spanUrl: string): SpanData {\n    const startTime = core.hrTime();\n    const entries: PerformanceResourceTiming[] = [];\n    if (typeof PerformanceObserver !== 'function') {\n      return { entries, startTime, spanUrl };\n    }\n\n    const observer = new PerformanceObserver(list => {\n      const perfObsEntries = list.getEntries() as PerformanceResourceTiming[];\n      perfObsEntries.forEach(entry => {\n        if (entry.initiatorType === 'fetch' && entry.name === spanUrl) {\n          entries.push(entry);\n        }\n      });\n    });\n    observer.observe({\n      entryTypes: ['resource'],\n    });\n    return { entries, observer, startTime, spanUrl };\n  }\n\n  /**\n   * implements enable function\n   */\n  override enable(): void {\n    if (isNode) {\n      // Node.js v18+ *does* have a global `fetch()`, but this package does not\n      // support instrumenting it.\n      this._diag.warn(\n        \"this instrumentation is intended for web usage only, it does not instrument Node.js's fetch()\"\n      );\n      return;\n    }\n    if (isWrapped(fetch)) {\n      this._unwrap(_globalThis, 'fetch');\n      this._diag.debug('removing previous patch for constructor');\n    }\n    this._wrap(_globalThis, 'fetch', this._patchConstructor());\n  }\n\n  /**\n   * implements unpatch function\n   */\n  override disable(): void {\n    if (isNode) {\n      return;\n    }\n    this._unwrap(_globalThis, 'fetch');\n    this._usedResources = new WeakSet<PerformanceResourceTiming>();\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}