{"ast":null,"code":"var _a;\nimport { BASE_PATH, CoralogixAttributes, HASH_SEPARATOR, MAX_CHARACTERS, PARAMS_SEPARATOR, PROTOCOL_SEPARATOR } from '../constants';\nimport { LONGTASK_DURATION } from '../instrumentations/instrumentation.consts';\nimport { getSdkConfig } from '../helpers';\nimport { omit } from './object';\nimport { getNowTime } from './time';\nexport const supportedPerformanceTypes = !((_a = window === null || window === void 0 ? void 0 : window.PerformanceObserver) === null || _a === void 0 ? void 0 : _a.supportedEntryTypes) ? {} : window.PerformanceObserver.supportedEntryTypes.reduce((obj, type) => {\n  obj[type] = true;\n  return obj;\n}, {});\nexport function valueEndWithOrInclude(value, extensions) {\n  return extensions.some(ex => value.endsWith(ex) || value.includes(ex));\n}\nexport function getInstrumentationConfig(value, defaults, defaultDisable) {\n  if (value === false) {\n    return value;\n  }\n  if (value === undefined && defaultDisable) {\n    return false;\n  }\n  if ((value === null || value === void 0 ? void 0 : value.enabled) === false) {\n    return false;\n  }\n  return Object.assign({}, defaults, value);\n}\nexport const hrTimeToMilliseconds = ([seconds, nanoseconds]) => seconds * 1000 + Math.round(nanoseconds / 1e6);\nexport const isNetworkError = status => {\n  if (!status) {\n    return false;\n  }\n  return status >= 400;\n};\nexport const getUrlFragments = url => {\n  var _a, _b;\n  if (!url) {\n    return '';\n  }\n  const withoutProtocol = ((_a = url.split(PROTOCOL_SEPARATOR)) === null || _a === void 0 ? void 0 : _a[1]) || url;\n  const startPath = (_b = withoutProtocol.split(BASE_PATH)) === null || _b === void 0 ? void 0 : _b[1];\n  if (startPath === null || startPath === void 0 ? void 0 : startPath.startsWith(HASH_SEPARATOR)) {\n    const fragments = withoutProtocol.split(HASH_SEPARATOR)[1];\n    const cleanedFragments = fragments.split(PARAMS_SEPARATOR)[0];\n    const pathFragments = cleanedFragments.split(BASE_PATH);\n    if (pathFragments.length) {\n      pathFragments.shift();\n    }\n    return pathFragments.join(BASE_PATH) || BASE_PATH;\n  } else {\n    try {\n      return new URL(url).pathname.substring(1) || BASE_PATH;\n    } catch (err) {\n      console.warn('Coralogix Browser SDK - Error parsing URL', err);\n      return url;\n    }\n  }\n};\nexport function parseUserAgent(userAgent) {\n  var _a, _b;\n  const browsers = {\n    Chrome: /Chrome\\/([\\d.]+)/,\n    Firefox: /Firefox\\/([\\d.]+)/,\n    Safari: /Version\\/([\\d.]+).*Safari/,\n    Edge: /Edge\\/([\\d.]+)/,\n    Opera: /Opera\\/([\\d.]+)/,\n    IE: /Trident.*rv:([\\d.]+)/\n  };\n  const operatingSystems = {\n    Windows: /Windows NT ([\\d.]+)/,\n    MacOS: /Mac OS X ([\\d._]+)/,\n    Linux: /Linux(?: ([\\d.]+))?/,\n    iOS: /CPU(?: iPhone)? OS (\\d+([._]\\d+)*)/,\n    Android: /Android (\\d+([._]\\d+)*)/\n  };\n  const devices = {\n    Mobile: /Mobile|Android|iPhone|iPod|BlackBerry|IEMobile|Windows Phone|webOS|Opera Mini/,\n    Tablet: /Tablet|iPad/\n  };\n  let browser = 'Unknown';\n  let browserVersion = 'Unknown';\n  let os = 'Unknown';\n  let osVersion = 'Unknown';\n  let device = 'Desktop';\n  for (const [name, regex] of Object.entries(browsers)) {\n    const match = userAgent.match(regex);\n    if (match) {\n      browser = name;\n      browserVersion = match[1] || 'Unknown';\n      break;\n    }\n  }\n  for (const [name, regex] of Object.entries(operatingSystems)) {\n    const match = userAgent.match(regex);\n    if (match) {\n      os = name;\n      osVersion = ((_b = (_a = match[1]) === null || _a === void 0 ? void 0 : _a.split('_')) === null || _b === void 0 ? void 0 : _b.join('.')) || 'Unknown';\n      break;\n    }\n  }\n  for (const [name, regex] of Object.entries(devices)) {\n    const match = userAgent.match(regex);\n    if (match) {\n      device = name;\n      break;\n    }\n  }\n  return {\n    browser,\n    browserVersion,\n    os,\n    osVersion,\n    device\n  };\n}\nexport function calculateTotalBlockingTime(list) {\n  return list.reduce((total, entry) => {\n    total += entry.duration - LONGTASK_DURATION;\n    return total;\n  }, 0);\n}\nexport function generateWebVitalUniqueID() {\n  return `v3-${getNowTime()}-${Math.floor(Math.random() * (9e12 - 1)) + 1e12}`;\n}\nexport function rateForTBTMetricValue(value // ms\n) {\n  switch (true) {\n    case value > 600:\n      return 'poor';\n    case value > 200 && value <= 600:\n      return 'needs-improvement';\n    default:\n      return 'good';\n  }\n}\nexport function flattenAttributes(attributes) {\n  const customLabels = JSON.parse(attributes[CoralogixAttributes.CUSTOM_LABELS]);\n  const flatAttributes = omit(attributes, CoralogixAttributes.CUSTOM_LABELS);\n  for (const [key, value] of Object.entries(customLabels)) {\n    flatAttributes[key] = typeof value !== 'string' ? JSON.stringify(value) : value;\n  }\n  return flatAttributes;\n}\nexport const getCircularReplacer = () => {\n  const seen = new WeakSet();\n  return (key, value) => {\n    if (typeof value === 'object' && value !== null) {\n      if (seen.has(value)) {\n        return;\n      }\n      seen.add(value);\n    }\n    return value;\n  };\n};\nexport function replacePatternsInUrl({\n  patterns,\n  url\n}) {\n  let modifiedUrl = url;\n  for (const {\n    pattern,\n    replacement\n  } of patterns) {\n    modifiedUrl = modifiedUrl.replace(pattern, replacement);\n  }\n  return modifiedUrl;\n}\nexport function applyUrlBluePrinters({\n  url,\n  blueprinters\n}) {\n  let blueprintedUrl = url;\n  blueprinters === null || blueprinters === void 0 ? void 0 : blueprinters.forEach(urlBlueprinter => blueprintedUrl = urlBlueprinter(blueprintedUrl));\n  return blueprintedUrl;\n}\nexport function resolvePageContext(url) {\n  var _a;\n  const page_url_blueprint = applyUrlBluePrinters({\n    url,\n    blueprinters: (_a = getSdkConfig().urlBlueprinters) === null || _a === void 0 ? void 0 : _a.pageUrlBlueprinters\n  });\n  const page_fragments = getUrlFragments(page_url_blueprint);\n  return {\n    page_url: url.slice(0, MAX_CHARACTERS),\n    page_url_blueprint,\n    page_fragments\n  };\n}\nexport function deepClone(obj) {\n  return JSON.parse(JSON.stringify(obj));\n}\nexport function partition(array, predicate) {\n  const truthyValues = [];\n  const falsyValues = [];\n  for (const element of array) {\n    if (predicate(element)) {\n      truthyValues.push(element);\n    } else {\n      falsyValues.push(element);\n    }\n  }\n  return [truthyValues, falsyValues];\n}","map":{"version":3,"names":["BASE_PATH","CoralogixAttributes","HASH_SEPARATOR","MAX_CHARACTERS","PARAMS_SEPARATOR","PROTOCOL_SEPARATOR","LONGTASK_DURATION","getSdkConfig","omit","getNowTime","supportedPerformanceTypes","_a","window","PerformanceObserver","supportedEntryTypes","reduce","obj","type","valueEndWithOrInclude","value","extensions","some","ex","endsWith","includes","getInstrumentationConfig","defaults","defaultDisable","undefined","enabled","Object","assign","hrTimeToMilliseconds","seconds","nanoseconds","Math","round","isNetworkError","status","getUrlFragments","url","withoutProtocol","split","startPath","_b","startsWith","fragments","cleanedFragments","pathFragments","length","shift","join","URL","pathname","substring","err","console","warn","parseUserAgent","userAgent","browsers","Chrome","Firefox","Safari","Edge","Opera","IE","operatingSystems","Windows","MacOS","Linux","iOS","Android","devices","Mobile","Tablet","browser","browserVersion","os","osVersion","device","name","regex","entries","match","calculateTotalBlockingTime","list","total","entry","duration","generateWebVitalUniqueID","floor","random","rateForTBTMetricValue","flattenAttributes","attributes","customLabels","JSON","parse","CUSTOM_LABELS","flatAttributes","key","stringify","getCircularReplacer","seen","WeakSet","has","add","replacePatternsInUrl","patterns","modifiedUrl","pattern","replacement","replace","applyUrlBluePrinters","blueprinters","blueprintedUrl","forEach","urlBlueprinter","resolvePageContext","page_url_blueprint","urlBlueprinters","pageUrlBlueprinters","page_fragments","page_url","slice","deepClone","partition","array","predicate","truthyValues","falsyValues","element","push"],"sources":["../../../../../libs/browser/src/utils/all.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}