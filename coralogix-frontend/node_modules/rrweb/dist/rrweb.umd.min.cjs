(function (g, f) {
    if ("object" == typeof exports && "object" == typeof module) {
      module.exports = f();
    } else if ("function" == typeof define && define.amd) {
      define("rrweb", [], f);
    } else if ("object" == typeof exports) {
      exports["rrweb"] = f();
    } else {
      g["rrweb"] = f();
    }
  }(this, () => {
var exports = {};
var module = { exports };
"use strict";var ci=Object.defineProperty,ui=Object.defineProperties;var di=Object.getOwnPropertyDescriptors;var Ke=Object.getOwnPropertySymbols;var zt=Object.prototype.hasOwnProperty,Xt=Object.prototype.propertyIsEnumerable;var Ht=(t,e,s)=>e in t?ci(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,G=(t,e)=>{for(var s in e||(e={}))zt.call(e,s)&&Ht(t,s,e[s]);if(Ke)for(var s of Ke(e))Xt.call(e,s)&&Ht(t,s,e[s]);return t},ue=(t,e)=>ui(t,di(e));var Zt=(t,e)=>{var s={};for(var i in t)zt.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(t!=null&&Ke)for(var i of Ke(t))e.indexOf(i)<0&&Xt.call(t,i)&&(s[i]=t[i]);return s};var hi=Object.defineProperty,fi=(t,e,s)=>e in t?hi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,b=(t,e,s)=>(fi(t,typeof e!="symbol"?e+"":e,s),s),jt;Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var pi=Object.defineProperty,mi=(t,e,s)=>e in t?pi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Me=(t,e,s)=>(mi(t,typeof e!="symbol"?e+"":e,s),s),D=(t=>(t[t.Document=0]="Document",t[t.DocumentType=1]="DocumentType",t[t.Element=2]="Element",t[t.Text=3]="Text",t[t.CDATA=4]="CDATA",t[t.Comment=5]="Comment",t))(D||{});function ws(t){return t.nodeType===t.ELEMENT_NODE}function Ue(t){const e=t==null?void 0:t.host;return(e==null?void 0:e.shadowRoot)===t}function Ye(t){return Object.prototype.toString.call(t)==="[object ShadowRoot]"}function gi(t){return t.includes(" background-clip: text;")&&!t.includes(" -webkit-background-clip: text;")&&(t=t.replace(/\sbackground-clip:\s*text;/g," -webkit-background-clip: text; background-clip: text;")),t}function yi(t){const{cssText:e}=t;if(e.split('"').length<3)return e;const s=["@import",`url(${JSON.stringify(t.href)})`];return t.layerName===""?s.push("layer"):t.layerName&&s.push(`layer(${t.layerName})`),t.supportsText&&s.push(`supports(${t.supportsText})`),t.media.length&&s.push(t.media.mediaText),s.join(" ")+";"}function rt(t){try{const e=t.rules||t.cssRules;return e?gi(Array.from(e,Ns).join("")):null}catch(e){return null}}function Ns(t){let e;if(bi(t))try{e=rt(t.styleSheet)||yi(t)}catch(s){}else if(Si(t)&&t.selectorText.includes(":"))return vi(t.cssText);return e||t.cssText}function vi(t){const e=/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm;return t.replace(e,"$1\\$2")}function bi(t){return"styleSheet"in t}function Si(t){return"selectorText"in t}class Nt{constructor(){Me(this,"idNodeMap",new Map),Me(this,"nodeMetaMap",new WeakMap)}getId(e){var s;if(!e)return-1;const i=(s=this.getMeta(e))==null?void 0:s.id;return i!=null?i:-1}getNode(e){return this.idNodeMap.get(e)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(e){return this.nodeMetaMap.get(e)||null}removeNodeFromMap(e){const s=this.getId(e);this.idNodeMap.delete(s),e.childNodes&&e.childNodes.forEach(i=>this.removeNodeFromMap(i))}has(e){return this.idNodeMap.has(e)}hasNode(e){return this.nodeMetaMap.has(e)}add(e,s){const i=s.id;this.idNodeMap.set(i,e),this.nodeMetaMap.set(e,s)}replace(e,s){const i=this.getNode(e);if(i){const r=this.nodeMetaMap.get(i);r&&this.nodeMetaMap.set(s,r)}this.idNodeMap.set(e,s)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}}function Es(){return new Nt}function Et({element:t,maskInputOptions:e,tagName:s,type:i,value:r,maskInputFn:o}){let a=r||"";const n=i&&Se(i);return(e[s.toLowerCase()]||n&&e[n])&&(o?a=o(a,t):a="*".repeat(a.length)),a}function Se(t){return t.toLowerCase()}const Jt="__rrweb_original__";function Ci(t){const e=t.getContext("2d");if(!e)return!0;const s=50;for(let i=0;i<t.width;i+=s)for(let r=0;r<t.height;r+=s){const o=e.getImageData,a=Jt in o?o[Jt]:o;if(new Uint32Array(a.call(e,i,r,Math.min(s,t.width-i),Math.min(s,t.height-r)).data.buffer).some(c=>c!==0))return!1}return!0}function Ii(t,e){return!t||!e||t.type!==e.type?!1:t.type===D.Document?t.compatMode===e.compatMode:t.type===D.DocumentType?t.name===e.name&&t.publicId===e.publicId&&t.systemId===e.systemId:t.type===D.Comment||t.type===D.Text||t.type===D.CDATA?t.textContent===e.textContent:t.type===D.Element?t.tagName===e.tagName&&JSON.stringify(t.attributes)===JSON.stringify(e.attributes)&&t.isSVG===e.isSVG&&t.needBlock===e.needBlock:!1}function Tt(t){const e=t.type;return t.hasAttribute("data-rr-is-password")?"password":e?Se(e):null}function Ts(t,e){var o;let s;try{s=new URL(t,e!=null?e:window.location.href)}catch(a){return null}const i=/\.([0-9a-z]+)(?:$)/i,r=s.pathname.match(i);return(o=r==null?void 0:r[1])!=null?o:null}let Mi=1;const wi=new RegExp("[^a-z0-9-_:]"),Xe=-2;function Ds(){return Mi++}function Ni(t){if(t instanceof HTMLFormElement)return"form";const e=Se(t.tagName);return wi.test(e)?"div":e}function Ei(t){let e="";return t.indexOf("//")>-1?e=t.split("/").slice(0,3).join("/"):e=t.split("/")[0],e=e.split("?")[0],e}let Te,$t;const Ti=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,Di=/^(?:[a-z+]+:)?\/\//i,Ri=/^www\..*/i,Ai=/^(data:)([^,]*),(.*)/i;function nt(t,e){return(t||"").replace(Ti,(s,i,r,o,a,n)=>{const c=r||a||n,l=i||o||"";if(!c)return s;if(Di.test(c)||Ri.test(c))return`url(${l}${c}${l})`;if(Ai.test(c))return`url(${l}${c}${l})`;if(c[0]==="/")return`url(${l}${Ei(e)+c}${l})`;const u=e.split("/"),d=c.split("/");u.pop();for(const h of d)h!=="."&&(h===".."?u.pop():u.push(h));return`url(${l}${u.join("/")}${l})`})}const xi=/^[^ \t\n\r\u000c]+/,ki=/^[, \t\n\r\u000c]+/;function Oi(t,e){if(e.trim()==="")return e;let s=0;function i(o){let a;const n=o.exec(e.substring(s));return n?(a=n[0],s+=a.length,a):""}const r=[];for(;i(ki),!(s>=e.length);){let o=i(xi);if(o.slice(-1)===",")o=xe(t,o.substring(0,o.length-1)),r.push(o);else{let a="";o=xe(t,o);let n=!1;for(;;){const c=e.charAt(s);if(c===""){r.push((o+a).trim());break}else if(n)c===")"&&(n=!1);else if(c===","){s+=1,r.push((o+a).trim());break}else c==="("&&(n=!0);a+=c,s+=1}}}return r.join(", ")}const Kt=new WeakMap;function xe(t,e){return!e||e.trim()===""?e:ft(t,e)}function _i(t){return!!(t.tagName==="svg"||t.ownerSVGElement)}function ft(t,e){let s=Kt.get(t);if(s||(s=t.createElement("a"),Kt.set(t,s)),!e)e="";else if(e.startsWith("blob:")||e.startsWith("data:"))return e;return s.setAttribute("href",e),s.href}function Rs(t,e,s,i){return i&&(s==="src"||s==="href"&&!(e==="use"&&i[0]==="#")||s==="xlink:href"&&i[0]!=="#"||s==="background"&&(e==="table"||e==="td"||e==="th")?xe(t,i):s==="srcset"?Oi(t,i):s==="style"?nt(i,ft(t)):e==="object"&&s==="data"?xe(t,i):i)}function As(t,e,s){return(t==="video"||t==="audio")&&e==="autoplay"}function Li(t,e,s){try{if(typeof e=="string"){if(t.classList.contains(e))return!0}else for(let i=t.classList.length;i--;){const r=t.classList[i];if(e.test(r))return!0}if(s)return t.matches(s)}catch(i){}return!1}function ot(t,e,s){if(!t)return!1;if(t.nodeType!==t.ELEMENT_NODE)return s?ot(t.parentNode,e,s):!1;for(let i=t.classList.length;i--;){const r=t.classList[i];if(e.test(r))return!0}return s?ot(t.parentNode,e,s):!1}function xs(t,e,s,i){try{const r=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(r===null)return!1;if(typeof e=="string"){if(i){if(r.closest(`.${e}`))return!0}else if(r.classList.contains(e))return!0}else if(ot(r,e,i))return!0;if(s){if(i){if(r.closest(s))return!0}else if(r.matches(s))return!0}}catch(r){}return!1}function Fi(t,e,s){const i=t.contentWindow;if(!i)return;let r=!1,o;try{o=i.document.readyState}catch(n){return}if(o!=="complete"){const n=setTimeout(()=>{r||(e(),r=!0)},s);t.addEventListener("load",()=>{clearTimeout(n),r=!0,e()});return}const a="about:blank";if(i.location.href!==a||t.src===a||t.src==="")return setTimeout(e,0),t.addEventListener("load",e);t.addEventListener("load",e)}function Pi(t,e,s){let i=!1,r;try{r=t.sheet}catch(a){return}if(r)return;const o=setTimeout(()=>{i||(e(),i=!0)},s);t.addEventListener("load",()=>{clearTimeout(o),i=!0,e()})}function Wi(t,e){const{doc:s,mirror:i,blockClass:r,blockSelector:o,needsMask:a,inlineStylesheet:n,maskInputOptions:c={},maskTextFn:l,maskInputFn:u,dataURLOptions:d={},inlineImages:h,recordCanvas:p,keepIframeSrcFn:m,newlyAddedElement:f=!1}=e,v=Gi(s,i);switch(t.nodeType){case t.DOCUMENT_NODE:return t.compatMode!=="CSS1Compat"?{type:D.Document,childNodes:[],compatMode:t.compatMode}:{type:D.Document,childNodes:[]};case t.DOCUMENT_TYPE_NODE:return{type:D.DocumentType,name:t.name,publicId:t.publicId,systemId:t.systemId,rootId:v};case t.ELEMENT_NODE:return Vi(t,{doc:s,blockClass:r,blockSelector:o,inlineStylesheet:n,maskInputOptions:c,maskInputFn:u,dataURLOptions:d,inlineImages:h,recordCanvas:p,keepIframeSrcFn:m,newlyAddedElement:f,rootId:v});case t.TEXT_NODE:return Bi(t,{doc:s,needsMask:a,maskTextFn:l,rootId:v});case t.CDATA_SECTION_NODE:return{type:D.CDATA,textContent:"",rootId:v};case t.COMMENT_NODE:return{type:D.Comment,textContent:t.textContent||"",rootId:v};default:return!1}}function Gi(t,e){if(!e.hasNode(t))return;const s=e.getId(t);return s===1?void 0:s}function Bi(t,e){var s;const{needsMask:i,maskTextFn:r,rootId:o}=e,a=t.parentNode&&t.parentNode.tagName;let n=t.textContent;const c=a==="STYLE"?!0:void 0,l=a==="SCRIPT"?!0:void 0;if(c&&n){try{t.nextSibling||t.previousSibling||(s=t.parentNode.sheet)!=null&&s.cssRules&&(n=rt(t.parentNode.sheet))}catch(u){console.warn(`Cannot get CSS styles from text's parentNode. Error: ${u}`,t)}n=nt(n,ft(e.doc))}return l&&(n="SCRIPT_PLACEHOLDER"),!c&&!l&&n&&i&&(n=r?r(n,t.parentElement):n.replace(/[\S]/g,"*")),{type:D.Text,textContent:n||"",isStyle:c,rootId:o}}function Vi(t,e){const{doc:s,blockClass:i,blockSelector:r,inlineStylesheet:o,maskInputOptions:a={},maskInputFn:n,dataURLOptions:c={},inlineImages:l,recordCanvas:u,keepIframeSrcFn:d,newlyAddedElement:h=!1,rootId:p}=e,m=Li(t,i,r),f=Ni(t);let v={};const g=t.attributes.length;for(let y=0;y<g;y++){const I=t.attributes[y];As(f,I.name,I.value)||(v[I.name]=Rs(s,f,Se(I.name),I.value))}if(f==="link"&&o){const y=Array.from(s.styleSheets).find(T=>T.href===t.href);let I=null;y&&(I=rt(y)),I&&(delete v.rel,delete v.href,v._cssText=nt(I,y.href))}if(f==="style"&&t.sheet&&!(t.innerText||t.textContent||"").trim().length){const y=rt(t.sheet);y&&(v._cssText=nt(y,ft(s)))}if(f==="input"||f==="textarea"||f==="select"){const y=t.value,I=t.checked;v.type!=="radio"&&v.type!=="checkbox"&&v.type!=="submit"&&v.type!=="button"&&y?v.value=Et({element:t,type:Tt(t),tagName:f,value:y,maskInputOptions:a,maskInputFn:n}):I&&(v.checked=I)}if(f==="option"&&(t.selected&&!a.select?v.selected=!0:delete v.selected),f==="canvas"&&u){if(t.__context==="2d")Ci(t)||(v.rr_dataURL=t.toDataURL(c.type,c.quality));else if(!("__context"in t)){const y=t.toDataURL(c.type,c.quality),I=s.createElement("canvas");I.width=t.width,I.height=t.height;const T=I.toDataURL(c.type,c.quality);y!==T&&(v.rr_dataURL=y)}}if(f==="img"&&l){Te||(Te=s.createElement("canvas"),$t=Te.getContext("2d"));const y=t,I=y.currentSrc||y.getAttribute("src")||"<unknown-src>",T=y.crossOrigin,A=()=>{y.removeEventListener("load",A);try{Te.width=y.naturalWidth,Te.height=y.naturalHeight,$t.drawImage(y,0,0),v.rr_dataURL=Te.toDataURL(c.type,c.quality)}catch(U){if(y.crossOrigin!=="anonymous"){y.crossOrigin="anonymous",y.complete&&y.naturalWidth!==0?A():y.addEventListener("load",A);return}else console.warn(`Cannot inline img src=${I}! Error: ${U}`)}y.crossOrigin==="anonymous"&&(T?v.crossOrigin=T:y.removeAttribute("crossorigin"))};y.complete&&y.naturalWidth!==0?A():y.addEventListener("load",A)}if(f==="audio"||f==="video"){const y=v;y.rr_mediaState=t.paused?"paused":"played",y.rr_mediaCurrentTime=t.currentTime,y.rr_mediaPlaybackRate=t.playbackRate,y.rr_mediaMuted=t.muted,y.rr_mediaLoop=t.loop,y.rr_mediaVolume=t.volume}if(h||(t.scrollLeft&&(v.rr_scrollLeft=t.scrollLeft),t.scrollTop&&(v.rr_scrollTop=t.scrollTop)),m){const{width:y,height:I}=t.getBoundingClientRect();v={class:v.class,rr_width:`${y}px`,rr_height:`${I}px`}}f==="iframe"&&!d(v.src)&&(t.contentDocument||(v.rr_src=v.src),delete v.src);let S;try{customElements.get(f)&&(S=!0)}catch(y){}return{type:D.Element,tagName:f,attributes:v,childNodes:[],isSVG:_i(t)||void 0,needBlock:m,rootId:p,isCustom:S}}function B(t){return t==null?"":t.toLowerCase()}function Ui(t,e){if(e.comment&&t.type===D.Comment)return!0;if(t.type===D.Element){if(e.script&&(t.tagName==="script"||t.tagName==="link"&&(t.attributes.rel==="preload"||t.attributes.rel==="modulepreload")&&t.attributes.as==="script"||t.tagName==="link"&&t.attributes.rel==="prefetch"&&typeof t.attributes.href=="string"&&Ts(t.attributes.href)==="js"))return!0;if(e.headFavicon&&(t.tagName==="link"&&t.attributes.rel==="shortcut icon"||t.tagName==="meta"&&(B(t.attributes.name).match(/^msapplication-tile(image|color)$/)||B(t.attributes.name)==="application-name"||B(t.attributes.rel)==="icon"||B(t.attributes.rel)==="apple-touch-icon"||B(t.attributes.rel)==="shortcut icon")))return!0;if(t.tagName==="meta"){if(e.headMetaDescKeywords&&B(t.attributes.name).match(/^description|keywords$/))return!0;if(e.headMetaSocial&&(B(t.attributes.property).match(/^(og|twitter|fb):/)||B(t.attributes.name).match(/^(og|twitter):/)||B(t.attributes.name)==="pinterest"))return!0;if(e.headMetaRobots&&(B(t.attributes.name)==="robots"||B(t.attributes.name)==="googlebot"||B(t.attributes.name)==="bingbot"))return!0;if(e.headMetaHttpEquiv&&t.attributes["http-equiv"]!==void 0)return!0;if(e.headMetaAuthorship&&(B(t.attributes.name)==="author"||B(t.attributes.name)==="generator"||B(t.attributes.name)==="framework"||B(t.attributes.name)==="publisher"||B(t.attributes.name)==="progid"||B(t.attributes.property).match(/^article:/)||B(t.attributes.property).match(/^product:/)))return!0;if(e.headMetaVerification&&(B(t.attributes.name)==="google-site-verification"||B(t.attributes.name)==="yandex-verification"||B(t.attributes.name)==="csrf-token"||B(t.attributes.name)==="p:domain_verify"||B(t.attributes.name)==="verify-v1"||B(t.attributes.name)==="verification"||B(t.attributes.name)==="shopify-checkout-api-token"))return!0}}return!1}function ke(t,e){const{doc:s,mirror:i,blockClass:r,blockSelector:o,maskTextClass:a,maskTextSelector:n,skipChild:c=!1,inlineStylesheet:l=!0,maskInputOptions:u={},maskTextFn:d,maskInputFn:h,slimDOMOptions:p,dataURLOptions:m={},inlineImages:f=!1,recordCanvas:v=!1,onSerialize:g,onIframeLoad:S,iframeLoadTimeout:y=5e3,onStylesheetLoad:I,stylesheetLoadTimeout:T=5e3,keepIframeSrcFn:A=()=>!1,newlyAddedElement:U=!1}=e;let{needsMask:Y}=e,{preserveWhiteSpace:se=!0}=e;!Y&&t.childNodes&&(Y=xs(t,a,n,Y===void 0));const K=Wi(t,{doc:s,mirror:i,blockClass:r,blockSelector:o,needsMask:Y,inlineStylesheet:l,maskInputOptions:u,maskTextFn:d,maskInputFn:h,dataURLOptions:m,inlineImages:f,recordCanvas:v,keepIframeSrcFn:A,newlyAddedElement:U});if(!K)return console.warn(t,"not serialized"),null;let Q;i.hasNode(t)?Q=i.getId(t):Ui(K,p)||!se&&K.type===D.Text&&!K.isStyle&&!K.textContent.replace(/^\s+|\s+$/gm,"").length?Q=Xe:Q=Ds();const x=Object.assign(K,{id:Q});if(i.add(t,x),Q===Xe)return null;g&&g(t);let re=!c;if(x.type===D.Element){re=re&&!x.needBlock,delete x.needBlock;const Z=t.shadowRoot;Z&&Ye(Z)&&(x.isShadowHost=!0)}if((x.type===D.Document||x.type===D.Element)&&re){p.headWhitespace&&x.type===D.Element&&x.tagName==="head"&&(se=!1);const Z={doc:s,mirror:i,blockClass:r,blockSelector:o,needsMask:Y,maskTextClass:a,maskTextSelector:n,skipChild:c,inlineStylesheet:l,maskInputOptions:u,maskTextFn:d,maskInputFn:h,slimDOMOptions:p,dataURLOptions:m,inlineImages:f,recordCanvas:v,preserveWhiteSpace:se,onSerialize:g,onIframeLoad:S,iframeLoadTimeout:y,onStylesheetLoad:I,stylesheetLoadTimeout:T,keepIframeSrcFn:A};if(!(x.type===D.Element&&x.tagName==="textarea"&&x.attributes.value!==void 0))for(const ne of Array.from(t.childNodes)){const q=ke(ne,Z);q&&x.childNodes.push(q)}if(ws(t)&&t.shadowRoot)for(const ne of Array.from(t.shadowRoot.childNodes)){const q=ke(ne,Z);q&&(Ye(t.shadowRoot)&&(q.isShadow=!0),x.childNodes.push(q))}}return t.parentNode&&Ue(t.parentNode)&&Ye(t.parentNode)&&(x.isShadow=!0),x.type===D.Element&&x.tagName==="iframe"&&Fi(t,()=>{const Z=t.contentDocument;if(Z&&S){const ne=ke(Z,{doc:Z,mirror:i,blockClass:r,blockSelector:o,needsMask:Y,maskTextClass:a,maskTextSelector:n,skipChild:!1,inlineStylesheet:l,maskInputOptions:u,maskTextFn:d,maskInputFn:h,slimDOMOptions:p,dataURLOptions:m,inlineImages:f,recordCanvas:v,preserveWhiteSpace:se,onSerialize:g,onIframeLoad:S,iframeLoadTimeout:y,onStylesheetLoad:I,stylesheetLoadTimeout:T,keepIframeSrcFn:A});ne&&S(t,ne)}},y),x.type===D.Element&&x.tagName==="link"&&typeof x.attributes.rel=="string"&&(x.attributes.rel==="stylesheet"||x.attributes.rel==="preload"&&typeof x.attributes.href=="string"&&Ts(x.attributes.href)==="css")&&Pi(t,()=>{if(I){const Z=ke(t,{doc:s,mirror:i,blockClass:r,blockSelector:o,needsMask:Y,maskTextClass:a,maskTextSelector:n,skipChild:!1,inlineStylesheet:l,maskInputOptions:u,maskTextFn:d,maskInputFn:h,slimDOMOptions:p,dataURLOptions:m,inlineImages:f,recordCanvas:v,preserveWhiteSpace:se,onSerialize:g,onIframeLoad:S,iframeLoadTimeout:y,onStylesheetLoad:I,stylesheetLoadTimeout:T,keepIframeSrcFn:A});Z&&I(t,Z)}},T),x}function Yi(t,e){const{mirror:s=new Nt,blockClass:i="rr-block",blockSelector:r=null,maskTextClass:o="rr-mask",maskTextSelector:a=null,inlineStylesheet:n=!0,inlineImages:c=!1,recordCanvas:l=!1,maskAllInputs:u=!1,maskTextFn:d,maskInputFn:h,slimDOM:p=!1,dataURLOptions:m,preserveWhiteSpace:f,onSerialize:v,onIframeLoad:g,iframeLoadTimeout:S,onStylesheetLoad:y,stylesheetLoadTimeout:I,keepIframeSrcFn:T=()=>!1}=e||{};return ke(t,{doc:t,mirror:s,blockClass:i,blockSelector:r,maskTextClass:o,maskTextSelector:a,skipChild:!1,inlineStylesheet:n,maskInputOptions:u===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:u===!1?{password:!0}:u,maskTextFn:d,maskInputFn:h,slimDOMOptions:p===!0||p==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:p==="all",headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:p===!1?{}:p,dataURLOptions:m,inlineImages:c,recordCanvas:l,preserveWhiteSpace:f,onSerialize:v,onIframeLoad:g,iframeLoadTimeout:S,onStylesheetLoad:y,stylesheetLoadTimeout:I,keepIframeSrcFn:T,newlyAddedElement:!1})}const Qt=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;function Hi(t,e={}){let s=1,i=1;function r(N){const C=N.match(/\n/g);C&&(s+=C.length);const R=N.lastIndexOf(`
`);i=R===-1?i+N.length:N.length-R}function o(){const N={line:s,column:i};return C=>(C.position=new n(N),f(),C)}const a=class ks{constructor(C){Me(this,"content"),Me(this,"start"),Me(this,"end"),Me(this,"source"),this.start=C,this.end={line:s,column:i},this.source=e.source,this.content=ks.content}};Me(a,"content");let n=a;n.content=t;const c=[];function l(N){const C=new Error(`${e.source||""}:${s}:${i}: ${N}`);if(C.reason=N,C.filename=e.source,C.line=s,C.column=i,C.source=t,e.silent)c.push(C);else throw C}function u(){const N=p();return{type:"stylesheet",stylesheet:{source:e.source,rules:N,parsingErrors:c}}}function d(){return m(/^{\s*/)}function h(){return m(/^}/)}function p(){let N;const C=[];for(f(),v(C);t.length&&t.charAt(0)!=="}"&&(N=Ie()||Ge());)N&&(C.push(N),v(C));return C}function m(N){const C=N.exec(t);if(!C)return;const R=C[0];return r(R),t=t.slice(R.length),C}function f(){m(/^\s*/)}function v(N=[]){let C;for(;C=g();)C&&N.push(C),C=g();return N}function g(){const N=o();if(t.charAt(0)!=="/"||t.charAt(1)!=="*")return;let C=2;for(;t.charAt(C)!==""&&(t.charAt(C)!=="*"||t.charAt(C+1)!=="/");)++C;if(C+=2,t.charAt(C-1)==="")return l("End of comment missing");const R=t.slice(2,C-2);return i+=2,r(R),t=t.slice(C),i+=2,N({type:"comment",comment:R})}const S=new RegExp("^(("+[/[^\\]"(?:\\"|[^"])*"/.source,/[^\\]'(?:\\'|[^'])*'/.source,"[^{]"].join("|")+")+)");function y(){for(f();t[0]=="}";)l("extra closing bracket"),t=t.slice(1),f();const N=m(S);if(!N)return;const C=N[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,R=>R.replace(/,/g,"\u200C"));return I(C).map(R=>R.replace(/\u200C/g,",").trim())}function I(N){const C=[];let R="",P=0,j=0,J=null;for(const $ of N){const Be=R.endsWith("\\");J?J===$&&!Be&&(J=null):$==="("?P++:$===")"?P--:$==="["?j++:$==="]"?j--:`'"`.includes($)&&(J=$),$===","&&P===0&&j===0?(C.push(R),R=""):R+=$}return R&&C.push(R),C}function T(){const N=o(),C=m(/^(\*?[-#\/\*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!C)return;const R=me(C[0]);if(!m(/^:\s*/))return l("property missing ':'");const P=m(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)/),j=N({type:"declaration",property:R.replace(Qt,""),value:P?me(P[0]).replace(Qt,""):""});return m(/^[;\s]*/),j}function A(){const N=[];if(!d())return l("missing '{'");v(N);let C;for(;C=T();)C!==!1&&(N.push(C),v(N)),C=T();return h()?N:l("missing '}'")}function U(){let N;const C=[],R=o();for(;N=m(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)C.push(N[1]),m(/^,\s*/);if(C.length)return R({type:"keyframe",values:C,declarations:A()})}function Y(){const N=o();let C=m(/^@([-\w]+)?keyframes\s*/);if(!C)return;const R=C[1];if(C=m(/^([-\w]+)\s*/),!C)return l("@keyframes missing name");const P=C[1];if(!d())return l("@keyframes missing '{'");let j,J=v();for(;j=U();)J.push(j),J=J.concat(v());return h()?N({type:"keyframes",name:P,vendor:R,keyframes:J}):l("@keyframes missing '}'")}function se(){const N=o(),C=m(/^@supports *([^{]+)/);if(!C)return;const R=me(C[1]);if(!d())return l("@supports missing '{'");const P=v().concat(p());return h()?N({type:"supports",supports:R,rules:P}):l("@supports missing '}'")}function K(){const N=o();if(!m(/^@host\s*/))return;if(!d())return l("@host missing '{'");const R=v().concat(p());return h()?N({type:"host",rules:R}):l("@host missing '}'")}function Q(){const N=o(),C=m(/^@media *([^{]+)/);if(!C)return;const R=me(C[1]);if(!d())return l("@media missing '{'");const P=v().concat(p());return h()?N({type:"media",media:R,rules:P}):l("@media missing '}'")}function x(){const N=o(),C=m(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(C)return N({type:"custom-media",name:me(C[1]),media:me(C[2])})}function re(){const N=o();if(!m(/^@page */))return;const R=y()||[];if(!d())return l("@page missing '{'");let P=v(),j;for(;j=T();)P.push(j),P=P.concat(v());return h()?N({type:"page",selectors:R,declarations:P}):l("@page missing '}'")}function Z(){const N=o(),C=m(/^@([-\w]+)?document *([^{]+)/);if(!C)return;const R=me(C[1]),P=me(C[2]);if(!d())return l("@document missing '{'");const j=v().concat(p());return h()?N({type:"document",document:P,vendor:R,rules:j}):l("@document missing '}'")}function ne(){const N=o();if(!m(/^@font-face\s*/))return;if(!d())return l("@font-face missing '{'");let R=v(),P;for(;P=T();)R.push(P),R=R.concat(v());return h()?N({type:"font-face",declarations:R}):l("@font-face missing '}'")}const q=le("import"),V=le("charset"),he=le("namespace");function le(N){const C=new RegExp("^@"+N+"\\s*((?:"+[/[^\\]"(?:\\"|[^"])*"/.source,/[^\\]'(?:\\'|[^'])*'/.source,"[^;]"].join("|")+")+);");return()=>{const R=o(),P=m(C);if(!P)return;const j={type:N};return j[N]=P[1].trim(),R(j)}}function Ie(){if(t[0]==="@")return Y()||Q()||x()||se()||q()||V()||he()||Z()||re()||K()||ne()}function Ge(){const N=o(),C=y();return C?(v(),N({type:"rule",selectors:C,declarations:A()})):l("selector missing")}return bt(u())}function me(t){return t?t.replace(/^\s+|\s+$/g,""):""}function bt(t,e){const s=t&&typeof t.type=="string",i=s?t:e;for(const r of Object.keys(t)){const o=t[r];Array.isArray(o)?o.forEach(a=>{bt(a,i)}):o&&typeof o=="object"&&bt(o,i)}return s&&Object.defineProperty(t,"parent",{configurable:!0,writable:!0,enumerable:!1,value:e||null}),t}const qt={script:"noscript",altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient"};function zi(t){let e=qt[t.tagName]?qt[t.tagName]:t.tagName;return e==="link"&&t.attributes._cssText&&(e="style"),e}function es(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const Os=/(max|min)-device-(width|height)/,Xi=new RegExp(Os.source,"g"),_s=/([^\\]):hover/,Zi=new RegExp(_s.source,"g");function ts(t,e){const s=e==null?void 0:e.stylesWithHoverClass.get(t);if(s)return s;const i=Hi(t,{silent:!0});if(!i.stylesheet)return t;const r=[],o=[];function a(c){"selectors"in c&&c.selectors&&c.selectors.forEach(l=>{_s.test(l)&&r.push(l)}),"media"in c&&c.media&&Os.test(c.media)&&o.push(c.media),"rules"in c&&c.rules&&c.rules.forEach(a)}a(i.stylesheet);let n=t;if(r.length>0){const c=new RegExp(r.filter((l,u)=>r.indexOf(l)===u).sort((l,u)=>u.length-l.length).map(l=>es(l)).join("|"),"g");n=n.replace(c,l=>{const u=l.replace(Zi,"$1.\\:hover");return`${l}, ${u}`})}if(o.length>0){const c=new RegExp(o.filter((l,u)=>o.indexOf(l)===u).sort((l,u)=>u.length-l.length).map(l=>es(l)).join("|"),"g");n=n.replace(c,l=>l.replace(Xi,"$1-$2"))}return e==null||e.stylesWithHoverClass.set(t,n),n}function ss(){return{stylesWithHoverClass:new Map}}function ji(t,e){var s;const{doc:i,hackCss:r,cache:o}=e;switch(t.type){case D.Document:return i.implementation.createDocument(null,"",null);case D.DocumentType:return i.implementation.createDocumentType(t.name||"html",t.publicId,t.systemId);case D.Element:{const a=zi(t);let n;t.isSVG?n=i.createElementNS("http://www.w3.org/2000/svg",a):(t.isCustom&&((s=i.defaultView)!=null&&s.customElements)&&!i.defaultView.customElements.get(t.tagName)&&i.defaultView.customElements.define(t.tagName,class extends i.defaultView.HTMLElement{}),n=i.createElement(a));const c={};for(const l in t.attributes){if(!Object.prototype.hasOwnProperty.call(t.attributes,l))continue;let u=t.attributes[l];if(a==="option"&&l==="selected"&&u===!1||u===null)continue;if(u===!0&&(u=""),l.startsWith("rr_")){c[l]=u;continue}const d=a==="textarea"&&l==="value",h=a==="style"&&l==="_cssText";if(h&&r&&typeof u=="string"&&(u=ts(u,o)),(d||h)&&typeof u=="string"){n.appendChild(i.createTextNode(u)),t.childNodes=[];continue}try{if(t.isSVG&&l==="xlink:href")n.setAttributeNS("http://www.w3.org/1999/xlink",l,u.toString());else if(l==="onload"||l==="onclick"||l.substring(0,7)==="onmouse")n.setAttribute("_"+l,u.toString());else if(a==="meta"&&t.attributes["http-equiv"]==="Content-Security-Policy"&&l==="content"){n.setAttribute("csp-content",u.toString());continue}else a==="link"&&(t.attributes.rel==="preload"||t.attributes.rel==="modulepreload")&&t.attributes.as==="script"||a==="link"&&t.attributes.rel==="prefetch"&&typeof t.attributes.href=="string"&&t.attributes.href.endsWith(".js")||(a==="img"&&t.attributes.srcset&&t.attributes.rr_dataURL?n.setAttribute("rrweb-original-srcset",t.attributes.srcset):n.setAttribute(l,u.toString()))}catch(p){}}for(const l in c){const u=c[l];if(a==="canvas"&&l==="rr_dataURL"){const d=i.createElement("img");d.onload=()=>{const h=n.getContext("2d");h&&h.drawImage(d,0,0,d.width,d.height)},d.src=u.toString(),n.RRNodeType&&(n.rr_dataURL=u.toString())}else if(a==="img"&&l==="rr_dataURL"){const d=n;d.currentSrc.startsWith("data:")||(d.setAttribute("rrweb-original-src",t.attributes.src),d.src=u.toString())}if(l==="rr_width")n.style.width=u.toString();else if(l==="rr_height")n.style.height=u.toString();else if(l==="rr_mediaCurrentTime"&&typeof u=="number")n.currentTime=u;else if(l==="rr_mediaState")switch(u){case"played":n.play().catch(d=>console.warn("media playback error",d));break;case"paused":n.pause();break}else l==="rr_mediaPlaybackRate"&&typeof u=="number"?n.playbackRate=u:l==="rr_mediaMuted"&&typeof u=="boolean"?n.muted=u:l==="rr_mediaLoop"&&typeof u=="boolean"?n.loop=u:l==="rr_mediaVolume"&&typeof u=="number"&&(n.volume=u)}if(t.isShadowHost)if(!n.shadowRoot)n.attachShadow({mode:"open"});else for(;n.shadowRoot.firstChild;)n.shadowRoot.removeChild(n.shadowRoot.firstChild);return n}case D.Text:return i.createTextNode(t.isStyle&&r?ts(t.textContent,o):t.textContent);case D.CDATA:return i.createCDATASection(t.textContent);case D.Comment:return i.createComment(t.textContent);default:return null}}function He(t,e){const{doc:s,mirror:i,skipChild:r=!1,hackCss:o=!0,afterAppend:a,cache:n}=e;if(i.has(t.id)){const l=i.getNode(t.id),u=i.getMeta(l);if(Ii(u,t))return i.getNode(t.id)}let c=ji(t,{doc:s,hackCss:o,cache:n});if(!c)return null;if(t.rootId&&i.getNode(t.rootId)!==s&&i.replace(t.rootId,s),t.type===D.Document&&(s.close(),s.open(),t.compatMode==="BackCompat"&&t.childNodes&&t.childNodes[0].type!==D.DocumentType&&(t.childNodes[0].type===D.Element&&"xmlns"in t.childNodes[0].attributes&&t.childNodes[0].attributes.xmlns==="http://www.w3.org/1999/xhtml"?s.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "">'):s.write('<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "">')),c=s),i.add(c,t),(t.type===D.Document||t.type===D.Element)&&!r)for(const l of t.childNodes){const u=He(l,{doc:s,mirror:i,skipChild:!1,hackCss:o,afterAppend:a,cache:n});if(!u){console.warn("Failed to rebuild",l);continue}if(l.isShadow&&ws(c)&&c.shadowRoot)c.shadowRoot.appendChild(u);else if(t.type===D.Document&&l.type==D.Element){const d=u;let h=null;d.childNodes.forEach(p=>{p.nodeName==="BODY"&&(h=p)}),h?(d.removeChild(h),c.appendChild(u),d.appendChild(h)):c.appendChild(u)}else c.appendChild(u);a&&a(u,l.id)}return c}function Ji(t,e){function s(i){e(i)}for(const i of t.getIds())t.has(i)&&s(t.getNode(i))}function $i(t,e){const s=e.getMeta(t);if((s==null?void 0:s.type)!==D.Element)return;const i=t;for(const r in s.attributes){if(!(Object.prototype.hasOwnProperty.call(s.attributes,r)&&r.startsWith("rr_")))continue;const o=s.attributes[r];r==="rr_scrollLeft"&&(i.scrollLeft=o),r==="rr_scrollTop"&&(i.scrollTop=o)}}function Ki(t,e){const{doc:s,onVisit:i,hackCss:r=!0,afterAppend:o,cache:a,mirror:n=new Nt}=e,c=He(t,{doc:s,mirror:n,skipChild:!1,hackCss:r,afterAppend:o,cache:a});return Ji(n,l=>{i&&i(l),$i(l,n)}),c}function ee(t,e,s=document){const i={capture:!0,passive:!0};return s.addEventListener(t,e,i),()=>s.removeEventListener(t,e,i)}const De=`Please stop import mirror directly. Instead of that,\r
now you can use replayer.getMirror() to access the mirror instance of a replayer,\r
or you can use record.mirror to access the mirror instance during recording.`;exports.mirror={map:{},getId(){return console.error(De),-1},getNode(){return console.error(De),null},removeNodeFromMap(){console.error(De)},has(){return console.error(De),!1},reset(){console.error(De)}};typeof window!="undefined"&&window.Proxy&&window.Reflect&&(exports.mirror=new Proxy(exports.mirror,{get(t,e,s){return e==="map"&&console.error(De),Reflect.get(t,e,s)}}));function Pe(t,e,s={}){let i=null,r=0;return function(...o){const a=Date.now();!r&&s.leading===!1&&(r=a);const n=e-(a-r),c=this;n<=0||n>e?(i&&(clearTimeout(i),i=null),r=a,t.apply(c,o)):!i&&s.trailing!==!1&&(i=setTimeout(()=>{r=s.leading===!1?0:Date.now(),i=null,t.apply(c,o)},n))}}function je(t,e,s,i,r=window){const o=r.Object.getOwnPropertyDescriptor(t,e);return r.Object.defineProperty(t,e,i?s:{set(a){setTimeout(()=>{s.set.call(this,a)},0),o&&o.set&&o.set.call(this,a)}}),()=>je(t,e,o||{},!0)}function Ne(t,e,s){try{if(!(e in t))return()=>{};const i=t[e],r=s(i);return typeof r=="function"&&(r.prototype=r.prototype||{},Object.defineProperties(r,{__rrweb_original__:{enumerable:!1,value:i}})),t[e]=r,()=>{t[e]=i}}catch(i){return()=>{}}}let Ze=Date.now;/[1-9][0-9]{12}/.test(Date.now().toString())||(Ze=()=>new Date().getTime());function Dt(t){var e,s,i,r,o,a;const n=t.document;return{left:n.scrollingElement?n.scrollingElement.scrollLeft:t.pageXOffset!==void 0?t.pageXOffset:(n==null?void 0:n.documentElement.scrollLeft)||((s=(e=n==null?void 0:n.body)==null?void 0:e.parentElement)==null?void 0:s.scrollLeft)||((i=n==null?void 0:n.body)==null?void 0:i.scrollLeft)||0,top:n.scrollingElement?n.scrollingElement.scrollTop:t.pageYOffset!==void 0?t.pageYOffset:(n==null?void 0:n.documentElement.scrollTop)||((o=(r=n==null?void 0:n.body)==null?void 0:r.parentElement)==null?void 0:o.scrollTop)||((a=n==null?void 0:n.body)==null?void 0:a.scrollTop)||0}}function Rt(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function At(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function xt(t){return t?t.nodeType===t.ELEMENT_NODE?t:t.parentElement:null}function te(t,e,s,i){if(!t)return!1;const r=xt(t);if(!r)return!1;try{if(typeof e=="string"){if(r.classList.contains(e)||i&&r.closest("."+e)!==null)return!0}else if(ot(r,e,i))return!0}catch(o){}return!!(s&&(r.matches(s)||i&&r.closest(s)!==null))}function Ls(t,e){return e.getId(t)!==-1}function tt(t,e,s){return t.tagName==="TITLE"&&s.headTitleMutations?!0:e.getId(t)===Xe}function kt(t,e){if(Ue(t))return!1;const s=e.getId(t);return e.has(s)?t.parentNode&&t.parentNode.nodeType===t.DOCUMENT_NODE?!1:t.parentNode?kt(t.parentNode,e):!0:!0}function at(t){return!!t.changedTouches}function Ot(t=window){"NodeList"in t&&!t.NodeList.prototype.forEach&&(t.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in t&&!t.DOMTokenList.prototype.forEach&&(t.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...e)=>{let s=e[0];if(!(0 in e))throw new TypeError("1 argument is required");do if(this===s)return!0;while(s=s&&s.parentNode);return!1})}function Fs(t){const e={},s=(r,o)=>{const a={value:r,parent:o,children:[]};return e[r.node.id]=a,a},i=[];for(const r of t){const{nextId:o,parentId:a}=r;if(o&&o in e){const n=e[o];if(n.parent){const c=n.parent.children.indexOf(n);n.parent.children.splice(c,0,s(r,n.parent))}else{const c=i.indexOf(n);i.splice(c,0,s(r,null))}continue}if(a in e){const n=e[a];n.children.push(s(r,n));continue}i.push(s(r,null))}return i}function _t(t,e){e(t.value);for(let s=t.children.length-1;s>=0;s--)_t(t.children[s],e)}function Fe(t,e){return!!(t.nodeName==="IFRAME"&&e.getMeta(t))}function Lt(t,e){return!!(t.nodeName==="LINK"&&t.nodeType===t.ELEMENT_NODE&&t.getAttribute&&t.getAttribute("rel")==="stylesheet"&&e.getMeta(t))}function Ft(t,e){var s,i;const r=(i=(s=t.ownerDocument)==null?void 0:s.defaultView)==null?void 0:i.frameElement;if(!r||r===e)return{x:0,y:0,relativeScale:1,absoluteScale:1};const o=r.getBoundingClientRect(),a=Ft(r,e),n=o.height/r.clientHeight;return{x:o.x*a.relativeScale+a.x,y:o.y*a.relativeScale+a.y,relativeScale:n,absoluteScale:a.absoluteScale*n}}function ve(t){return!!(t!=null&&t.shadowRoot)}function Oe(t,e){const s=t[e[0]];return e.length===1?s:Oe(s.cssRules[e[1]].cssRules,e.slice(2))}function St(t){const e=[...t],s=e.pop();return{positions:e,index:s}}function Ps(t){const e=new Set,s=[];for(let i=t.length;i--;){const r=t[i];e.has(r.id)||(s.push(r),e.add(r.id))}return s}class Pt{constructor(){b(this,"id",1),b(this,"styleIDMap",new WeakMap),b(this,"idStyleMap",new Map)}getId(e){var s;return(s=this.styleIDMap.get(e))!=null?s:-1}has(e){return this.styleIDMap.has(e)}add(e,s){if(this.has(e))return this.getId(e);let i;return s===void 0?i=this.id++:i=s,this.styleIDMap.set(e,i),this.idStyleMap.set(i,e),i}getStyle(e){return this.idStyleMap.get(e)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}function Wt(t){var e,s;let i=null;return((s=(e=t.getRootNode)==null?void 0:e.call(t))==null?void 0:s.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&t.getRootNode().host&&(i=t.getRootNode().host),i}function Ws(t){let e=t,s;for(;s=Wt(e);)e=s;return e}function Gs(t){const e=t.ownerDocument;if(!e)return!1;const s=Ws(t);return e.contains(s)}function Gt(t){const e=t.ownerDocument;return e?e.contains(t)||Gs(t):!1}const Qi=Object.freeze(Object.defineProperty({__proto__:null,StyleSheetMirror:Pt,get _mirror(){return exports.mirror},closestElementOfNode:xt,getBaseDimension:Ft,getNestedRule:Oe,getPositionsAndIndex:St,getRootShadowHost:Ws,getShadowHost:Wt,getWindowHeight:Rt,getWindowScroll:Dt,getWindowWidth:At,hasShadowRoot:ve,hookSetter:je,inDom:Gt,isAncestorRemoved:kt,isBlocked:te,isIgnored:tt,isSerialized:Ls,isSerializedIframe:Fe,isSerializedStylesheet:Lt,iterateResolveTree:_t,legacy_isTouchEvent:at,get nowTimestamp(){return Ze},on:ee,patch:Ne,polyfill:Ot,queueToResolveTrees:Fs,shadowHostInDom:Gs,throttle:Pe,uniqueTextMutations:Ps},Symbol.toStringTag,{value:"Module"}));var E=(t=>(t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t))(E||{}),M=(t=>(t[t.Mutation=0]="Mutation",t[t.MouseMove=1]="MouseMove",t[t.MouseInteraction=2]="MouseInteraction",t[t.Scroll=3]="Scroll",t[t.ViewportResize=4]="ViewportResize",t[t.Input=5]="Input",t[t.TouchMove=6]="TouchMove",t[t.MediaInteraction=7]="MediaInteraction",t[t.StyleSheetRule=8]="StyleSheetRule",t[t.CanvasMutation=9]="CanvasMutation",t[t.Font=10]="Font",t[t.Log=11]="Log",t[t.Drag=12]="Drag",t[t.StyleDeclaration=13]="StyleDeclaration",t[t.Selection=14]="Selection",t[t.AdoptedStyleSheet=15]="AdoptedStyleSheet",t[t.CustomElement=16]="CustomElement",t))(M||{}),L=(t=>(t[t.MouseUp=0]="MouseUp",t[t.MouseDown=1]="MouseDown",t[t.Click=2]="Click",t[t.ContextMenu=3]="ContextMenu",t[t.DblClick=4]="DblClick",t[t.Focus=5]="Focus",t[t.Blur=6]="Blur",t[t.TouchStart=7]="TouchStart",t[t.TouchMove_Departed=8]="TouchMove_Departed",t[t.TouchEnd=9]="TouchEnd",t[t.TouchCancel=10]="TouchCancel",t))(L||{}),fe=(t=>(t[t.Mouse=0]="Mouse",t[t.Pen=1]="Pen",t[t.Touch=2]="Touch",t))(fe||{}),pe=(t=>(t[t["2D"]=0]="2D",t[t.WebGL=1]="WebGL",t[t.WebGL2=2]="WebGL2",t))(pe||{}),ye=(t=>(t[t.Play=0]="Play",t[t.Pause=1]="Pause",t[t.Seeked=2]="Seeked",t[t.VolumeChange=3]="VolumeChange",t[t.RateChange=4]="RateChange",t))(ye||{}),_=(t=>(t.Start="start",t.Pause="pause",t.Resume="resume",t.Resize="resize",t.Finish="finish",t.FullsnapshotRebuilded="fullsnapshot-rebuilded",t.LoadStylesheetStart="load-stylesheet-start",t.LoadStylesheetEnd="load-stylesheet-end",t.SkipStart="skip-start",t.SkipEnd="skip-end",t.MouseInteraction="mouse-interaction",t.EventCast="event-cast",t.CustomEvent="custom-event",t.Flush="flush",t.StateChange="state-change",t.PlayBack="play-back",t.Destroy="destroy",t))(_||{});function is(t){return"__ln"in t}class qi{constructor(){b(this,"length",0),b(this,"head",null),b(this,"tail",null)}get(e){if(e>=this.length)throw new Error("Position outside of list range");let s=this.head;for(let i=0;i<e;i++)s=(s==null?void 0:s.next)||null;return s}addNode(e){const s={value:e,previous:null,next:null};if(e.__ln=s,e.previousSibling&&is(e.previousSibling)){const i=e.previousSibling.__ln.next;s.next=i,s.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=s,i&&(i.previous=s)}else if(e.nextSibling&&is(e.nextSibling)&&e.nextSibling.__ln.previous){const i=e.nextSibling.__ln.previous;s.previous=i,s.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=s,i&&(i.next=s)}else this.head&&(this.head.previous=s),s.next=this.head,this.head=s;s.next===null&&(this.tail=s),this.length++}removeNode(e){const s=e.__ln;this.head&&(s.previous?(s.previous.next=s.next,s.next?s.next.previous=s.previous:this.tail=s.previous):(this.head=s.next,this.head?this.head.previous=null:this.tail=null),e.__ln&&delete e.__ln,this.length--)}}const rs=(t,e)=>`${t}@${e}`;class er{constructor(){b(this,"frozen",!1),b(this,"locked",!1),b(this,"texts",[]),b(this,"attributes",[]),b(this,"attributeMap",new WeakMap),b(this,"removes",[]),b(this,"mapRemoves",[]),b(this,"movedMap",{}),b(this,"addedSet",new Set),b(this,"movedSet",new Set),b(this,"droppedSet",new Set),b(this,"mutationCb"),b(this,"blockClass"),b(this,"blockSelector"),b(this,"maskTextClass"),b(this,"maskTextSelector"),b(this,"inlineStylesheet"),b(this,"maskInputOptions"),b(this,"maskTextFn"),b(this,"maskInputFn"),b(this,"keepIframeSrcFn"),b(this,"recordCanvas"),b(this,"inlineImages"),b(this,"slimDOMOptions"),b(this,"dataURLOptions"),b(this,"doc"),b(this,"mirror"),b(this,"iframeManager"),b(this,"stylesheetManager"),b(this,"shadowDomManager"),b(this,"canvasManager"),b(this,"processedNodeManager"),b(this,"unattachedDoc"),b(this,"processMutations",e=>{e.forEach(this.processMutation),this.emit()}),b(this,"emit",()=>{if(this.frozen||this.locked)return;const e=[],s=new Set,i=new qi,r=c=>{let l=c,u=Xe;for(;u===Xe;)l=l&&l.nextSibling,u=l&&this.mirror.getId(l);return u},o=c=>{if(!c.parentNode||!Gt(c)||c.parentNode.tagName==="TEXTAREA")return;const l=Ue(c.parentNode)?this.mirror.getId(Wt(c)):this.mirror.getId(c.parentNode),u=r(c);if(l===-1||u===-1)return i.addNode(c);const d=ke(c,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:h=>{Fe(h,this.mirror)&&this.iframeManager.addIframe(h),Lt(h,this.mirror)&&this.stylesheetManager.trackLinkElement(h),ve(c)&&this.shadowDomManager.addShadowRoot(c.shadowRoot,this.doc)},onIframeLoad:(h,p)=>{this.iframeManager.attachIframe(h,p),this.shadowDomManager.observeAttachShadow(h)},onStylesheetLoad:(h,p)=>{this.stylesheetManager.attachLinkElement(h,p)}});d&&(e.push({parentId:l,nextId:u,node:d}),s.add(d.id))};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const c of this.movedSet)ns(this.removes,c,this.mirror)&&!this.movedSet.has(c.parentNode)||o(c);for(const c of this.addedSet)!os(this.droppedSet,c)&&!ns(this.removes,c,this.mirror)||os(this.movedSet,c)?o(c):this.droppedSet.add(c);let a=null;for(;i.length;){let c=null;if(a){const l=this.mirror.getId(a.value.parentNode),u=r(a.value);l!==-1&&u!==-1&&(c=a)}if(!c){let l=i.tail;for(;l;){const u=l;if(l=l.previous,u){const d=this.mirror.getId(u.value.parentNode);if(r(u.value)===-1)continue;if(d!==-1){c=u;break}else{const p=u.value;if(p.parentNode&&p.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const m=p.parentNode.host;if(this.mirror.getId(m)!==-1){c=u;break}}}}}}if(!c){for(;i.head;)i.removeNode(i.head.value);break}a=c.previous,i.removeNode(c.value),o(c.value)}const n={texts:this.texts.map(c=>{const l=c.node;return l.parentNode&&l.parentNode.tagName==="TEXTAREA"&&this.genTextAreaValueMutation(l.parentNode),{id:this.mirror.getId(l),value:c.value}}).filter(c=>!s.has(c.id)).filter(c=>this.mirror.has(c.id)),attributes:this.attributes.map(c=>{const{attributes:l}=c;if(typeof l.style=="string"){const u=JSON.stringify(c.styleDiff),d=JSON.stringify(c._unchangedStyles);u.length<l.style.length&&(u+d).split("var(").length===l.style.split("var(").length&&(l.style=c.styleDiff)}return{id:this.mirror.getId(c.node),attributes:l}}).filter(c=>!s.has(c.id)).filter(c=>this.mirror.has(c.id)),removes:this.removes,adds:e};!n.texts.length&&!n.attributes.length&&!n.removes.length&&!n.adds.length||(this.texts=[],this.attributes=[],this.attributeMap=new WeakMap,this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(n))}),b(this,"genTextAreaValueMutation",e=>{let s=this.attributeMap.get(e);s||(s={node:e,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(s),this.attributeMap.set(e,s)),s.attributes.value=Array.from(e.childNodes,i=>i.textContent||"").join("")}),b(this,"processMutation",e=>{if(!tt(e.target,this.mirror,this.slimDOMOptions))switch(e.type){case"characterData":{const s=e.target.textContent;!te(e.target,this.blockClass,this.blockSelector,!1)&&s!==e.oldValue&&this.texts.push({value:xs(e.target,this.maskTextClass,this.maskTextSelector,!0)&&s?this.maskTextFn?this.maskTextFn(s,xt(e.target)):s.replace(/[\S]/g,"*"):s,node:e.target});break}case"attributes":{const s=e.target;let i=e.attributeName,r=e.target.getAttribute(i);if(i==="value"){const a=Tt(s);r=Et({element:s,maskInputOptions:this.maskInputOptions,tagName:s.tagName,type:a,value:r,maskInputFn:this.maskInputFn})}if(te(e.target,this.blockClass,this.blockSelector,!1)||r===e.oldValue)return;let o=this.attributeMap.get(e.target);if(s.tagName==="IFRAME"&&i==="src"&&!this.keepIframeSrcFn(r))if(!s.contentDocument)i="rr_src";else return;if(o||(o={node:e.target,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(o),this.attributeMap.set(e.target,o)),i==="type"&&s.tagName==="INPUT"&&(e.oldValue||"").toLowerCase()==="password"&&s.setAttribute("data-rr-is-password","true"),!As(s.tagName,i)&&(o.attributes[i]=Rs(this.doc,Se(s.tagName),Se(i),r),i==="style")){if(!this.unattachedDoc)try{this.unattachedDoc=document.implementation.createHTMLDocument()}catch(n){this.unattachedDoc=this.doc}const a=this.unattachedDoc.createElement("span");e.oldValue&&a.setAttribute("style",e.oldValue);for(const n of Array.from(s.style)){const c=s.style.getPropertyValue(n),l=s.style.getPropertyPriority(n);c!==a.style.getPropertyValue(n)||l!==a.style.getPropertyPriority(n)?l===""?o.styleDiff[n]=c:o.styleDiff[n]=[c,l]:o._unchangedStyles[n]=[c,l]}for(const n of Array.from(a.style))s.style.getPropertyValue(n)===""&&(o.styleDiff[n]=!1)}break}case"childList":{if(te(e.target,this.blockClass,this.blockSelector,!0))return;if(e.target.tagName==="TEXTAREA"){this.genTextAreaValueMutation(e.target);return}e.addedNodes.forEach(s=>this.genAdds(s,e.target)),e.removedNodes.forEach(s=>{const i=this.mirror.getId(s),r=Ue(e.target)?this.mirror.getId(e.target.host):this.mirror.getId(e.target);te(e.target,this.blockClass,this.blockSelector,!1)||tt(s,this.mirror,this.slimDOMOptions)||!Ls(s,this.mirror)||(this.addedSet.has(s)?(Ct(this.addedSet,s),this.droppedSet.add(s)):this.addedSet.has(e.target)&&i===-1||kt(e.target,this.mirror)||(this.movedSet.has(s)&&this.movedMap[rs(i,r)]?Ct(this.movedSet,s):this.removes.push({parentId:r,id:i,isShadow:Ue(e.target)&&Ye(e.target)?!0:void 0})),this.mapRemoves.push(s))});break}}}),b(this,"genAdds",(e,s)=>{if(!this.processedNodeManager.inOtherBuffer(e,this)&&!(this.addedSet.has(e)||this.movedSet.has(e))){if(this.mirror.hasNode(e)){if(tt(e,this.mirror,this.slimDOMOptions))return;this.movedSet.add(e);let i=null;s&&this.mirror.hasNode(s)&&(i=this.mirror.getId(s)),i&&i!==-1&&(this.movedMap[rs(this.mirror.getId(e),i)]=!0)}else this.addedSet.add(e),this.droppedSet.delete(e);te(e,this.blockClass,this.blockSelector,!1)||(e.childNodes.forEach(i=>this.genAdds(i)),ve(e)&&e.shadowRoot.childNodes.forEach(i=>{this.processedNodeManager.add(i,this),this.genAdds(i,e)}))}})}init(e){["mutationCb","blockClass","blockSelector","maskTextClass","maskTextSelector","inlineStylesheet","maskInputOptions","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager","processedNodeManager"].forEach(s=>{this[s]=e[s]})}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function Ct(t,e){t.delete(e),e.childNodes.forEach(s=>Ct(t,s))}function ns(t,e,s){return t.length===0?!1:tr(t,e,s)}function tr(t,e,s){let i=e.parentNode;for(;i;){const r=s.getId(i);if(t.some(o=>o.id===r))return!0;i=i.parentNode}return!1}function os(t,e){return t.size===0?!1:Bs(t,e)}function Bs(t,e){const{parentNode:s}=e;return s?t.has(s)?!0:Bs(t,s):!1}let ze;function sr(t){ze=t}function ir(){ze=void 0}const O=t=>ze?(...s)=>{try{return t(...s)}catch(i){if(ze&&ze(i)===!0)return;throw i}}:t,we=[];function Je(t){try{if("composedPath"in t){const e=t.composedPath();if(e.length)return e[0]}else if("path"in t&&t.path.length)return t.path[0]}catch(e){}return t&&t.target}function Vs(t,e){var s,i;const r=new er;we.push(r),r.init(t);let o=window.MutationObserver||window.__rrMutationObserver;const a=(i=(s=window==null?void 0:window.Zone)==null?void 0:s.__symbol__)==null?void 0:i.call(s,"MutationObserver");a&&window[a]&&(o=window[a]);const n=new o(O(r.processMutations.bind(r)));return n.observe(e,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),n}function rr({mousemoveCb:t,sampling:e,doc:s,mirror:i}){if(e.mousemove===!1)return()=>{};const r=typeof e.mousemove=="number"?e.mousemove:50,o=typeof e.mousemoveCallback=="number"?e.mousemoveCallback:500;let a=[],n;const c=Pe(O(d=>{const h=Date.now()-n;t(a.map(p=>(p.timeOffset-=h,p)),d),a=[],n=null}),o),l=O(Pe(O(d=>{const h=Je(d),{clientX:p,clientY:m}=at(d)?d.changedTouches[0]:d;n||(n=Ze()),a.push({x:p,y:m,id:i.getId(h),timeOffset:Ze()-n}),c(typeof DragEvent!="undefined"&&d instanceof DragEvent?M.Drag:d instanceof MouseEvent?M.MouseMove:M.TouchMove)}),r,{trailing:!1})),u=[ee("mousemove",l,s),ee("touchmove",l,s),ee("drag",l,s)];return O(()=>{u.forEach(d=>d())})}function nr({mouseInteractionCb:t,doc:e,mirror:s,blockClass:i,blockSelector:r,sampling:o}){if(o.mouseInteraction===!1)return()=>{};const a=o.mouseInteraction===!0||o.mouseInteraction===void 0?{}:o.mouseInteraction,n=[];let c=null;const l=u=>d=>{const h=Je(d);if(te(h,i,r,!0))return;let p=null,m=u;if("pointerType"in d){switch(d.pointerType){case"mouse":p=fe.Mouse;break;case"touch":p=fe.Touch;break;case"pen":p=fe.Pen;break}p===fe.Touch?L[u]===L.MouseDown?m="TouchStart":L[u]===L.MouseUp&&(m="TouchEnd"):fe.Pen}else at(d)&&(p=fe.Touch);p!==null?(c=p,(m.startsWith("Touch")&&p===fe.Touch||m.startsWith("Mouse")&&p===fe.Mouse)&&(p=null)):L[u]===L.Click&&(p=c,c=null);const f=at(d)?d.changedTouches[0]:d;if(!f)return;const v=s.getId(h),{clientX:g,clientY:S}=f;O(t)(G({type:L[m],id:v,x:g,y:S},p!==null&&{pointerType:p}))};return Object.keys(L).filter(u=>Number.isNaN(Number(u))&&!u.endsWith("_Departed")&&a[u]!==!1).forEach(u=>{let d=Se(u);const h=l(u);if(window.PointerEvent)switch(L[u]){case L.MouseDown:case L.MouseUp:d=d.replace("mouse","pointer");break;case L.TouchStart:case L.TouchEnd:return}n.push(ee(d,h,e))}),O(()=>{n.forEach(u=>u())})}function Us({scrollCb:t,doc:e,mirror:s,blockClass:i,blockSelector:r,sampling:o}){const a=O(Pe(O(n=>{const c=Je(n);if(!c||te(c,i,r,!0))return;const l=s.getId(c);if(c===e&&e.defaultView){const u=Dt(e.defaultView);t({id:l,x:u.left,y:u.top})}else t({id:l,x:c.scrollLeft,y:c.scrollTop})}),o.scroll||100));return ee("scroll",a,e)}function or({viewportResizeCb:t},{win:e}){let s=-1,i=-1;const r=O(Pe(O(()=>{const o=Rt(),a=At();(s!==o||i!==a)&&(t({width:Number(a),height:Number(o)}),s=o,i=a)}),200));return ee("resize",r,e)}const ar=["INPUT","TEXTAREA","SELECT"],as=new WeakMap;function lr({inputCb:t,doc:e,mirror:s,blockClass:i,blockSelector:r,ignoreClass:o,ignoreSelector:a,maskInputOptions:n,maskInputFn:c,sampling:l,userTriggeredOnInput:u}){function d(S){let y=Je(S);const I=S.isTrusted,T=y&&y.tagName;if(y&&T==="OPTION"&&(y=y.parentElement),!y||!T||ar.indexOf(T)<0||te(y,i,r,!0)||y.classList.contains(o)||a&&y.matches(a))return;let A=y.value,U=!1;const Y=Tt(y)||"";Y==="radio"||Y==="checkbox"?U=y.checked:(n[T.toLowerCase()]||n[Y])&&(A=Et({element:y,maskInputOptions:n,tagName:T,type:Y,value:A,maskInputFn:c})),h(y,u?{text:A,isChecked:U,userTriggered:I}:{text:A,isChecked:U});const se=y.name;Y==="radio"&&se&&U&&e.querySelectorAll(`input[type="radio"][name="${se}"]`).forEach(K=>{if(K!==y){const Q=K.value;h(K,u?{text:Q,isChecked:!U,userTriggered:!1}:{text:Q,isChecked:!U})}})}function h(S,y){const I=as.get(S);if(!I||I.text!==y.text||I.isChecked!==y.isChecked){as.set(S,y);const T=s.getId(S);O(t)(ue(G({},y),{id:T}))}}const m=(l.input==="last"?["change"]:["input","change"]).map(S=>ee(S,O(d),e)),f=e.defaultView;if(!f)return()=>{m.forEach(S=>S())};const v=f.Object.getOwnPropertyDescriptor(f.HTMLInputElement.prototype,"value"),g=[[f.HTMLInputElement.prototype,"value"],[f.HTMLInputElement.prototype,"checked"],[f.HTMLSelectElement.prototype,"value"],[f.HTMLTextAreaElement.prototype,"value"],[f.HTMLSelectElement.prototype,"selectedIndex"],[f.HTMLOptionElement.prototype,"selected"]];return v&&v.set&&m.push(...g.map(S=>je(S[0],S[1],{set(){O(d)({target:this,isTrusted:!1})}},!1,f))),O(()=>{m.forEach(S=>S())})}function lt(t){const e=[];function s(i,r){if(Qe("CSSGroupingRule")&&i.parentRule instanceof CSSGroupingRule||Qe("CSSMediaRule")&&i.parentRule instanceof CSSMediaRule||Qe("CSSSupportsRule")&&i.parentRule instanceof CSSSupportsRule||Qe("CSSConditionRule")&&i.parentRule instanceof CSSConditionRule){const a=Array.from(i.parentRule.cssRules).indexOf(i);r.unshift(a)}else if(i.parentStyleSheet){const a=Array.from(i.parentStyleSheet.cssRules).indexOf(i);r.unshift(a)}return r}return s(t,e)}function ge(t,e,s){let i,r;return t?(t.ownerNode?i=e.getId(t.ownerNode):r=s.getId(t),{styleId:r,id:i}):{}}function cr({styleSheetRuleCb:t,mirror:e,stylesheetManager:s},{win:i}){if(!i.CSSStyleSheet||!i.CSSStyleSheet.prototype)return()=>{};const r=i.CSSStyleSheet.prototype.insertRule;i.CSSStyleSheet.prototype.insertRule=new Proxy(r,{apply:O((u,d,h)=>{const[p,m]=h,{id:f,styleId:v}=ge(d,e,s.styleMirror);return(f&&f!==-1||v&&v!==-1)&&t({id:f,styleId:v,adds:[{rule:p,index:m}]}),u.apply(d,h)})});const o=i.CSSStyleSheet.prototype.deleteRule;i.CSSStyleSheet.prototype.deleteRule=new Proxy(o,{apply:O((u,d,h)=>{const[p]=h,{id:m,styleId:f}=ge(d,e,s.styleMirror);return(m&&m!==-1||f&&f!==-1)&&t({id:m,styleId:f,removes:[{index:p}]}),u.apply(d,h)})});let a;i.CSSStyleSheet.prototype.replace&&(a=i.CSSStyleSheet.prototype.replace,i.CSSStyleSheet.prototype.replace=new Proxy(a,{apply:O((u,d,h)=>{const[p]=h,{id:m,styleId:f}=ge(d,e,s.styleMirror);return(m&&m!==-1||f&&f!==-1)&&t({id:m,styleId:f,replace:p}),u.apply(d,h)})}));let n;i.CSSStyleSheet.prototype.replaceSync&&(n=i.CSSStyleSheet.prototype.replaceSync,i.CSSStyleSheet.prototype.replaceSync=new Proxy(n,{apply:O((u,d,h)=>{const[p]=h,{id:m,styleId:f}=ge(d,e,s.styleMirror);return(m&&m!==-1||f&&f!==-1)&&t({id:m,styleId:f,replaceSync:p}),u.apply(d,h)})}));const c={};qe("CSSGroupingRule")?c.CSSGroupingRule=i.CSSGroupingRule:(qe("CSSMediaRule")&&(c.CSSMediaRule=i.CSSMediaRule),qe("CSSConditionRule")&&(c.CSSConditionRule=i.CSSConditionRule),qe("CSSSupportsRule")&&(c.CSSSupportsRule=i.CSSSupportsRule));const l={};return Object.entries(c).forEach(([u,d])=>{l[u]={insertRule:d.prototype.insertRule,deleteRule:d.prototype.deleteRule},d.prototype.insertRule=new Proxy(l[u].insertRule,{apply:O((h,p,m)=>{const[f,v]=m,{id:g,styleId:S}=ge(p.parentStyleSheet,e,s.styleMirror);return(g&&g!==-1||S&&S!==-1)&&t({id:g,styleId:S,adds:[{rule:f,index:[...lt(p),v||0]}]}),h.apply(p,m)})}),d.prototype.deleteRule=new Proxy(l[u].deleteRule,{apply:O((h,p,m)=>{const[f]=m,{id:v,styleId:g}=ge(p.parentStyleSheet,e,s.styleMirror);return(v&&v!==-1||g&&g!==-1)&&t({id:v,styleId:g,removes:[{index:[...lt(p),f]}]}),h.apply(p,m)})})}),O(()=>{i.CSSStyleSheet.prototype.insertRule=r,i.CSSStyleSheet.prototype.deleteRule=o,a&&(i.CSSStyleSheet.prototype.replace=a),n&&(i.CSSStyleSheet.prototype.replaceSync=n),Object.entries(c).forEach(([u,d])=>{d.prototype.insertRule=l[u].insertRule,d.prototype.deleteRule=l[u].deleteRule})})}function Ys({mirror:t,stylesheetManager:e},s){var i,r,o;let a=null;s.nodeName==="#document"?a=t.getId(s):a=t.getId(s.host);const n=s.nodeName==="#document"?(i=s.defaultView)==null?void 0:i.Document:(o=(r=s.ownerDocument)==null?void 0:r.defaultView)==null?void 0:o.ShadowRoot,c=n!=null&&n.prototype?Object.getOwnPropertyDescriptor(n==null?void 0:n.prototype,"adoptedStyleSheets"):void 0;return a===null||a===-1||!n||!c?()=>{}:(Object.defineProperty(s,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get(){var l;return(l=c.get)==null?void 0:l.call(this)},set(l){var u;const d=(u=c.set)==null?void 0:u.call(this,l);if(a!==null&&a!==-1)try{e.adoptStyleSheets(l,a)}catch(h){}return d}}),O(()=>{Object.defineProperty(s,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get:c.get,set:c.set})}))}function ur({styleDeclarationCb:t,mirror:e,ignoreCSSAttributes:s,stylesheetManager:i},{win:r}){const o=r.CSSStyleDeclaration.prototype.setProperty;r.CSSStyleDeclaration.prototype.setProperty=new Proxy(o,{apply:O((n,c,l)=>{var u;const[d,h,p]=l;if(s.has(d))return o.apply(c,[d,h,p]);const{id:m,styleId:f}=ge((u=c.parentRule)==null?void 0:u.parentStyleSheet,e,i.styleMirror);return(m&&m!==-1||f&&f!==-1)&&t({id:m,styleId:f,set:{property:d,value:h,priority:p},index:lt(c.parentRule)}),n.apply(c,l)})});const a=r.CSSStyleDeclaration.prototype.removeProperty;return r.CSSStyleDeclaration.prototype.removeProperty=new Proxy(a,{apply:O((n,c,l)=>{var u;const[d]=l;if(s.has(d))return a.apply(c,[d]);const{id:h,styleId:p}=ge((u=c.parentRule)==null?void 0:u.parentStyleSheet,e,i.styleMirror);return(h&&h!==-1||p&&p!==-1)&&t({id:h,styleId:p,remove:{property:d},index:lt(c.parentRule)}),n.apply(c,l)})}),O(()=>{r.CSSStyleDeclaration.prototype.setProperty=o,r.CSSStyleDeclaration.prototype.removeProperty=a})}function dr({mediaInteractionCb:t,blockClass:e,blockSelector:s,mirror:i,sampling:r,doc:o}){const a=O(c=>Pe(O(l=>{const u=Je(l);if(!u||te(u,e,s,!0))return;const{currentTime:d,volume:h,muted:p,playbackRate:m,loop:f}=u;t({type:c,id:i.getId(u),currentTime:d,volume:h,muted:p,playbackRate:m,loop:f})}),r.media||500)),n=[ee("play",a(ye.Play),o),ee("pause",a(ye.Pause),o),ee("seeked",a(ye.Seeked),o),ee("volumechange",a(ye.VolumeChange),o),ee("ratechange",a(ye.RateChange),o)];return O(()=>{n.forEach(c=>c())})}function hr({fontCb:t,doc:e}){const s=e.defaultView;if(!s)return()=>{};const i=[],r=new WeakMap,o=s.FontFace;s.FontFace=function(c,l,u){const d=new o(c,l,u);return r.set(d,{family:c,buffer:typeof l!="string",descriptors:u,fontSource:typeof l=="string"?l:JSON.stringify(Array.from(new Uint8Array(l)))}),d};const a=Ne(e.fonts,"add",function(n){return function(c){return setTimeout(O(()=>{const l=r.get(c);l&&(t(l),r.delete(c))}),0),n.apply(this,[c])}});return i.push(()=>{s.FontFace=o}),i.push(a),O(()=>{i.forEach(n=>n())})}function fr(t){const{doc:e,mirror:s,blockClass:i,blockSelector:r,selectionCb:o}=t;let a=!0;const n=O(()=>{const c=e.getSelection();if(!c||a&&(c!=null&&c.isCollapsed))return;a=c.isCollapsed||!1;const l=[],u=c.rangeCount||0;for(let d=0;d<u;d++){const h=c.getRangeAt(d),{startContainer:p,startOffset:m,endContainer:f,endOffset:v}=h;te(p,i,r,!0)||te(f,i,r,!0)||l.push({start:s.getId(p),startOffset:m,end:s.getId(f),endOffset:v})}o({ranges:l})});return n(),ee("selectionchange",n)}function pr({doc:t,customElementCb:e}){const s=t.defaultView;return!s||!s.customElements?()=>{}:Ne(s.customElements,"define",function(r){return function(o,a,n){try{e({define:{name:o}})}catch(c){console.warn(`Custom element callback failed for ${o}`)}return r.apply(this,[o,a,n])}})}function mr(t,e){const{mutationCb:s,mousemoveCb:i,mouseInteractionCb:r,scrollCb:o,viewportResizeCb:a,inputCb:n,mediaInteractionCb:c,styleSheetRuleCb:l,styleDeclarationCb:u,canvasMutationCb:d,fontCb:h,selectionCb:p,customElementCb:m}=t;t.mutationCb=(...f)=>{e.mutation&&e.mutation(...f),s(...f)},t.mousemoveCb=(...f)=>{e.mousemove&&e.mousemove(...f),i(...f)},t.mouseInteractionCb=(...f)=>{e.mouseInteraction&&e.mouseInteraction(...f),r(...f)},t.scrollCb=(...f)=>{e.scroll&&e.scroll(...f),o(...f)},t.viewportResizeCb=(...f)=>{e.viewportResize&&e.viewportResize(...f),a(...f)},t.inputCb=(...f)=>{e.input&&e.input(...f),n(...f)},t.mediaInteractionCb=(...f)=>{e.mediaInteaction&&e.mediaInteaction(...f),c(...f)},t.styleSheetRuleCb=(...f)=>{e.styleSheetRule&&e.styleSheetRule(...f),l(...f)},t.styleDeclarationCb=(...f)=>{e.styleDeclaration&&e.styleDeclaration(...f),u(...f)},t.canvasMutationCb=(...f)=>{e.canvasMutation&&e.canvasMutation(...f),d(...f)},t.fontCb=(...f)=>{e.font&&e.font(...f),h(...f)},t.selectionCb=(...f)=>{e.selection&&e.selection(...f),p(...f)},t.customElementCb=(...f)=>{e.customElement&&e.customElement(...f),m(...f)}}function gr(t,e={}){const s=t.doc.defaultView;if(!s)return()=>{};mr(t,e);let i;t.recordDOM&&(i=Vs(t,t.doc));const r=rr(t),o=nr(t),a=Us(t),n=or(t,{win:s}),c=lr(t),l=dr(t);let u=()=>{},d=()=>{},h=()=>{},p=()=>{};t.recordDOM&&(u=cr(t,{win:s}),d=Ys(t,t.doc),h=ur(t,{win:s}),t.collectFonts&&(p=hr(t)));const m=fr(t),f=pr(t),v=[];for(const g of t.plugins)v.push(g.observer(g.callback,s,g.options));return O(()=>{we.forEach(g=>g.reset()),i==null||i.disconnect(),r(),o(),a(),n(),c(),l(),u(),d(),h(),p(),m(),f(),v.forEach(g=>g())})}function Qe(t){return typeof window[t]!="undefined"}function qe(t){return!!(typeof window[t]!="undefined"&&window[t].prototype&&"insertRule"in window[t].prototype&&"deleteRule"in window[t].prototype)}class ls{constructor(e){b(this,"iframeIdToRemoteIdMap",new WeakMap),b(this,"iframeRemoteIdToIdMap",new WeakMap),this.generateIdFn=e}getId(e,s,i,r){const o=i||this.getIdToRemoteIdMap(e),a=r||this.getRemoteIdToIdMap(e);let n=o.get(s);return n||(n=this.generateIdFn(),o.set(s,n),a.set(n,s)),n}getIds(e,s){const i=this.getIdToRemoteIdMap(e),r=this.getRemoteIdToIdMap(e);return s.map(o=>this.getId(e,o,i,r))}getRemoteId(e,s,i){const r=i||this.getRemoteIdToIdMap(e);if(typeof s!="number")return s;const o=r.get(s);return o||-1}getRemoteIds(e,s){const i=this.getRemoteIdToIdMap(e);return s.map(r=>this.getRemoteId(e,r,i))}reset(e){if(!e){this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap;return}this.iframeIdToRemoteIdMap.delete(e),this.iframeRemoteIdToIdMap.delete(e)}getIdToRemoteIdMap(e){let s=this.iframeIdToRemoteIdMap.get(e);return s||(s=new Map,this.iframeIdToRemoteIdMap.set(e,s)),s}getRemoteIdToIdMap(e){let s=this.iframeRemoteIdToIdMap.get(e);return s||(s=new Map,this.iframeRemoteIdToIdMap.set(e,s)),s}}class yr{constructor(e){b(this,"iframes",new WeakMap),b(this,"crossOriginIframeMap",new WeakMap),b(this,"crossOriginIframeMirror",new ls(Ds)),b(this,"crossOriginIframeStyleMirror"),b(this,"crossOriginIframeRootIdMap",new WeakMap),b(this,"mirror"),b(this,"mutationCb"),b(this,"wrappedEmit"),b(this,"loadListener"),b(this,"stylesheetManager"),b(this,"recordCrossOriginIframes"),this.mutationCb=e.mutationCb,this.wrappedEmit=e.wrappedEmit,this.stylesheetManager=e.stylesheetManager,this.recordCrossOriginIframes=e.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new ls(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=e.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(e){this.iframes.set(e,!0),e.contentWindow&&this.crossOriginIframeMap.set(e.contentWindow,e)}addLoadListener(e){this.loadListener=e}attachIframe(e,s){var i,r;this.mutationCb({adds:[{parentId:this.mirror.getId(e),nextId:null,node:s}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),this.recordCrossOriginIframes&&((i=e.contentWindow)==null||i.addEventListener("message",this.handleMessage.bind(this))),(r=this.loadListener)==null||r.call(this,e),e.contentDocument&&e.contentDocument.adoptedStyleSheets&&e.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(e.contentDocument.adoptedStyleSheets,this.mirror.getId(e.contentDocument))}handleMessage(e){const s=e;if(s.data.type!=="rrweb"||s.origin!==s.data.origin||!e.source)return;const r=this.crossOriginIframeMap.get(e.source);if(!r)return;const o=this.transformCrossOriginEvent(r,s.data.event);o&&this.wrappedEmit(o,s.data.isCheckout)}transformCrossOriginEvent(e,s){var i;switch(s.type){case E.FullSnapshot:{this.crossOriginIframeMirror.reset(e),this.crossOriginIframeStyleMirror.reset(e),this.replaceIdOnNode(s.data.node,e);const r=s.data.node.id;return this.crossOriginIframeRootIdMap.set(e,r),this.patchRootIdOnNode(s.data.node,r),{timestamp:s.timestamp,type:E.IncrementalSnapshot,data:{source:M.Mutation,adds:[{parentId:this.mirror.getId(e),nextId:null,node:s.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}}}case E.Meta:case E.Load:case E.DomContentLoaded:return!1;case E.Plugin:return s;case E.Custom:return this.replaceIds(s.data.payload,e,["id","parentId","previousId","nextId"]),s;case E.IncrementalSnapshot:switch(s.data.source){case M.Mutation:return s.data.adds.forEach(r=>{this.replaceIds(r,e,["parentId","nextId","previousId"]),this.replaceIdOnNode(r.node,e);const o=this.crossOriginIframeRootIdMap.get(e);o&&this.patchRootIdOnNode(r.node,o)}),s.data.removes.forEach(r=>{this.replaceIds(r,e,["parentId","id"])}),s.data.attributes.forEach(r=>{this.replaceIds(r,e,["id"])}),s.data.texts.forEach(r=>{this.replaceIds(r,e,["id"])}),s;case M.Drag:case M.TouchMove:case M.MouseMove:return s.data.positions.forEach(r=>{this.replaceIds(r,e,["id"])}),s;case M.ViewportResize:return!1;case M.MediaInteraction:case M.MouseInteraction:case M.Scroll:case M.CanvasMutation:case M.Input:return this.replaceIds(s.data,e,["id"]),s;case M.StyleSheetRule:case M.StyleDeclaration:return this.replaceIds(s.data,e,["id"]),this.replaceStyleIds(s.data,e,["styleId"]),s;case M.Font:return s;case M.Selection:return s.data.ranges.forEach(r=>{this.replaceIds(r,e,["start","end"])}),s;case M.AdoptedStyleSheet:return this.replaceIds(s.data,e,["id"]),this.replaceStyleIds(s.data,e,["styleIds"]),(i=s.data.styles)==null||i.forEach(r=>{this.replaceStyleIds(r,e,["styleId"])}),s}}return!1}replace(e,s,i,r){for(const o of r)!Array.isArray(s[o])&&typeof s[o]!="number"||(Array.isArray(s[o])?s[o]=e.getIds(i,s[o]):s[o]=e.getId(i,s[o]));return s}replaceIds(e,s,i){return this.replace(this.crossOriginIframeMirror,e,s,i)}replaceStyleIds(e,s,i){return this.replace(this.crossOriginIframeStyleMirror,e,s,i)}replaceIdOnNode(e,s){this.replaceIds(e,s,["id","rootId"]),"childNodes"in e&&e.childNodes.forEach(i=>{this.replaceIdOnNode(i,s)})}patchRootIdOnNode(e,s){e.type!==D.Document&&!e.rootId&&(e.rootId=s),"childNodes"in e&&e.childNodes.forEach(i=>{this.patchRootIdOnNode(i,s)})}}class vr{constructor(e){b(this,"shadowDoms",new WeakSet),b(this,"mutationCb"),b(this,"scrollCb"),b(this,"bypassOptions"),b(this,"mirror"),b(this,"restoreHandlers",[]),this.mutationCb=e.mutationCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror,this.init()}init(){this.reset(),this.patchAttachShadow(Element,document)}addShadowRoot(e,s){if(!Ye(e)||this.shadowDoms.has(e))return;this.shadowDoms.add(e);const i=Vs(ue(G({},this.bypassOptions),{doc:s,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),e);this.restoreHandlers.push(()=>i.disconnect()),this.restoreHandlers.push(Us(ue(G({},this.bypassOptions),{scrollCb:this.scrollCb,doc:e,mirror:this.mirror}))),setTimeout(()=>{e.adoptedStyleSheets&&e.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(e.adoptedStyleSheets,this.mirror.getId(e.host)),this.restoreHandlers.push(Ys({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},e))},0)}observeAttachShadow(e){!e.contentWindow||!e.contentDocument||this.patchAttachShadow(e.contentWindow.Element,e.contentDocument)}patchAttachShadow(e,s){const i=this;this.restoreHandlers.push(Ne(e.prototype,"attachShadow",function(r){return function(o){const a=r.call(this,o);return this.shadowRoot&&Gt(this)&&i.addShadowRoot(this.shadowRoot,s),a}}))}reset(){this.restoreHandlers.forEach(e=>{try{e()}catch(s){}}),this.restoreHandlers=[],this.shadowDoms=new WeakSet}}var _e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ve=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(var et=0;et<_e.length;et++)Ve[_e.charCodeAt(et)]=et;var br=function(t){var e=new Uint8Array(t),s,i=e.length,r="";for(s=0;s<i;s+=3)r+=_e[e[s]>>2],r+=_e[(e[s]&3)<<4|e[s+1]>>4],r+=_e[(e[s+1]&15)<<2|e[s+2]>>6],r+=_e[e[s+2]&63];return i%3===2?r=r.substring(0,r.length-1)+"=":i%3===1&&(r=r.substring(0,r.length-2)+"=="),r},Sr=function(t){var e=t.length*.75,s=t.length,i,r=0,o,a,n,c;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);var l=new ArrayBuffer(e),u=new Uint8Array(l);for(i=0;i<s;i+=4)o=Ve[t.charCodeAt(i)],a=Ve[t.charCodeAt(i+1)],n=Ve[t.charCodeAt(i+2)],c=Ve[t.charCodeAt(i+3)],u[r++]=o<<2|a>>4,u[r++]=(a&15)<<4|n>>2,u[r++]=(n&3)<<6|c&63;return l};const cs=new Map;function Cr(t,e){let s=cs.get(t);return s||(s=new Map,cs.set(t,s)),s.has(e)||s.set(e,[]),s.get(e)}const Hs=(t,e,s)=>{if(!t||!(Xs(t,e)||typeof t=="object"))return;const i=t.constructor.name,r=Cr(s,i);let o=r.indexOf(t);return o===-1&&(o=r.length,r.push(t)),o};function st(t,e,s){if(t instanceof Array)return t.map(i=>st(i,e,s));if(t===null)return t;if(t instanceof Float32Array||t instanceof Float64Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Int8Array||t instanceof Uint8ClampedArray)return{rr_type:t.constructor.name,args:[Object.values(t)]};if(t instanceof ArrayBuffer){const i=t.constructor.name,r=br(t);return{rr_type:i,base64:r}}else{if(t instanceof DataView)return{rr_type:t.constructor.name,args:[st(t.buffer,e,s),t.byteOffset,t.byteLength]};if(t instanceof HTMLImageElement){const i=t.constructor.name,{src:r}=t;return{rr_type:i,src:r}}else if(t instanceof HTMLCanvasElement){const i="HTMLImageElement",r=t.toDataURL();return{rr_type:i,src:r}}else{if(t instanceof ImageData)return{rr_type:t.constructor.name,args:[st(t.data,e,s),t.width,t.height]};if(Xs(t,e)||typeof t=="object"){const i=t.constructor.name,r=Hs(t,e,s);return{rr_type:i,index:r}}}}return t}const zs=(t,e,s)=>t.map(i=>st(i,e,s)),Xs=(t,e)=>!!["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter(r=>typeof e[r]=="function").find(r=>t instanceof e[r]);function Ir(t,e,s,i){const r=[],o=Object.getOwnPropertyNames(e.CanvasRenderingContext2D.prototype);for(const a of o)try{if(typeof e.CanvasRenderingContext2D.prototype[a]!="function")continue;const n=Ne(e.CanvasRenderingContext2D.prototype,a,function(c){return function(...l){return te(this.canvas,s,i,!0)||setTimeout(()=>{const u=zs(l,e,this);t(this.canvas,{type:pe["2D"],property:a,args:u})},0),c.apply(this,l)}});r.push(n)}catch(n){const c=je(e.CanvasRenderingContext2D.prototype,a,{set(l){t(this.canvas,{type:pe["2D"],property:a,args:[l],setter:!0})}});r.push(c)}return()=>{r.forEach(a=>a())}}function Mr(t){return t==="experimental-webgl"?"webgl":t}function us(t,e,s,i){const r=[];try{const o=Ne(t.HTMLCanvasElement.prototype,"getContext",function(a){return function(n,...c){if(!te(this,e,s,!0)){const l=Mr(n);if("__context"in this||(this.__context=l),i&&["webgl","webgl2"].includes(l))if(c[0]&&typeof c[0]=="object"){const u=c[0];u.preserveDrawingBuffer||(u.preserveDrawingBuffer=!0)}else c.splice(0,1,{preserveDrawingBuffer:!0})}return a.apply(this,[n,...c])}});r.push(o)}catch(o){console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{r.forEach(o=>o())}}function ds(t,e,s,i,r,o,a){const n=[],c=Object.getOwnPropertyNames(t);for(const l of c)if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(l))try{if(typeof t[l]!="function")continue;const u=Ne(t,l,function(d){return function(...h){const p=d.apply(this,h);if(Hs(p,a,this),"tagName"in this.canvas&&!te(this.canvas,i,r,!0)){const m=zs(h,a,this),f={type:e,property:l,args:m};s(this.canvas,f)}return p}});n.push(u)}catch(u){const d=je(t,l,{set(h){s(this.canvas,{type:e,property:l,args:[h],setter:!0})}});n.push(d)}return n}function wr(t,e,s,i,r){const o=[];return o.push(...ds(e.WebGLRenderingContext.prototype,pe.WebGL,t,s,i,r,e)),typeof e.WebGL2RenderingContext!="undefined"&&o.push(...ds(e.WebGL2RenderingContext.prototype,pe.WebGL2,t,s,i,r,e)),()=>{o.forEach(a=>a())}}const Zs="KGZ1bmN0aW9uKCkgewogICJ1c2Ugc3RyaWN0IjsKICB2YXIgY2hhcnMgPSAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyI7CiAgdmFyIGxvb2t1cCA9IHR5cGVvZiBVaW50OEFycmF5ID09PSAidW5kZWZpbmVkIiA/IFtdIDogbmV3IFVpbnQ4QXJyYXkoMjU2KTsKICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYXJzLmxlbmd0aDsgaSsrKSB7CiAgICBsb29rdXBbY2hhcnMuY2hhckNvZGVBdChpKV0gPSBpOwogIH0KICB2YXIgZW5jb2RlID0gZnVuY3Rpb24oYXJyYXlidWZmZXIpIHsKICAgIHZhciBieXRlcyA9IG5ldyBVaW50OEFycmF5KGFycmF5YnVmZmVyKSwgaTIsIGxlbiA9IGJ5dGVzLmxlbmd0aCwgYmFzZTY0ID0gIiI7CiAgICBmb3IgKGkyID0gMDsgaTIgPCBsZW47IGkyICs9IDMpIHsKICAgICAgYmFzZTY0ICs9IGNoYXJzW2J5dGVzW2kyXSA+PiAyXTsKICAgICAgYmFzZTY0ICs9IGNoYXJzWyhieXRlc1tpMl0gJiAzKSA8PCA0IHwgYnl0ZXNbaTIgKyAxXSA+PiA0XTsKICAgICAgYmFzZTY0ICs9IGNoYXJzWyhieXRlc1tpMiArIDFdICYgMTUpIDw8IDIgfCBieXRlc1tpMiArIDJdID4+IDZdOwogICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaTIgKyAyXSAmIDYzXTsKICAgIH0KICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgIj0iOwogICAgfSBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgIj09IjsKICAgIH0KICAgIHJldHVybiBiYXNlNjQ7CiAgfTsKICBjb25zdCBsYXN0QmxvYk1hcCA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKTsKICBhc3luYyBmdW5jdGlvbiBnZXRUcmFuc3BhcmVudEJsb2JGb3Iod2lkdGgsIGhlaWdodCwgZGF0YVVSTE9wdGlvbnMpIHsKICAgIGNvbnN0IGlkID0gYCR7d2lkdGh9LSR7aGVpZ2h0fWA7CiAgICBpZiAoIk9mZnNjcmVlbkNhbnZhcyIgaW4gZ2xvYmFsVGhpcykgewogICAgICBpZiAodHJhbnNwYXJlbnRCbG9iTWFwLmhhcyhpZCkpCiAgICAgICAgcmV0dXJuIHRyYW5zcGFyZW50QmxvYk1hcC5nZXQoaWQpOwogICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOwogICAgICBvZmZzY3JlZW4uZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgY29uc3QgYmxvYiA9IGF3YWl0IG9mZnNjcmVlbi5jb252ZXJ0VG9CbG9iKGRhdGFVUkxPcHRpb25zKTsKICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBibG9iLmFycmF5QnVmZmVyKCk7CiAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7CiAgICAgIHRyYW5zcGFyZW50QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7CiAgICAgIHJldHVybiBiYXNlNjQ7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gIiI7CiAgICB9CiAgfQogIGNvbnN0IHdvcmtlciA9IHNlbGY7CiAgd29ya2VyLm9ubWVzc2FnZSA9IGFzeW5jIGZ1bmN0aW9uKGUpIHsKICAgIGlmICgiT2Zmc2NyZWVuQ2FudmFzIiBpbiBnbG9iYWxUaGlzKSB7CiAgICAgIGNvbnN0IHsgaWQsIGJpdG1hcCwgd2lkdGgsIGhlaWdodCwgZGF0YVVSTE9wdGlvbnMgfSA9IGUuZGF0YTsKICAgICAgY29uc3QgdHJhbnNwYXJlbnRCYXNlNjQgPSBnZXRUcmFuc3BhcmVudEJsb2JGb3IoCiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0LAogICAgICAgIGRhdGFVUkxPcHRpb25zCiAgICAgICk7CiAgICAgIGNvbnN0IG9mZnNjcmVlbiA9IG5ldyBPZmZzY3JlZW5DYW52YXMod2lkdGgsIGhlaWdodCk7CiAgICAgIGNvbnN0IGN0eCA9IG9mZnNjcmVlbi5nZXRDb250ZXh0KCIyZCIpOwogICAgICBjdHguZHJhd0ltYWdlKGJpdG1hcCwgMCwgMCk7CiAgICAgIGJpdG1hcC5jbG9zZSgpOwogICAgICBjb25zdCBibG9iID0gYXdhaXQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOwogICAgICBjb25zdCB0eXBlID0gYmxvYi50eXBlOwogICAgICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IGJsb2IuYXJyYXlCdWZmZXIoKTsKICAgICAgY29uc3QgYmFzZTY0ID0gZW5jb2RlKGFycmF5QnVmZmVyKTsKICAgICAgaWYgKCFsYXN0QmxvYk1hcC5oYXMoaWQpICYmIGF3YWl0IHRyYW5zcGFyZW50QmFzZTY0ID09PSBiYXNlNjQpIHsKICAgICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7CiAgICAgICAgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7IGlkIH0pOwogICAgICB9CiAgICAgIGlmIChsYXN0QmxvYk1hcC5nZXQoaWQpID09PSBiYXNlNjQpCiAgICAgICAgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7IGlkIH0pOwogICAgICB3b3JrZXIucG9zdE1lc3NhZ2UoewogICAgICAgIGlkLAogICAgICAgIHR5cGUsCiAgICAgICAgYmFzZTY0LAogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodAogICAgICB9KTsKICAgICAgbGFzdEJsb2JNYXAuc2V0KGlkLCBiYXNlNjQpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7IGlkOiBlLmRhdGEuaWQgfSk7CiAgICB9CiAgfTsKfSkoKTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW1hZ2UtYml0bWFwLWRhdGEtdXJsLXdvcmtlci1CWjFyN1JKRC5qcy5tYXAK",Nr=t=>Uint8Array.from(atob(t),e=>e.charCodeAt(0)),hs=typeof window!="undefined"&&window.Blob&&new Blob([Nr(Zs)],{type:"text/javascript;charset=utf-8"});function Er(t){let e;try{if(e=hs&&(window.URL||window.webkitURL).createObjectURL(hs),!e)throw"";const s=new Worker(e,{name:t==null?void 0:t.name});return s.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(e)}),s}catch(s){return new Worker("data:text/javascript;base64,"+Zs,{name:t==null?void 0:t.name})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}class Tr{constructor(e){b(this,"pendingCanvasMutations",new Map),b(this,"rafStamps",{latestId:0,invokeId:null}),b(this,"mirror"),b(this,"mutationCb"),b(this,"resetObservers"),b(this,"frozen",!1),b(this,"locked",!1),b(this,"processMutation",(c,l)=>{(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId||!this.rafStamps.invokeId)&&(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(c)||this.pendingCanvasMutations.set(c,[]),this.pendingCanvasMutations.get(c).push(l)});const{sampling:s="all",win:i,blockClass:r,blockSelector:o,recordCanvas:a,dataURLOptions:n}=e;this.mutationCb=e.mutationCb,this.mirror=e.mirror,a&&s==="all"&&this.initCanvasMutationObserver(i,r,o),a&&typeof s=="number"&&this.initCanvasFPSObserver(s,i,r,o,{dataURLOptions:n})}reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}initCanvasFPSObserver(e,s,i,r,o){const a=us(s,i,r,!0),n=new Map,c=new Er;c.onmessage=m=>{const{id:f}=m.data;if(n.set(f,!1),!("base64"in m.data))return;const{base64:v,type:g,width:S,height:y}=m.data;this.mutationCb({id:f,type:pe["2D"],commands:[{property:"clearRect",args:[0,0,S,y]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:v}],type:g}]},0,0]}]})};const l=1e3/e;let u=0,d;const h=()=>{const m=[];return s.document.querySelectorAll("canvas").forEach(f=>{te(f,i,r,!0)||m.push(f)}),m},p=m=>{if(u&&m-u<l){d=requestAnimationFrame(p);return}u=m,h().forEach(async f=>{var v;const g=this.mirror.getId(f);if(n.get(g)||f.width===0||f.height===0)return;if(n.set(g,!0),["webgl","webgl2"].includes(f.__context)){const y=f.getContext(f.__context);((v=y==null?void 0:y.getContextAttributes())==null?void 0:v.preserveDrawingBuffer)===!1&&y.clear(y.COLOR_BUFFER_BIT)}const S=await createImageBitmap(f);c.postMessage({id:g,bitmap:S,width:f.width,height:f.height,dataURLOptions:o.dataURLOptions},[S])}),d=requestAnimationFrame(p)};d=requestAnimationFrame(p),this.resetObservers=()=>{a(),cancelAnimationFrame(d)}}initCanvasMutationObserver(e,s,i){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();const r=us(e,s,i,!1),o=Ir(this.processMutation.bind(this),e,s,i),a=wr(this.processMutation.bind(this),e,s,i,this.mirror);this.resetObservers=()=>{r(),o(),a()}}startPendingCanvasMutationFlusher(){requestAnimationFrame(()=>this.flushPendingCanvasMutations())}startRAFTimestamping(){const e=s=>{this.rafStamps.latestId=s,requestAnimationFrame(e)};requestAnimationFrame(e)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach((e,s)=>{const i=this.mirror.getId(s);this.flushPendingCanvasMutationFor(s,i)}),requestAnimationFrame(()=>this.flushPendingCanvasMutations())}flushPendingCanvasMutationFor(e,s){if(this.frozen||this.locked)return;const i=this.pendingCanvasMutations.get(e);if(!i||s===-1)return;const r=i.map(a=>{const l=a,{type:n}=l;return Zt(l,["type"])}),{type:o}=i[0];this.mutationCb({id:s,type:o,commands:r}),this.pendingCanvasMutations.delete(e)}}class Dr{constructor(e){b(this,"trackedLinkElements",new WeakSet),b(this,"mutationCb"),b(this,"adoptedStyleSheetCb"),b(this,"styleMirror",new Pt),this.mutationCb=e.mutationCb,this.adoptedStyleSheetCb=e.adoptedStyleSheetCb}attachLinkElement(e,s){"_cssText"in s.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:s.id,attributes:s.attributes}]}),this.trackLinkElement(e)}trackLinkElement(e){this.trackedLinkElements.has(e)||(this.trackedLinkElements.add(e),this.trackStylesheetInLinkElement(e))}adoptStyleSheets(e,s){if(e.length===0)return;const i={id:s,styleIds:[]},r=[];for(const o of e){let a;this.styleMirror.has(o)?a=this.styleMirror.getId(o):(a=this.styleMirror.add(o),r.push({styleId:a,rules:Array.from(o.rules||CSSRule,(n,c)=>({rule:Ns(n),index:c}))})),i.styleIds.push(a)}r.length>0&&(i.styles=r),this.adoptedStyleSheetCb(i)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(e){}}class Rr{constructor(){b(this,"nodeMap",new WeakMap),b(this,"active",!1)}inOtherBuffer(e,s){const i=this.nodeMap.get(e);return i&&Array.from(i).some(r=>r!==s)}add(e,s){this.active||(this.active=!0,requestAnimationFrame(()=>{this.nodeMap=new WeakMap,this.active=!1})),this.nodeMap.set(e,(this.nodeMap.get(e)||new Set).add(s))}destroy(){}}let X,it,gt,ct=!1;try{if(Array.from([1],t=>t*2)[0]!==2){const t=document.createElement("iframe");document.body.appendChild(t),Array.from=((jt=t.contentWindow)==null?void 0:jt.Array.from)||Array.from,document.body.removeChild(t)}}catch(t){console.debug("Unable to override Array.from",t)}const ae=Es();function Ee(t={}){const{emit:e,checkoutEveryNms:s,checkoutEveryNth:i,blockClass:r="rr-block",blockSelector:o=null,ignoreClass:a="rr-ignore",ignoreSelector:n=null,maskTextClass:c="rr-mask",maskTextSelector:l=null,inlineStylesheet:u=!0,maskAllInputs:d,maskInputOptions:h,slimDOMOptions:p,maskInputFn:m,maskTextFn:f,hooks:v,packFn:g,sampling:S={},dataURLOptions:y={},mousemoveWait:I,recordDOM:T=!0,recordCanvas:A=!1,recordCrossOriginIframes:U=!1,recordAfter:Y=t.recordAfter==="DOMContentLoaded"?t.recordAfter:"load",userTriggeredOnInput:se=!1,collectFonts:K=!1,inlineImages:Q=!1,plugins:x,keepIframeSrcFn:re=()=>!1,ignoreCSSAttributes:Z=new Set([]),errorHandler:ne}=t;sr(ne);const q=U?window.parent===window:!0;let V=!1;if(!q)try{window.parent.document&&(V=!1)}catch(F){V=!0}if(q&&!e)throw new Error("emit function is required");if(!q&&!V)return()=>{};I!==void 0&&S.mousemove===void 0&&(S.mousemove=I),ae.reset();const he=d===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:h!==void 0?h:{password:!0},le=p===!0||p==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:p==="all",headMetaDescKeywords:p==="all",headTitleMutations:p==="all"}:p||{};Ot();let Ie,Ge=0;const N=F=>{for(const oe of x||[])oe.eventProcessor&&(F=oe.eventProcessor(F));return g&&!V&&(F=g(F)),F};X=(F,oe)=>{var H;const z=F;if(z.timestamp=Ze(),(H=we[0])!=null&&H.isFrozen()&&z.type!==E.FullSnapshot&&!(z.type===E.IncrementalSnapshot&&z.data.source===M.Mutation)&&we.forEach(ce=>ce.unfreeze()),q)e==null||e(N(z),oe);else if(V){const ce={type:"rrweb",event:N(z),origin:window.location.origin,isCheckout:oe};window.parent.postMessage(ce,"*")}if(z.type===E.FullSnapshot)Ie=z,Ge=0;else if(z.type===E.IncrementalSnapshot){if(z.data.source===M.Mutation&&z.data.isAttachIframe)return;Ge++;const ce=i&&Ge>=i,W=s&&z.timestamp-Ie.timestamp>s;(ce||W)&&it(!0)}};const C=F=>{X({type:E.IncrementalSnapshot,data:G({source:M.Mutation},F)})},R=F=>X({type:E.IncrementalSnapshot,data:G({source:M.Scroll},F)}),P=F=>X({type:E.IncrementalSnapshot,data:G({source:M.CanvasMutation},F)}),j=F=>X({type:E.IncrementalSnapshot,data:G({source:M.AdoptedStyleSheet},F)}),J=new Dr({mutationCb:C,adoptedStyleSheetCb:j}),$=new yr({mirror:ae,mutationCb:C,stylesheetManager:J,recordCrossOriginIframes:U,wrappedEmit:X});for(const F of x||[])F.getMirror&&F.getMirror({nodeMirror:ae,crossOriginIframeMirror:$.crossOriginIframeMirror,crossOriginIframeStyleMirror:$.crossOriginIframeStyleMirror});const Be=new Rr;gt=new Tr({recordCanvas:A,mutationCb:P,win:window,blockClass:r,blockSelector:o,mirror:ae,sampling:S.canvas,dataURLOptions:y});const $e=new vr({mutationCb:C,scrollCb:R,bypassOptions:{blockClass:r,blockSelector:o,maskTextClass:c,maskTextSelector:l,inlineStylesheet:u,maskInputOptions:he,dataURLOptions:y,maskTextFn:f,maskInputFn:m,recordCanvas:A,inlineImages:Q,sampling:S,slimDOMOptions:le,iframeManager:$,stylesheetManager:J,canvasManager:gt,keepIframeSrcFn:re,processedNodeManager:Be},mirror:ae});it=(F=!1)=>{if(!T)return;X({type:E.Meta,data:{href:window.location.href,width:At(),height:Rt()}},F),J.reset(),$e.init(),we.forEach(H=>H.lock());const oe=Yi(document,{mirror:ae,blockClass:r,blockSelector:o,maskTextClass:c,maskTextSelector:l,inlineStylesheet:u,maskAllInputs:he,maskTextFn:f,slimDOM:le,dataURLOptions:y,recordCanvas:A,inlineImages:Q,onSerialize:H=>{Fe(H,ae)&&$.addIframe(H),Lt(H,ae)&&J.trackLinkElement(H),ve(H)&&$e.addShadowRoot(H.shadowRoot,document)},onIframeLoad:(H,z)=>{$.attachIframe(H,z),$e.observeAttachShadow(H)},onStylesheetLoad:(H,z)=>{J.attachLinkElement(H,z)},keepIframeSrcFn:re});if(!oe)return console.warn("Failed to snapshot the document");X({type:E.FullSnapshot,data:{node:oe,initialOffset:Dt(window)}},F),we.forEach(H=>H.unlock()),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&J.adoptStyleSheets(document.adoptedStyleSheets,ae.getId(document))};try{const F=[],oe=z=>{var ce;return O(gr)({mutationCb:C,mousemoveCb:(W,mt)=>X({type:E.IncrementalSnapshot,data:{source:mt,positions:W}}),mouseInteractionCb:W=>X({type:E.IncrementalSnapshot,data:G({source:M.MouseInteraction},W)}),scrollCb:R,viewportResizeCb:W=>X({type:E.IncrementalSnapshot,data:G({source:M.ViewportResize},W)}),inputCb:W=>X({type:E.IncrementalSnapshot,data:G({source:M.Input},W)}),mediaInteractionCb:W=>X({type:E.IncrementalSnapshot,data:G({source:M.MediaInteraction},W)}),styleSheetRuleCb:W=>X({type:E.IncrementalSnapshot,data:G({source:M.StyleSheetRule},W)}),styleDeclarationCb:W=>X({type:E.IncrementalSnapshot,data:G({source:M.StyleDeclaration},W)}),canvasMutationCb:P,fontCb:W=>X({type:E.IncrementalSnapshot,data:G({source:M.Font},W)}),selectionCb:W=>{X({type:E.IncrementalSnapshot,data:G({source:M.Selection},W)})},customElementCb:W=>{X({type:E.IncrementalSnapshot,data:G({source:M.CustomElement},W)})},blockClass:r,ignoreClass:a,ignoreSelector:n,maskTextClass:c,maskTextSelector:l,maskInputOptions:he,inlineStylesheet:u,sampling:S,recordDOM:T,recordCanvas:A,inlineImages:Q,userTriggeredOnInput:se,collectFonts:K,doc:z,maskInputFn:m,maskTextFn:f,keepIframeSrcFn:re,blockSelector:o,slimDOMOptions:le,dataURLOptions:y,mirror:ae,iframeManager:$,stylesheetManager:J,shadowDomManager:$e,processedNodeManager:Be,canvasManager:gt,ignoreCSSAttributes:Z,plugins:((ce=x==null?void 0:x.filter(W=>W.observer))==null?void 0:ce.map(W=>({observer:W.observer,options:W.options,callback:mt=>X({type:E.Plugin,data:{plugin:W.name,payload:mt}})})))||[]},v)};$.addLoadListener(z=>{try{F.push(oe(z.contentDocument))}catch(ce){console.warn(ce)}});const H=()=>{it(),F.push(oe(document)),ct=!0};return document.readyState==="interactive"||document.readyState==="complete"?H():(F.push(ee("DOMContentLoaded",()=>{X({type:E.DomContentLoaded,data:{}}),Y==="DOMContentLoaded"&&H()})),F.push(ee("load",()=>{X({type:E.Load,data:{}}),Y==="load"&&H()},window))),()=>{F.forEach(z=>z()),Be.destroy(),ct=!1,ir()}}catch(F){console.warn(F)}}Ee.addCustomEvent=(t,e)=>{if(!ct)throw new Error("please add custom event after start recording");X({type:E.Custom,data:{tag:t,payload:e}})};Ee.freezePage=()=>{we.forEach(t=>t.freeze())};Ee.takeFullSnapshot=t=>{if(!ct)throw new Error("please take full snapshot after start recording");it(t)};Ee.mirror=ae;var Ar=Object.defineProperty,xr=(t,e,s)=>e in t?Ar(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,w=(t,e,s)=>(xr(t,typeof e!="symbol"?e+"":e,s),s),kr=Object.defineProperty,Or=(t,e,s)=>e in t?kr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,fs=(t,e,s)=>(Or(t,typeof e!="symbol"?e+"":e,s),s),k=(t=>(t[t.Document=0]="Document",t[t.DocumentType=1]="DocumentType",t[t.Element=2]="Element",t[t.Text=3]="Text",t[t.CDATA=4]="CDATA",t[t.Comment=5]="Comment",t))(k||{});let _r=class{constructor(){fs(this,"idNodeMap",new Map),fs(this,"nodeMetaMap",new WeakMap)}getId(e){var s;if(!e)return-1;const i=(s=this.getMeta(e))==null?void 0:s.id;return i!=null?i:-1}getNode(e){return this.idNodeMap.get(e)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(e){return this.nodeMetaMap.get(e)||null}removeNodeFromMap(e){const s=this.getId(e);this.idNodeMap.delete(s),e.childNodes&&e.childNodes.forEach(i=>this.removeNodeFromMap(i))}has(e){return this.idNodeMap.has(e)}hasNode(e){return this.nodeMetaMap.has(e)}add(e,s){const i=s.id;this.idNodeMap.set(i,e),this.nodeMetaMap.set(e,s)}replace(e,s){const i=this.getNode(e);if(i){const r=this.nodeMetaMap.get(i);r&&this.nodeMetaMap.set(s,r)}this.idNodeMap.set(e,s)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}};function Lr(){return new _r}function Fr(t){const e={},s=/;(?![^(]*\))/g,i=/:(.+)/,r=/\/\*.*?\*\//g;return t.replace(r,"").split(s).forEach(function(o){if(o){const a=o.split(i);a.length>1&&(e[It(a[0].trim())]=a[1].trim())}}),e}function ps(t){const e=[];for(const s in t){const i=t[s];if(typeof i!="string")continue;const r=Br(s);e.push(`${r}: ${i};`)}return e.join(" ")}const Pr=/-([a-z])/g,Wr=/^--[a-zA-Z0-9-]+$/,It=t=>Wr.test(t)?t:t.replace(Pr,(e,s)=>s?s.toUpperCase():""),Gr=/\B([A-Z])/g,Br=t=>t.replace(Gr,"-$1").toLowerCase();class Ce{constructor(...e){w(this,"parentElement",null),w(this,"parentNode",null),w(this,"ownerDocument"),w(this,"firstChild",null),w(this,"lastChild",null),w(this,"previousSibling",null),w(this,"nextSibling",null),w(this,"ELEMENT_NODE",1),w(this,"TEXT_NODE",3),w(this,"nodeType"),w(this,"nodeName"),w(this,"RRNodeType")}get childNodes(){const e=[];let s=this.firstChild;for(;s;)e.push(s),s=s.nextSibling;return e}contains(e){if(e instanceof Ce){if(e.ownerDocument!==this.ownerDocument)return!1;if(e===this)return!0}else return!1;for(;e.parentNode;){if(e.parentNode===this)return!0;e=e.parentNode}return!1}appendChild(e){throw new Error("RRDomException: Failed to execute 'appendChild' on 'RRNode': This RRNode type does not support this method.")}insertBefore(e,s){throw new Error("RRDomException: Failed to execute 'insertBefore' on 'RRNode': This RRNode type does not support this method.")}removeChild(e){throw new Error("RRDomException: Failed to execute 'removeChild' on 'RRNode': This RRNode type does not support this method.")}toString(){return"RRNode"}}class Bt extends Ce{constructor(...e){super(e),w(this,"nodeType",9),w(this,"nodeName","#document"),w(this,"compatMode","CSS1Compat"),w(this,"RRNodeType",k.Document),w(this,"textContent",null),this.ownerDocument=this}get documentElement(){return this.childNodes.find(e=>e.RRNodeType===k.Element&&e.tagName==="HTML")||null}get body(){var e;return((e=this.documentElement)==null?void 0:e.childNodes.find(s=>s.RRNodeType===k.Element&&s.tagName==="BODY"))||null}get head(){var e;return((e=this.documentElement)==null?void 0:e.childNodes.find(s=>s.RRNodeType===k.Element&&s.tagName==="HEAD"))||null}get implementation(){return this}get firstElementChild(){return this.documentElement}appendChild(e){const s=e.RRNodeType;if((s===k.Element||s===k.DocumentType)&&this.childNodes.some(r=>r.RRNodeType===s))throw new Error(`RRDomException: Failed to execute 'appendChild' on 'RRNode': Only one ${s===k.Element?"RRElement":"RRDoctype"} on RRDocument allowed.`);const i=Ut(this,e);return i.parentElement=null,i}insertBefore(e,s){const i=e.RRNodeType;if((i===k.Element||i===k.DocumentType)&&this.childNodes.some(o=>o.RRNodeType===i))throw new Error(`RRDomException: Failed to execute 'insertBefore' on 'RRNode': Only one ${i===k.Element?"RRElement":"RRDoctype"} on RRDocument allowed.`);const r=Qs(this,e,s);return r.parentElement=null,r}removeChild(e){return qs(this,e)}open(){this.firstChild=null,this.lastChild=null}close(){}write(e){let s;if(e==='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "">'?s="-//W3C//DTD XHTML 1.0 Transitional//EN":e==='<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "">'&&(s="-//W3C//DTD HTML 4.0 Transitional//EN"),s){const i=this.createDocumentType("html",s,"");this.open(),this.appendChild(i)}}createDocument(e,s,i){return new Bt}createDocumentType(e,s,i){const r=new js(e,s,i);return r.ownerDocument=this,r}createElement(e){const s=new Vt(e);return s.ownerDocument=this,s}createElementNS(e,s){return this.createElement(s)}createTextNode(e){const s=new Js(e);return s.ownerDocument=this,s}createComment(e){const s=new $s(e);return s.ownerDocument=this,s}createCDATASection(e){const s=new Ks(e);return s.ownerDocument=this,s}toString(){return"RRDocument"}}class js extends Ce{constructor(e,s,i){super(),w(this,"nodeType",10),w(this,"RRNodeType",k.DocumentType),w(this,"name"),w(this,"publicId"),w(this,"systemId"),w(this,"textContent",null),this.name=e,this.publicId=s,this.systemId=i,this.nodeName=e}toString(){return"RRDocumentType"}}class Vt extends Ce{constructor(e){super(),w(this,"nodeType",1),w(this,"RRNodeType",k.Element),w(this,"tagName"),w(this,"attributes",{}),w(this,"shadowRoot",null),w(this,"scrollLeft"),w(this,"scrollTop"),this.tagName=e.toUpperCase(),this.nodeName=e.toUpperCase()}get textContent(){let e="";return this.childNodes.forEach(s=>e+=s.textContent),e}set textContent(e){this.firstChild=null,this.lastChild=null,this.appendChild(this.ownerDocument.createTextNode(e))}get classList(){return new Ur(this.attributes.class,e=>{this.attributes.class=e})}get id(){return this.attributes.id||""}get className(){return this.attributes.class||""}get style(){const e=this.attributes.style?Fr(this.attributes.style):{},s=/\B([A-Z])/g;return e.setProperty=(i,r,o)=>{if(s.test(i))return;const a=It(i);r?e[a]=r:delete e[a],o==="important"&&(e[a]+=" !important"),this.attributes.style=ps(e)},e.removeProperty=i=>{if(s.test(i))return"";const r=It(i),o=e[r]||"";return delete e[r],this.attributes.style=ps(e),o},e}getAttribute(e){return this.attributes[e]||null}setAttribute(e,s){this.attributes[e]=s}setAttributeNS(e,s,i){this.setAttribute(s,i)}removeAttribute(e){delete this.attributes[e]}appendChild(e){return Ut(this,e)}insertBefore(e,s){return Qs(this,e,s)}removeChild(e){return qs(this,e)}attachShadow(e){const s=this.ownerDocument.createElement("SHADOWROOT");return this.shadowRoot=s,s}dispatchEvent(e){return!0}toString(){let e="";for(const s in this.attributes)e+=`${s}="${this.attributes[s]}" `;return`${this.tagName} ${e}`}}class Vr extends Vt{constructor(){super(...arguments),w(this,"currentTime"),w(this,"volume"),w(this,"paused"),w(this,"muted"),w(this,"playbackRate"),w(this,"loop")}attachShadow(e){throw new Error("RRDomException: Failed to execute 'attachShadow' on 'RRElement': This RRElement does not support attachShadow")}play(){this.paused=!1}pause(){this.paused=!0}}class Js extends Ce{constructor(e){super(),w(this,"nodeType",3),w(this,"nodeName","#text"),w(this,"RRNodeType",k.Text),w(this,"data"),this.data=e}get textContent(){return this.data}set textContent(e){this.data=e}toString(){return`RRText text=${JSON.stringify(this.data)}`}}class $s extends Ce{constructor(e){super(),w(this,"nodeType",8),w(this,"nodeName","#comment"),w(this,"RRNodeType",k.Comment),w(this,"data"),this.data=e}get textContent(){return this.data}set textContent(e){this.data=e}toString(){return`RRComment text=${JSON.stringify(this.data)}`}}class Ks extends Ce{constructor(e){super(),w(this,"nodeName","#cdata-section"),w(this,"nodeType",4),w(this,"RRNodeType",k.CDATA),w(this,"data"),this.data=e}get textContent(){return this.data}set textContent(e){this.data=e}toString(){return`RRCDATASection data=${JSON.stringify(this.data)}`}}class Ur{constructor(e,s){if(w(this,"onChange"),w(this,"classes",[]),w(this,"add",(...i)=>{for(const r of i){const o=String(r);this.classes.indexOf(o)>=0||this.classes.push(o)}this.onChange&&this.onChange(this.classes.join(" "))}),w(this,"remove",(...i)=>{this.classes=this.classes.filter(r=>i.indexOf(r)===-1),this.onChange&&this.onChange(this.classes.join(" "))}),e){const i=e.trim().split(/\s+/);this.classes.push(...i)}this.onChange=s}}function Ut(t,e){return e.parentNode&&e.parentNode.removeChild(e),t.lastChild?(t.lastChild.nextSibling=e,e.previousSibling=t.lastChild):(t.firstChild=e,e.previousSibling=null),t.lastChild=e,e.nextSibling=null,e.parentNode=t,e.parentElement=t,e.ownerDocument=t.ownerDocument,e}function Qs(t,e,s){if(!s)return Ut(t,e);if(s.parentNode!==t)throw new Error("Failed to execute 'insertBefore' on 'RRNode': The RRNode before which the new node is to be inserted is not a child of this RRNode.");return e===s||(e.parentNode&&e.parentNode.removeChild(e),e.previousSibling=s.previousSibling,s.previousSibling=e,e.nextSibling=s,e.previousSibling?e.previousSibling.nextSibling=e:t.firstChild=e,e.parentElement=t,e.parentNode=t,e.ownerDocument=t.ownerDocument),e}function qs(t,e){if(e.parentNode!==t)throw new Error("Failed to execute 'removeChild' on 'RRNode': The RRNode to be removed is not a child of this RRNode.");return e.previousSibling?e.previousSibling.nextSibling=e.nextSibling:t.firstChild=e.nextSibling,e.nextSibling?e.nextSibling.previousSibling=e.previousSibling:t.lastChild=e.previousSibling,e.previousSibling=null,e.nextSibling=null,e.parentElement=null,e.parentNode=null,e}var ie=(t=>(t[t.PLACEHOLDER=0]="PLACEHOLDER",t[t.ELEMENT_NODE=1]="ELEMENT_NODE",t[t.ATTRIBUTE_NODE=2]="ATTRIBUTE_NODE",t[t.TEXT_NODE=3]="TEXT_NODE",t[t.CDATA_SECTION_NODE=4]="CDATA_SECTION_NODE",t[t.ENTITY_REFERENCE_NODE=5]="ENTITY_REFERENCE_NODE",t[t.ENTITY_NODE=6]="ENTITY_NODE",t[t.PROCESSING_INSTRUCTION_NODE=7]="PROCESSING_INSTRUCTION_NODE",t[t.COMMENT_NODE=8]="COMMENT_NODE",t[t.DOCUMENT_NODE=9]="DOCUMENT_NODE",t[t.DOCUMENT_TYPE_NODE=10]="DOCUMENT_TYPE_NODE",t[t.DOCUMENT_FRAGMENT_NODE=11]="DOCUMENT_FRAGMENT_NODE",t))(ie||{});const Mt={svg:"http://www.w3.org/2000/svg","xlink:href":"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/xmlns/"},Yr={altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient"};let de=null;function ut(t,e,s,i=e.mirror||e.ownerDocument.mirror){t=Hr(t,e,s,i),ei(t,e,s,i),zr(t,e,s)}function Hr(t,e,s,i){var r;if(s.afterAppend&&!de&&(de=new WeakSet,setTimeout(()=>{de=null},0)),!Yt(t,e)){const o=dt(e,s.mirror,i);(r=t.parentNode)==null||r.replaceChild(o,t),t=o}switch(e.RRNodeType){case k.Document:{if(!Re(t,e,s.mirror,i)){const o=i.getMeta(e);o&&(s.mirror.removeNodeFromMap(t),t.close(),t.open(),s.mirror.add(t,o),de==null||de.add(t))}break}case k.Element:{const o=t,a=e;switch(a.tagName){case"IFRAME":{const n=t.contentDocument;if(!n)break;ut(n,e.contentDocument,s,i);break}}a.shadowRoot&&(o.shadowRoot||o.attachShadow({mode:"open"}),ei(o.shadowRoot,a.shadowRoot,s,i)),Xr(o,a,i);break}}return t}function zr(t,e,s){var i;switch(e.RRNodeType){case k.Document:{const r=e.scrollData;r&&s.applyScroll(r,!0);break}case k.Element:{const r=t,o=e;switch(o.scrollData&&s.applyScroll(o.scrollData,!0),o.inputData&&s.applyInput(o.inputData),o.tagName){case"AUDIO":case"VIDEO":{const a=t,n=o;n.paused!==void 0&&(n.paused?a.pause():a.play()),n.muted!==void 0&&(a.muted=n.muted),n.volume!==void 0&&(a.volume=n.volume),n.currentTime!==void 0&&(a.currentTime=n.currentTime),n.playbackRate!==void 0&&(a.playbackRate=n.playbackRate),n.loop!==void 0&&(a.loop=n.loop);break}case"CANVAS":{const a=e;if(a.rr_dataURL!==null){const n=document.createElement("img");n.onload=()=>{const c=r.getContext("2d");c&&c.drawImage(n,0,0,n.width,n.height)},n.src=a.rr_dataURL}a.canvasMutations.forEach(n=>s.applyCanvas(n.event,n.mutation,t));break}case"STYLE":{const a=r.sheet;a&&e.rules.forEach(n=>s.applyStyleSheetMutation(n,a));break}}break}case k.Text:case k.Comment:case k.CDATA:{t.textContent!==e.data&&(t.textContent=e.data);break}}de!=null&&de.has(t)&&(de.delete(t),(i=s.afterAppend)==null||i.call(s,t,s.mirror.getId(t)))}function Xr(t,e,s){const i=t.attributes,r=e.attributes;for(const o in r){const a=r[o],n=s.getMeta(e);if(n!=null&&n.isSVG&&Mt[o])t.setAttributeNS(Mt[o],o,a);else if(e.tagName==="CANVAS"&&o==="rr_dataURL"){const c=document.createElement("img");c.src=a,c.onload=()=>{const l=t.getContext("2d");l&&l.drawImage(c,0,0,c.width,c.height)}}else{if(e.tagName==="IFRAME"&&o==="srcdoc")continue;t.setAttribute(o,a)}}for(const{name:o}of Array.from(i))o in r||t.removeAttribute(o);e.scrollLeft&&(t.scrollLeft=e.scrollLeft),e.scrollTop&&(t.scrollTop=e.scrollTop)}function ei(t,e,s,i){const r=Array.from(t.childNodes),o=e.childNodes;if(r.length===0&&o.length===0)return;let a=0,n=r.length-1,c=0,l=o.length-1,u=r[a],d=r[n],h=o[c],p=o[l],m,f;for(;a<=n&&c<=l;)if(u===void 0)u=r[++a];else if(d===void 0)d=r[--n];else if(Re(u,h,s.mirror,i))u=r[++a],h=o[++c];else if(Re(d,p,s.mirror,i))d=r[--n],p=o[--l];else if(Re(u,p,s.mirror,i)){try{t.insertBefore(u,d.nextSibling)}catch(S){console.warn(S)}u=r[++a],p=o[--l]}else if(Re(d,h,s.mirror,i)){try{t.insertBefore(d,u)}catch(S){console.warn(S)}d=r[--n],h=o[++c]}else{if(!m){m={};for(let y=a;y<=n;y++){const I=r[y];I&&s.mirror.hasNode(I)&&(m[s.mirror.getId(I)]=y)}}f=m[i.getId(h)];const S=r[f];if(f!==void 0&&S&&Re(S,h,s.mirror,i)){try{t.insertBefore(S,u)}catch(y){console.warn(y)}r[f]=void 0}else{const y=dt(h,s.mirror,i);t.nodeName==="#document"&&u&&(y.nodeType===y.DOCUMENT_TYPE_NODE&&u.nodeType===u.DOCUMENT_TYPE_NODE||y.nodeType===y.ELEMENT_NODE&&u.nodeType===u.ELEMENT_NODE)&&(t.removeChild(u),s.mirror.removeNodeFromMap(u),u=r[++a]);try{t.insertBefore(y,u||null)}catch(I){console.warn(I)}}h=o[++c]}if(a>n){const S=o[l+1];let y=null;for(S&&(y=s.mirror.getNode(i.getId(S)));c<=l;++c){const I=dt(o[c],s.mirror,i);try{t.insertBefore(I,y)}catch(T){console.warn(T)}}}else if(c>l)for(;a<=n;a++){const S=r[a];if(!(!S||S.parentNode!==t))try{t.removeChild(S),s.mirror.removeNodeFromMap(S)}catch(y){console.warn(y)}}let v=t.firstChild,g=e.firstChild;for(;v!==null&&g!==null;)ut(v,g,s,i),v=v.nextSibling,g=g.nextSibling}function dt(t,e,s){const i=s.getId(t),r=s.getMeta(t);let o=null;if(i>-1&&(o=e.getNode(i)),o!==null&&Yt(o,t))return o;switch(t.RRNodeType){case k.Document:o=new Document;break;case k.DocumentType:o=document.implementation.createDocumentType(t.name,t.publicId,t.systemId);break;case k.Element:{let a=t.tagName.toLowerCase();a=Yr[a]||a,r&&"isSVG"in r&&(r!=null&&r.isSVG)?o=document.createElementNS(Mt.svg,a):o=document.createElement(t.tagName);break}case k.Text:o=document.createTextNode(t.data);break;case k.Comment:o=document.createComment(t.data);break;case k.CDATA:o=document.createCDATASection(t.data);break}r&&e.add(o,G({},r));try{de==null||de.add(o)}catch(a){}return o}function Yt(t,e){return t.nodeType!==e.nodeType?!1:t.nodeType!==t.ELEMENT_NODE||t.tagName.toUpperCase()===e.tagName}function Re(t,e,s,i){const r=s.getId(t),o=i.getId(e);return r===-1||r!==o?!1:Yt(t,e)}class We extends Bt{constructor(e){super(),w(this,"UNSERIALIZED_STARTING_ID",-2),w(this,"_unserializedId",this.UNSERIALIZED_STARTING_ID),w(this,"mirror",rn()),w(this,"scrollData",null),e&&(this.mirror=e)}get unserializedId(){return this._unserializedId--}createDocument(e,s,i){return new We}createDocumentType(e,s,i){const r=new Zr(e,s,i);return r.ownerDocument=this,r}createElement(e){const s=e.toUpperCase();let i;switch(s){case"AUDIO":case"VIDEO":i=new jr(s);break;case"IFRAME":i=new Kr(s,this.mirror);break;case"CANVAS":i=new Jr(s);break;case"STYLE":i=new $r(s);break;default:i=new pt(s);break}return i.ownerDocument=this,i}createComment(e){const s=new qr(e);return s.ownerDocument=this,s}createCDATASection(e){const s=new en(e);return s.ownerDocument=this,s}createTextNode(e){const s=new Qr(e);return s.ownerDocument=this,s}destroyTree(){this.firstChild=null,this.lastChild=null,this.mirror.reset()}open(){super.open(),this._unserializedId=this.UNSERIALIZED_STARTING_ID}}const Zr=js;class pt extends Vt{constructor(){super(...arguments),w(this,"inputData",null),w(this,"scrollData",null)}}class jr extends Vr{}class Jr extends pt{constructor(){super(...arguments),w(this,"rr_dataURL",null),w(this,"canvasMutations",[])}getContext(){return null}}class $r extends pt{constructor(){super(...arguments),w(this,"rules",[])}}class Kr extends pt{constructor(e,s){super(e),w(this,"contentDocument",new We),this.contentDocument.mirror=s}}const Qr=Js,qr=$s,en=Ks;function tn(t){return t instanceof HTMLFormElement?"FORM":t.tagName.toUpperCase()}function ti(t,e,s,i){let r;switch(t.nodeType){case ie.DOCUMENT_NODE:i&&i.nodeName==="IFRAME"?r=i.contentDocument:(r=e,r.compatMode=t.compatMode);break;case ie.DOCUMENT_TYPE_NODE:{const a=t;r=e.createDocumentType(a.name,a.publicId,a.systemId);break}case ie.ELEMENT_NODE:{const a=t,n=tn(a);r=e.createElement(n);const c=r;for(const{name:l,value:u}of Array.from(a.attributes))c.attributes[l]=u;a.scrollLeft&&(c.scrollLeft=a.scrollLeft),a.scrollTop&&(c.scrollTop=a.scrollTop);break}case ie.TEXT_NODE:r=e.createTextNode(t.textContent||"");break;case ie.CDATA_SECTION_NODE:r=e.createCDATASection(t.data);break;case ie.COMMENT_NODE:r=e.createComment(t.textContent||"");break;case ie.DOCUMENT_FRAGMENT_NODE:r=i.attachShadow({mode:"open"});break;default:return null}let o=s.getMeta(t);return e instanceof We&&(o||(o=si(r,e.unserializedId),s.add(t,o)),e.mirror.add(r,G({},o))),r}function sn(t,e=Lr(),s=new We){function i(r,o){const a=ti(r,s,e,o);if(a!==null)if((o==null?void 0:o.nodeName)!=="IFRAME"&&r.nodeType!==ie.DOCUMENT_FRAGMENT_NODE&&(o==null||o.appendChild(a),a.parentNode=o,a.parentElement=o),r.nodeName==="IFRAME"){const n=r.contentDocument;n&&i(n,a)}else(r.nodeType===ie.DOCUMENT_NODE||r.nodeType===ie.ELEMENT_NODE||r.nodeType===ie.DOCUMENT_FRAGMENT_NODE)&&(r.nodeType===ie.ELEMENT_NODE&&r.shadowRoot&&i(r.shadowRoot,a),r.childNodes.forEach(n=>i(n,a)))}return i(t,null),s}function rn(){return new nn}class nn{constructor(){w(this,"idNodeMap",new Map),w(this,"nodeMetaMap",new WeakMap)}getId(e){var s;if(!e)return-1;const i=(s=this.getMeta(e))==null?void 0:s.id;return i!=null?i:-1}getNode(e){return this.idNodeMap.get(e)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(e){return this.nodeMetaMap.get(e)||null}removeNodeFromMap(e){const s=this.getId(e);this.idNodeMap.delete(s),e.childNodes&&e.childNodes.forEach(i=>this.removeNodeFromMap(i))}has(e){return this.idNodeMap.has(e)}hasNode(e){return this.nodeMetaMap.has(e)}add(e,s){const i=s.id;this.idNodeMap.set(i,e),this.nodeMetaMap.set(e,s)}replace(e,s){const i=this.getNode(e);if(i){const r=this.nodeMetaMap.get(i);r&&this.nodeMetaMap.set(s,r)}this.idNodeMap.set(e,s)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}}function si(t,e){switch(t.RRNodeType){case k.Document:return{id:e,type:t.RRNodeType,childNodes:[]};case k.DocumentType:{const s=t;return{id:e,type:t.RRNodeType,name:s.name,publicId:s.publicId,systemId:s.systemId}}case k.Element:return{id:e,type:t.RRNodeType,tagName:t.tagName.toLowerCase(),attributes:{},childNodes:[]};case k.Text:return{id:e,type:t.RRNodeType,textContent:t.textContent||""};case k.Comment:return{id:e,type:t.RRNodeType,textContent:t.textContent||""};case k.CDATA:return{id:e,type:t.RRNodeType,textContent:""}}}function ii(t){return{all:t=t||new Map,on:function(e,s){var i=t.get(e);i?i.push(s):t.set(e,[s])},off:function(e,s){var i=t.get(e);i&&(s?i.splice(i.indexOf(s)>>>0,1):t.set(e,[]))},emit:function(e,s){var i=t.get(e);i&&i.slice().map(function(r){r(s)}),(i=t.get("*"))&&i.slice().map(function(r){r(e,s)})}}}const on=Object.freeze(Object.defineProperty({__proto__:null,default:ii},Symbol.toStringTag,{value:"Module"}));function an(t=window,e=document){if("scrollBehavior"in e.documentElement.style&&t.__forceSmoothScrollPolyfill__!==!0)return;const s=t.HTMLElement||t.Element,i=468,r={scroll:t.scroll||t.scrollTo,scrollBy:t.scrollBy,elementScroll:s.prototype.scroll||c,scrollIntoView:s.prototype.scrollIntoView},o=t.performance&&t.performance.now?t.performance.now.bind(t.performance):Date.now;function a(g){const S=["MSIE ","Trident/","Edge/"];return new RegExp(S.join("|")).test(g)}const n=a(t.navigator.userAgent)?1:0;function c(g,S){this.scrollLeft=g,this.scrollTop=S}function l(g){return .5*(1-Math.cos(Math.PI*g))}function u(g){if(g===null||typeof g!="object"||g.behavior===void 0||g.behavior==="auto"||g.behavior==="instant")return!0;if(typeof g=="object"&&g.behavior==="smooth")return!1;throw new TypeError("behavior member of ScrollOptions "+g.behavior+" is not a valid value for enumeration ScrollBehavior.")}function d(g,S){if(S==="Y")return g.clientHeight+n<g.scrollHeight;if(S==="X")return g.clientWidth+n<g.scrollWidth}function h(g,S){const y=t.getComputedStyle(g,null)["overflow"+S];return y==="auto"||y==="scroll"}function p(g){const S=d(g,"Y")&&h(g,"Y"),y=d(g,"X")&&h(g,"X");return S||y}function m(g){for(;g!==e.body&&p(g)===!1;)g=g.parentNode||g.host;return g}function f(g){const S=o();let y,I,T,A=(S-g.startTime)/i;A=A>1?1:A,y=l(A),I=g.startX+(g.x-g.startX)*y,T=g.startY+(g.y-g.startY)*y,g.method.call(g.scrollable,I,T),(I!==g.x||T!==g.y)&&t.requestAnimationFrame(f.bind(t,g))}function v(g,S,y){let I,T,A,U;const Y=o();g===e.body?(I=t,T=t.scrollX||t.pageXOffset,A=t.scrollY||t.pageYOffset,U=r.scroll):(I=g,T=g.scrollLeft,A=g.scrollTop,U=c),f({scrollable:I,method:U,startTime:Y,startX:T,startY:A,x:S,y})}t.scroll=t.scrollTo=function(){if(arguments[0]!==void 0){if(u(arguments[0])===!0){r.scroll.call(t,arguments[0].left!==void 0?arguments[0].left:typeof arguments[0]!="object"?arguments[0]:t.scrollX||t.pageXOffset,arguments[0].top!==void 0?arguments[0].top:arguments[1]!==void 0?arguments[1]:t.scrollY||t.pageYOffset);return}v.call(t,e.body,arguments[0].left!==void 0?~~arguments[0].left:t.scrollX||t.pageXOffset,arguments[0].top!==void 0?~~arguments[0].top:t.scrollY||t.pageYOffset)}},t.scrollBy=function(){if(arguments[0]!==void 0){if(u(arguments[0])){r.scrollBy.call(t,arguments[0].left!==void 0?arguments[0].left:typeof arguments[0]!="object"?arguments[0]:0,arguments[0].top!==void 0?arguments[0].top:arguments[1]!==void 0?arguments[1]:0);return}v.call(t,e.body,~~arguments[0].left+(t.scrollX||t.pageXOffset),~~arguments[0].top+(t.scrollY||t.pageYOffset))}},s.prototype.scroll=s.prototype.scrollTo=function(){if(arguments[0]===void 0)return;if(u(arguments[0])===!0){if(typeof arguments[0]=="number"&&arguments[1]===void 0)throw new SyntaxError("Value could not be converted");r.elementScroll.call(this,arguments[0].left!==void 0?~~arguments[0].left:typeof arguments[0]!="object"?~~arguments[0]:this.scrollLeft,arguments[0].top!==void 0?~~arguments[0].top:arguments[1]!==void 0?~~arguments[1]:this.scrollTop);return}const g=arguments[0].left,S=arguments[0].top;v.call(this,this,typeof g=="undefined"?this.scrollLeft:~~g,typeof S=="undefined"?this.scrollTop:~~S)},s.prototype.scrollBy=function(){if(arguments[0]!==void 0){if(u(arguments[0])===!0){r.elementScroll.call(this,arguments[0].left!==void 0?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,arguments[0].top!==void 0?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop);return}this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior})}},s.prototype.scrollIntoView=function(){if(u(arguments[0])===!0){r.scrollIntoView.call(this,arguments[0]===void 0?!0:arguments[0]);return}const g=m(this),S=g.getBoundingClientRect(),y=this.getBoundingClientRect();g!==e.body?(v.call(this,g,g.scrollLeft+y.left-S.left,g.scrollTop+y.top-S.top),t.getComputedStyle(g).position!=="fixed"&&t.scrollBy({left:S.left,top:S.top,behavior:"smooth"})):t.scrollBy({left:y.left,top:y.top,behavior:"smooth"})}}class ln{constructor(e=[],s){b(this,"timeOffset",0),b(this,"speed"),b(this,"actions"),b(this,"raf",null),b(this,"lastTimestamp"),this.actions=e,this.speed=s.speed}addAction(e){const s=this.raf===!0;if(!this.actions.length||this.actions[this.actions.length-1].delay<=e.delay)this.actions.push(e);else{const i=this.findActionIndex(e);this.actions.splice(i,0,e)}s&&(this.raf=requestAnimationFrame(this.rafCheck.bind(this)))}start(){this.timeOffset=0,this.lastTimestamp=performance.now(),this.raf=requestAnimationFrame(this.rafCheck.bind(this))}rafCheck(){const e=performance.now();for(this.timeOffset+=(e-this.lastTimestamp)*this.speed,this.lastTimestamp=e;this.actions.length;){const s=this.actions[0];if(this.timeOffset>=s.delay)this.actions.shift(),s.doAction();else break}this.actions.length>0?this.raf=requestAnimationFrame(this.rafCheck.bind(this)):this.raf=!0}clear(){this.raf&&(this.raf!==!0&&cancelAnimationFrame(this.raf),this.raf=null),this.actions.length=0}setSpeed(e){this.speed=e}isActive(){return this.raf!==null}findActionIndex(e){let s=0,i=this.actions.length-1;for(;s<=i;){const r=Math.floor((s+i)/2);if(this.actions[r].delay<e.delay)s=r+1;else if(this.actions[r].delay>e.delay)i=r-1;else return r+1}return s}}function ms(t,e){if(t.type===E.IncrementalSnapshot&&t.data.source===M.MouseMove&&t.data.positions&&t.data.positions.length){const s=t.data.positions[0].timeOffset,i=t.timestamp+s;return t.delay=i-e,i-e}return t.delay=t.timestamp-e,t.delay}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function gs(t,e){var s=typeof Symbol=="function"&&t[Symbol.iterator];if(!s)return t;var i,r,o=s.call(t),a=[];try{for(;(e===void 0||e-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(n){r={error:n}}finally{try{i&&!i.done&&(s=o.return)&&s.call(o)}finally{if(r)throw r.error}}return a}var Le;(function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"})(Le||(Le={}));var ri={type:"xstate.init"};function yt(t){return t===void 0?[]:[].concat(t)}function Ae(t){return{type:"xstate.assign",assignment:t}}function ys(t,e){return typeof(t=typeof t=="string"&&e&&e[t]?e[t]:t)=="string"?{type:t}:typeof t=="function"?{type:t.name,exec:t}:t}function ht(t){return function(e){return t===e}}function ni(t){return typeof t=="string"?{type:t}:t}function vs(t,e){return{value:t,context:e,actions:[],changed:!1,matches:ht(t)}}function bs(t,e,s){var i=e,r=!1;return[t.filter(function(o){if(o.type==="xstate.assign"){r=!0;var a=Object.assign({},i);return typeof o.assignment=="function"?a=o.assignment(i,s):Object.keys(o.assignment).forEach(function(n){a[n]=typeof o.assignment[n]=="function"?o.assignment[n](i,s):o.assignment[n]}),i=a,!1}return!0}),i,r]}function oi(t,e){e===void 0&&(e={});var s=gs(bs(yt(t.states[t.initial].entry).map(function(a){return ys(a,e.actions)}),t.context,ri),2),i=s[0],r=s[1],o={config:t,_options:e,initialState:{value:t.initial,actions:i,context:r,matches:ht(t.initial)},transition:function(a,n){var c,l,u=typeof a=="string"?{value:a,context:t.context}:a,d=u.value,h=u.context,p=ni(n),m=t.states[d];if(m.on){var f=yt(m.on[p.type]);try{for(var v=function(V){var he=typeof Symbol=="function"&&Symbol.iterator,le=he&&V[he],Ie=0;if(le)return le.call(V);if(V&&typeof V.length=="number")return{next:function(){return V&&Ie>=V.length&&(V=void 0),{value:V&&V[Ie++],done:!V}}};throw new TypeError(he?"Object is not iterable.":"Symbol.iterator is not defined.")}(f),g=v.next();!g.done;g=v.next()){var S=g.value;if(S===void 0)return vs(d,h);var y=typeof S=="string"?{target:S}:S,I=y.target,T=y.actions,A=T===void 0?[]:T,U=y.cond,Y=U===void 0?function(){return!0}:U,se=I===void 0,K=I!=null?I:d,Q=t.states[K];if(Y(h,p)){var x=gs(bs((se?yt(A):[].concat(m.exit,A,Q.entry).filter(function(V){return V})).map(function(V){return ys(V,o._options.actions)}),h,p),3),re=x[0],Z=x[1],ne=x[2],q=I!=null?I:d;return{value:q,context:Z,actions:re,changed:I!==d||re.length>0||ne,matches:ht(q)}}}}catch(V){c={error:V}}finally{try{g&&!g.done&&(l=v.return)&&l.call(v)}finally{if(c)throw c.error}}}return vs(d,h)}};return o}var Ss=function(t,e){return t.actions.forEach(function(s){var i=s.exec;return i&&i(t.context,e)})};function ai(t){var e=t.initialState,s=Le.NotStarted,i=new Set,r={_machine:t,send:function(o){s===Le.Running&&(e=t.transition(e,o),Ss(e,ni(o)),i.forEach(function(a){return a(e)}))},subscribe:function(o){return i.add(o),o(e),{unsubscribe:function(){return i.delete(o)}}},start:function(o){if(o){var a=typeof o=="object"?o:{context:t.config.context,value:o};e={value:a.value,actions:[],context:a.context,matches:ht(a.value)}}return s=Le.Running,Ss(e,ri),r},stop:function(){return s=Le.Stopped,i.clear(),r},get state(){return e},get status(){return s}};return r}function cn(t,e){for(let s=t.length-1;s>=0;s--){const i=t[s];if(i.type===E.Meta&&i.timestamp<=e)return t.slice(s)}return t}function un(t,{getCastFn:e,applyEventsSynchronously:s,emitter:i}){const r=oi({id:"player",context:t,initial:"paused",states:{playing:{on:{PAUSE:{target:"paused",actions:["pause"]},CAST_EVENT:{target:"playing",actions:"castEvent"},END:{target:"paused",actions:["resetLastPlayedEvent","pause"]},ADD_EVENT:{target:"playing",actions:["addEvent"]}}},paused:{on:{PLAY:{target:"playing",actions:["recordTimeOffset","play"]},CAST_EVENT:{target:"paused",actions:"castEvent"},TO_LIVE:{target:"live",actions:["startLive"]},ADD_EVENT:{target:"paused",actions:["addEvent"]}}},live:{on:{ADD_EVENT:{target:"live",actions:["addEvent"]},CAST_EVENT:{target:"live",actions:["castEvent"]}}}}},{actions:{castEvent:Ae({lastPlayedEvent:(o,a)=>a.type==="CAST_EVENT"?a.payload.event:o.lastPlayedEvent}),recordTimeOffset:Ae((o,a)=>{let n=o.timeOffset;return"payload"in a&&"timeOffset"in a.payload&&(n=a.payload.timeOffset),ue(G({},o),{timeOffset:n,baselineTime:o.events[0].timestamp+n})}),play(o){var a;const{timer:n,events:c,baselineTime:l,lastPlayedEvent:u}=o;n.clear();for(const m of c)ms(m,l);const d=cn(c,l);let h=u==null?void 0:u.timestamp;(u==null?void 0:u.type)===E.IncrementalSnapshot&&u.data.source===M.MouseMove&&(h=u.timestamp+((a=u.data.positions[0])==null?void 0:a.timeOffset)),l<(h||0)&&i.emit(_.PlayBack);const p=new Array;for(const m of d)if(!(h&&h<l&&(m.timestamp<=h||m===u)))if(m.timestamp<l)p.push(m);else{const f=e(m,!1);n.addAction({doAction:()=>{f()},delay:m.delay})}s(p),i.emit(_.Flush),n.start()},pause(o){o.timer.clear()},resetLastPlayedEvent:Ae(o=>ue(G({},o),{lastPlayedEvent:null})),startLive:Ae({baselineTime:(o,a)=>(o.timer.start(),a.type==="TO_LIVE"&&a.payload.baselineTime?a.payload.baselineTime:Date.now())}),addEvent:Ae((o,a)=>{const{baselineTime:n,timer:c,events:l}=o;if(a.type==="ADD_EVENT"){const{event:u}=a.payload;ms(u,n);let d=l.length-1;if(!l[d]||l[d].timestamp<=u.timestamp)l.push(u);else{let m=-1,f=0;for(;f<=d;){const v=Math.floor((f+d)/2);l[v].timestamp<=u.timestamp?f=v+1:d=v-1}m===-1&&(m=f),l.splice(m,0,u)}const h=u.timestamp<n,p=e(u,h);h?p():c.isActive()&&c.addAction({doAction:()=>{p()},delay:u.delay})}return ue(G({},o),{events:l})})}});return ai(r)}function dn(t){const e=oi({id:"speed",context:t,initial:"normal",states:{normal:{on:{FAST_FORWARD:{target:"skipping",actions:["recordSpeed","setSpeed"]},SET_SPEED:{target:"normal",actions:["setSpeed"]}}},skipping:{on:{BACK_TO_NORMAL:{target:"normal",actions:["restoreSpeed"]},SET_SPEED:{target:"normal",actions:["setSpeed"]}}}}},{actions:{setSpeed:(s,i)=>{"payload"in i&&s.timer.setSpeed(i.payload.speed)},recordSpeed:Ae({normalSpeed:s=>s.timer.speed}),restoreSpeed:s=>{s.timer.setSpeed(s.normalSpeed)}}});return ai(e)}const hn=t=>[`.${t} { background: currentColor }`,"noscript { display: none !important; }"],Cs=new Map;function li(t,e){let s=Cs.get(t);return s||(s=new Map,Cs.set(t,s)),s.has(e)||s.set(e,[]),s.get(e)}function be(t,e,s){return async i=>{if(i&&typeof i=="object"&&"rr_type"in i)if(s&&(s.isUnchanged=!1),i.rr_type==="ImageBitmap"&&"args"in i){const r=await be(t,e,s)(i.args);return await createImageBitmap.apply(null,r)}else if("index"in i){if(s||e===null)return i;const{rr_type:r,index:o}=i;return li(e,r)[o]}else if("args"in i){const{rr_type:r,args:o}=i,a=window[r];return new a(...await Promise.all(o.map(be(t,e,s))))}else{if("base64"in i)return Sr(i.base64);if("src"in i){const r=t.get(i.src);if(r)return r;{const o=new Image;return o.src=i.src,t.set(i.src,o),o}}else if("data"in i&&i.rr_type==="Blob"){const r=await Promise.all(i.data.map(be(t,e,s)));return new Blob(r,{type:i.type})}}else if(Array.isArray(i))return await Promise.all(i.map(be(t,e,s)));return i}}function fn(t,e){try{return e===pe.WebGL?t.getContext("webgl")||t.getContext("experimental-webgl"):t.getContext("webgl2")}catch(s){return null}}const pn=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject"];function mn(t,e){if(!(e!=null&&e.constructor))return;const{name:s}=e.constructor;if(!pn.includes(s))return;const i=li(t,s);i.includes(e)||i.push(e)}async function gn({mutation:t,target:e,type:s,imageMap:i,errorHandler:r}){try{const o=fn(e,s);if(!o)return;if(t.setter){o[t.property]=t.args[0];return}const a=o[t.property],n=await Promise.all(t.args.map(be(i,o))),c=a.apply(o,n);mn(o,c);const l=!1}catch(o){r(t,o)}}async function yn({event:t,mutations:e,target:s,imageMap:i,errorHandler:r}){const o=s.getContext("2d");if(!o){r(e[0],new Error("Canvas context is null"));return}const a=e.map(async c=>Promise.all(c.args.map(be(i,o))));(await Promise.all(a)).forEach((c,l)=>{const u=e[l];try{if(u.setter){o[u.property]=u.args[0];return}const d=o[u.property];u.property==="drawImage"&&typeof u.args[0]=="string"?(i.get(t),d.apply(o,u.args)):d.apply(o,c)}catch(d){r(u,d)}})}async function wt({event:t,mutation:e,target:s,imageMap:i,canvasEventMap:r,errorHandler:o}){try{const a=r.get(t)||e,n="commands"in a?a.commands:[a];if([pe.WebGL,pe.WebGL2].includes(e.type)){for(let c=0;c<n.length;c++){const l=n[c];await gn({mutation:l,type:e.type,target:s,imageMap:i,errorHandler:o})}return}await yn({event:t,mutations:n,target:s,imageMap:i,errorHandler:o})}catch(a){o(e,a)}}class vn{constructor(e){b(this,"mediaMap",new Map),b(this,"warn"),b(this,"service"),b(this,"speedService"),b(this,"emitter"),b(this,"getCurrentTime"),b(this,"metadataCallbackMap",new Map),this.warn=e.warn,this.service=e.service,this.speedService=e.speedService,this.emitter=e.emitter,this.getCurrentTime=e.getCurrentTime,this.emitter.on(_.Start,this.start.bind(this)),this.emitter.on(_.SkipStart,this.start.bind(this)),this.emitter.on(_.Pause,this.pause.bind(this)),this.emitter.on(_.Finish,this.pause.bind(this)),this.speedService.subscribe(()=>{this.syncAllMediaElements()})}syncAllMediaElements(e={pause:!1}){this.mediaMap.forEach((s,i)=>{this.syncTargetWithState(i),e.pause&&i.pause()})}start(){this.syncAllMediaElements()}pause(){this.syncAllMediaElements({pause:!0})}seekTo({time:e,target:s,mediaState:i}){if(i.isPlaying){const o=(e-i.lastInteractionTimeOffset)/1e3*i.playbackRate,a="duration"in s&&s.duration;if(Number.isNaN(a)){this.waitForMetadata(s);return}let n=i.currentTimeAtLastInteraction+o;s.loop&&a!==!1&&(n=n%a),s.currentTime=n}else s.pause(),s.currentTime=i.currentTimeAtLastInteraction}waitForMetadata(e){if(this.metadataCallbackMap.has(e)||!("addEventListener"in e))return;const s=()=>{this.metadataCallbackMap.delete(e);const i=this.mediaMap.get(e);i&&this.seekTo({time:this.getCurrentTime(),target:e,mediaState:i})};this.metadataCallbackMap.set(e,s),e.addEventListener("loadedmetadata",s,{once:!0})}getMediaStateFromMutation({target:e,timeOffset:s,mutation:i}){var p,m,f,v,g;const r=this.mediaMap.get(e),{type:o,playbackRate:a,currentTime:n,muted:c,volume:l,loop:u}=i;return{isPlaying:o===ye.Play||o!==ye.Pause&&((r==null?void 0:r.isPlaying)||e.getAttribute("autoplay")!==null),currentTimeAtLastInteraction:(p=n!=null?n:r==null?void 0:r.currentTimeAtLastInteraction)!=null?p:0,lastInteractionTimeOffset:s,playbackRate:(m=a!=null?a:r==null?void 0:r.playbackRate)!=null?m:1,volume:(f=l!=null?l:r==null?void 0:r.volume)!=null?f:1,muted:(v=c!=null?c:r==null?void 0:r.muted)!=null?v:e.getAttribute("muted")===null,loop:(g=u!=null?u:r==null?void 0:r.loop)!=null?g:e.getAttribute("loop")===null}}syncTargetWithState(e){const s=this.mediaMap.get(e);if(!s)return;const{muted:i,loop:r,volume:o,isPlaying:a}=s,n=this.service.state.matches("paused"),c=s.playbackRate*this.speedService.state.context.timer.speed;try{this.seekTo({time:this.getCurrentTime(),target:e,mediaState:s}),e.volume!==o&&(e.volume=o),e.muted=i,e.loop=r,e.playbackRate!==c&&(e.playbackRate=c),a&&!n?e.play():e.pause()}catch(l){this.warn(`Failed to replay media interactions: ${l.message||l}`)}}addMediaElements(e,s,i){if(!["AUDIO","VIDEO"].includes(e.nodeName))return;const r=e,o=i.getMeta(r);if(!o||!("attributes"in o))return;const a=this.service.state.matches("paused"),n=o.attributes;let c=!1;n.rr_mediaState?c=n.rr_mediaState==="played":c=r.getAttribute("autoplay")!==null,c&&a&&r.pause();let l=1;typeof n.rr_mediaPlaybackRate=="number"&&(l=n.rr_mediaPlaybackRate);let u=!1;typeof n.rr_mediaMuted=="boolean"?u=n.rr_mediaMuted:u=r.getAttribute("muted")!==null;let d=!1;typeof n.rr_mediaLoop=="boolean"?d=n.rr_mediaLoop:d=r.getAttribute("loop")!==null;let h=1;typeof n.rr_mediaVolume=="number"&&(h=n.rr_mediaVolume);let p=0;typeof n.rr_mediaCurrentTime=="number"&&(p=n.rr_mediaCurrentTime),this.mediaMap.set(r,{isPlaying:c,currentTimeAtLastInteraction:p,lastInteractionTimeOffset:s,playbackRate:l,volume:h,muted:u,loop:d}),this.syncTargetWithState(r)}mediaMutation({target:e,timeOffset:s,mutation:i}){this.mediaMap.set(e,this.getMediaStateFromMutation({target:e,timeOffset:s,mutation:i})),this.syncTargetWithState(e)}isSupportedMediaElement(e){return["AUDIO","VIDEO"].includes(e.nodeName)}reset(){this.mediaMap.clear()}}const bn=5*1e3,Sn=ii||on,Is="[replayer]",vt={duration:500,lineCap:"round",lineWidth:3,strokeStyle:"red"};function Ms(t){return t.type==E.IncrementalSnapshot&&(t.data.source==M.TouchMove||t.data.source==M.MouseInteraction&&t.data.type==L.TouchStart)}class Cn{constructor(e,s){if(b(this,"wrapper"),b(this,"iframe"),b(this,"service"),b(this,"speedService"),b(this,"config"),b(this,"usingVirtualDom",!1),b(this,"virtualDom",new We),b(this,"mouse"),b(this,"mouseTail",null),b(this,"tailPositions",[]),b(this,"emitter",Sn()),b(this,"nextUserInteractionEvent"),b(this,"legacy_missingNodeRetryMap",{}),b(this,"cache",ss()),b(this,"imageMap",new Map),b(this,"canvasEventMap",new Map),b(this,"mirror",Es()),b(this,"styleMirror",new Pt),b(this,"mediaManager"),b(this,"firstFullSnapshot",null),b(this,"newDocumentQueue",[]),b(this,"mousePos",null),b(this,"touchActive",null),b(this,"lastMouseDownEvent",null),b(this,"lastHoveredRootNode"),b(this,"lastSelectionData",null),b(this,"constructedStyleMutations",[]),b(this,"adoptedStyleSheets",[]),b(this,"handleResize",n=>{this.iframe.style.display="inherit";for(const c of[this.mouseTail,this.iframe])c&&(c.setAttribute("width",String(n.width)),c.setAttribute("height",String(n.height)))}),b(this,"applyEventsSynchronously",n=>{for(const c of n){switch(c.type){case E.DomContentLoaded:case E.Load:case E.Custom:continue;case E.FullSnapshot:case E.Meta:case E.Plugin:case E.IncrementalSnapshot:break}this.getCastFn(c,!0)()}}),b(this,"getCastFn",(n,c=!1)=>{let l;switch(n.type){case E.DomContentLoaded:case E.Load:break;case E.Custom:l=()=>{this.emitter.emit(_.CustomEvent,n)};break;case E.Meta:l=()=>this.emitter.emit(_.Resize,{width:n.data.width,height:n.data.height});break;case E.FullSnapshot:l=()=>{var d;if(this.firstFullSnapshot){if(this.firstFullSnapshot===n){this.firstFullSnapshot=!0;return}}else this.firstFullSnapshot=!0;this.mediaManager.reset(),this.styleMirror.reset(),this.rebuildFullSnapshot(n,c),(d=this.iframe.contentWindow)==null||d.scrollTo(n.data.initialOffset)};break;case E.IncrementalSnapshot:l=()=>{if(this.applyIncremental(n,c),!c&&(n===this.nextUserInteractionEvent&&(this.nextUserInteractionEvent=null,this.backToNormal()),this.config.skipInactive&&!this.nextUserInteractionEvent)){for(const d of this.service.state.context.events)if(!(d.timestamp<=n.timestamp)&&this.isUserInteraction(d)){d.delay-n.delay>this.config.inactivePeriodThreshold*this.speedService.state.context.timer.speed&&(this.nextUserInteractionEvent=d);break}if(this.nextUserInteractionEvent){const d=this.nextUserInteractionEvent.delay-n.delay,h={speed:Math.min(Math.round(d/bn),this.config.maxSpeed)};this.speedService.send({type:"FAST_FORWARD",payload:h}),this.emitter.emit(_.SkipStart,h)}}};break}return()=>{l&&l();for(const h of this.config.plugins||[])h.handler&&h.handler(n,c,{replayer:this});this.service.send({type:"CAST_EVENT",payload:{event:n}});const d=this.service.state.context.events.length-1;if(!this.config.liveMode&&n===this.service.state.context.events[d]){const h=()=>{d<this.service.state.context.events.length-1||(this.backToNormal(),this.service.send("END"),this.emitter.emit(_.Finish))};let p=50;n.type===E.IncrementalSnapshot&&n.data.source===M.MouseMove&&n.data.positions.length&&(p+=Math.max(0,-n.data.positions[0].timeOffset)),setTimeout(h,p)}this.emitter.emit(_.EventCast,n)}}),!(s!=null&&s.liveMode)&&e.length<2)throw new Error("Replayer need at least 2 events.");const i={speed:1,maxSpeed:360,root:document.body,loadTimeout:0,skipInactive:!1,inactivePeriodThreshold:10*1e3,showWarning:!0,showDebug:!1,blockClass:"rr-block",liveMode:!1,insertStyleRules:[],triggerFocus:!0,UNSAFE_replayCanvas:!1,pauseAnimation:!0,mouseTail:vt,useVirtualDom:!0,logger:console};this.config=Object.assign({},i,s),this.handleResize=this.handleResize.bind(this),this.getCastFn=this.getCastFn.bind(this),this.applyEventsSynchronously=this.applyEventsSynchronously.bind(this),this.emitter.on(_.Resize,this.handleResize),this.setupDom();for(const n of this.config.plugins||[])n.getMirror&&n.getMirror({nodeMirror:this.mirror});this.emitter.on(_.Flush,()=>{if(this.usingVirtualDom){const n={mirror:this.mirror,applyCanvas:(c,l,u)=>{wt({event:c,mutation:l,target:u,imageMap:this.imageMap,canvasEventMap:this.canvasEventMap,errorHandler:this.warnCanvasMutationFailed.bind(this)})},applyInput:this.applyInput.bind(this),applyScroll:this.applyScroll.bind(this),applyStyleSheetMutation:(c,l)=>{c.source===M.StyleSheetRule?this.applyStyleSheetRule(c,l):c.source===M.StyleDeclaration&&this.applyStyleDeclaration(c,l)},afterAppend:(c,l)=>{for(const u of this.config.plugins||[])u.onBuild&&u.onBuild(c,{id:l,replayer:this})}};if(this.iframe.contentDocument)try{ut(this.iframe.contentDocument,this.virtualDom,n,this.virtualDom.mirror)}catch(c){console.warn(c)}if(this.virtualDom.destroyTree(),this.usingVirtualDom=!1,Object.keys(this.legacy_missingNodeRetryMap).length)for(const c in this.legacy_missingNodeRetryMap)try{const l=this.legacy_missingNodeRetryMap[c],u=dt(l.node,this.mirror,this.virtualDom.mirror);ut(u,l.node,n,this.virtualDom.mirror),l.node=u}catch(l){this.warn(l)}this.constructedStyleMutations.forEach(c=>{this.applyStyleSheetMutation(c)}),this.constructedStyleMutations=[],this.adoptedStyleSheets.forEach(c=>{this.applyAdoptedStyleSheet(c)}),this.adoptedStyleSheets=[]}if(this.mousePos&&(this.moveAndHover(this.mousePos.x,this.mousePos.y,this.mousePos.id,!0,this.mousePos.debugData),this.mousePos=null),this.touchActive===!0?this.mouse.classList.add("touch-active"):this.touchActive===!1&&this.mouse.classList.remove("touch-active"),this.touchActive=null,this.lastMouseDownEvent){const[n,c]=this.lastMouseDownEvent;n.dispatchEvent(c)}this.lastMouseDownEvent=null,this.lastSelectionData&&(this.applySelection(this.lastSelectionData),this.lastSelectionData=null)}),this.emitter.on(_.PlayBack,()=>{this.firstFullSnapshot=null,this.mirror.reset(),this.styleMirror.reset(),this.mediaManager.reset()});const r=new ln([],{speed:this.config.speed});this.service=un({events:e.map(n=>s&&s.unpackFn?s.unpackFn(n):n).sort((n,c)=>n.timestamp-c.timestamp),timer:r,timeOffset:0,baselineTime:0,lastPlayedEvent:null},{getCastFn:this.getCastFn,applyEventsSynchronously:this.applyEventsSynchronously,emitter:this.emitter}),this.service.start(),this.service.subscribe(n=>{this.emitter.emit(_.StateChange,{player:n})}),this.speedService=dn({normalSpeed:-1,timer:r}),this.speedService.start(),this.speedService.subscribe(n=>{this.emitter.emit(_.StateChange,{speed:n})}),this.mediaManager=new vn({warn:this.warn.bind(this),service:this.service,speedService:this.speedService,emitter:this.emitter,getCurrentTime:this.getCurrentTime.bind(this)});const o=this.service.state.context.events.find(n=>n.type===E.Meta),a=this.service.state.context.events.find(n=>n.type===E.FullSnapshot);if(o){const{width:n,height:c}=o.data;setTimeout(()=>{this.emitter.emit(_.Resize,{width:n,height:c})},0)}a&&setTimeout(()=>{var n;this.firstFullSnapshot||(this.firstFullSnapshot=a,this.rebuildFullSnapshot(a),(n=this.iframe.contentWindow)==null||n.scrollTo(a.data.initialOffset))},1),this.service.state.context.events.find(Ms)&&this.mouse.classList.add("touch-device")}get timer(){return this.service.state.context.timer}on(e,s){return this.emitter.on(e,s),this}off(e,s){return this.emitter.off(e,s),this}setConfig(e){Object.keys(e).forEach(s=>{e[s],this.config[s]=e[s]}),this.config.skipInactive||this.backToNormal(),typeof e.speed!="undefined"&&this.speedService.send({type:"SET_SPEED",payload:{speed:e.speed}}),typeof e.mouseTail!="undefined"&&(e.mouseTail===!1?this.mouseTail&&(this.mouseTail.style.display="none"):(this.mouseTail||(this.mouseTail=document.createElement("canvas"),this.mouseTail.width=Number.parseFloat(this.iframe.width),this.mouseTail.height=Number.parseFloat(this.iframe.height),this.mouseTail.classList.add("replayer-mouse-tail"),this.wrapper.insertBefore(this.mouseTail,this.iframe)),this.mouseTail.style.display="inherit"))}getMetaData(){const e=this.service.state.context.events[0],s=this.service.state.context.events[this.service.state.context.events.length-1];return{startTime:e.timestamp,endTime:s.timestamp,totalTime:s.timestamp-e.timestamp}}getCurrentTime(){return this.timer.timeOffset+this.getTimeOffset()}getTimeOffset(){const{baselineTime:e,events:s}=this.service.state.context;return e-s[0].timestamp}getMirror(){return this.mirror}play(e=0){var s,i;this.service.state.matches("paused")?this.service.send({type:"PLAY",payload:{timeOffset:e}}):(this.service.send({type:"PAUSE"}),this.service.send({type:"PLAY",payload:{timeOffset:e}})),(i=(s=this.iframe.contentDocument)==null?void 0:s.getElementsByTagName("html")[0])==null||i.classList.remove("rrweb-paused"),this.emitter.emit(_.Start)}pause(e){var s,i;e===void 0&&this.service.state.matches("playing")&&this.service.send({type:"PAUSE"}),typeof e=="number"&&(this.play(e),this.service.send({type:"PAUSE"})),(i=(s=this.iframe.contentDocument)==null?void 0:s.getElementsByTagName("html")[0])==null||i.classList.add("rrweb-paused"),this.emitter.emit(_.Pause)}resume(e=0){this.warn("The 'resume' was deprecated in 1.0. Please use 'play' method which has the same interface."),this.play(e),this.emitter.emit(_.Resume)}destroy(){this.pause(),this.mirror.reset(),this.styleMirror.reset(),this.mediaManager.reset(),this.config.root.removeChild(this.wrapper),this.emitter.emit(_.Destroy)}startLive(e){this.service.send({type:"TO_LIVE",payload:{baselineTime:e}})}addEvent(e){const s=this.config.unpackFn?this.config.unpackFn(e):e;Ms(s)&&this.mouse.classList.add("touch-device"),Promise.resolve().then(()=>this.service.send({type:"ADD_EVENT",payload:{event:s}}))}enableInteract(){this.iframe.setAttribute("scrolling","auto"),this.iframe.style.pointerEvents="auto"}disableInteract(){this.iframe.setAttribute("scrolling","no"),this.iframe.style.pointerEvents="none"}resetCache(){this.cache=ss()}setupDom(){this.wrapper=document.createElement("div"),this.wrapper.classList.add("replayer-wrapper"),this.config.root.appendChild(this.wrapper),this.mouse=document.createElement("div"),this.mouse.classList.add("replayer-mouse"),this.wrapper.appendChild(this.mouse),this.config.mouseTail!==!1&&(this.mouseTail=document.createElement("canvas"),this.mouseTail.classList.add("replayer-mouse-tail"),this.mouseTail.style.display="inherit",this.wrapper.appendChild(this.mouseTail)),this.iframe=document.createElement("iframe");const e=["allow-same-origin"];this.config.UNSAFE_replayCanvas&&e.push("allow-scripts"),this.iframe.style.display="none",this.iframe.setAttribute("sandbox",e.join(" ")),this.disableInteract(),this.wrapper.appendChild(this.iframe),this.iframe.contentWindow&&this.iframe.contentDocument&&(an(this.iframe.contentWindow,this.iframe.contentDocument),Ot(this.iframe.contentWindow))}rebuildFullSnapshot(e,s=!1){if(!this.iframe.contentDocument)return this.warn("Looks like your replayer has been destroyed.");Object.keys(this.legacy_missingNodeRetryMap).length&&this.warn("Found unresolved missing node map",this.legacy_missingNodeRetryMap),this.legacy_missingNodeRetryMap={};const i=[],r=(n,c)=>{if(this.collectIframeAndAttachDocument(i,n),this.mediaManager.isSupportedMediaElement(n)){const{events:l}=this.service.state.context;this.mediaManager.addMediaElements(n,e.timestamp-l[0].timestamp,this.mirror)}for(const l of this.config.plugins||[])l.onBuild&&l.onBuild(n,{id:c,replayer:this})};this.usingVirtualDom&&(this.virtualDom.destroyTree(),this.usingVirtualDom=!1),this.mirror.reset(),Ki(e.data.node,{doc:this.iframe.contentDocument,afterAppend:r,cache:this.cache,mirror:this.mirror}),r(this.iframe.contentDocument,e.data.node.id);for(const{mutationInQueue:n,builtNode:c}of i)this.attachDocumentToIframe(n,c),this.newDocumentQueue=this.newDocumentQueue.filter(l=>l!==n);const{documentElement:o,head:a}=this.iframe.contentDocument;this.insertStyleRules(o,a),this.service.state.matches("playing")||this.iframe.contentDocument.getElementsByTagName("html")[0].classList.add("rrweb-paused"),this.emitter.emit(_.FullsnapshotRebuilded,e),s||this.waitForStylesheetLoad(),this.config.UNSAFE_replayCanvas&&this.preloadAllImages()}insertStyleRules(e,s){var i;const r=hn(this.config.blockClass).concat(this.config.insertStyleRules);if(this.config.pauseAnimation&&r.push("html.rrweb-paused *, html.rrweb-paused *:before, html.rrweb-paused *:after { animation-play-state: paused !important; }"),this.usingVirtualDom){const o=this.virtualDom.createElement("style");this.virtualDom.mirror.add(o,si(o,this.virtualDom.unserializedId)),e.insertBefore(o,s),o.rules.push({source:M.StyleSheetRule,adds:r.map((a,n)=>({rule:a,index:n}))})}else{const o=document.createElement("style");e.insertBefore(o,s);for(let a=0;a<r.length;a++)(i=o.sheet)==null||i.insertRule(r[a],a)}}attachDocumentToIframe(e,s){const i=this.usingVirtualDom?this.virtualDom.mirror:this.mirror,r=[],o=(a,n)=>{this.collectIframeAndAttachDocument(r,a);const c=i.getMeta(a);if((c==null?void 0:c.type)===D.Element&&(c==null?void 0:c.tagName.toUpperCase())==="HTML"){const{documentElement:l,head:u}=s.contentDocument;this.insertStyleRules(l,u)}if(!this.usingVirtualDom)for(const l of this.config.plugins||[])l.onBuild&&l.onBuild(a,{id:n,replayer:this})};He(e.node,{doc:s.contentDocument,mirror:i,hackCss:!0,skipChild:!1,afterAppend:o,cache:this.cache}),o(s.contentDocument,e.node.id);for(const{mutationInQueue:a,builtNode:n}of r)this.attachDocumentToIframe(a,n),this.newDocumentQueue=this.newDocumentQueue.filter(c=>c!==a)}collectIframeAndAttachDocument(e,s){if(Fe(s,this.mirror)){const i=this.newDocumentQueue.find(r=>r.parentId===this.mirror.getId(s));i&&e.push({mutationInQueue:i,builtNode:s})}}waitForStylesheetLoad(){var e;const s=(e=this.iframe.contentDocument)==null?void 0:e.head;if(s){const i=new Set;let r,o=this.service.state;const a=()=>{o=this.service.state};this.emitter.on(_.Start,a),this.emitter.on(_.Pause,a);const n=()=>{this.emitter.off(_.Start,a),this.emitter.off(_.Pause,a)};s.querySelectorAll('link[rel="stylesheet"]').forEach(c=>{c.sheet||(i.add(c),c.addEventListener("load",()=>{i.delete(c),i.size===0&&r!==-1&&(o.matches("playing")&&this.play(this.getCurrentTime()),this.emitter.emit(_.LoadStylesheetEnd),r&&clearTimeout(r),n())}))}),i.size>0&&(this.service.send({type:"PAUSE"}),this.emitter.emit(_.LoadStylesheetStart),r=setTimeout(()=>{o.matches("playing")&&this.play(this.getCurrentTime()),r=-1,n()},this.config.loadTimeout))}}async preloadAllImages(){const e=[];for(const s of this.service.state.context.events)s.type===E.IncrementalSnapshot&&s.data.source===M.CanvasMutation&&(e.push(this.deserializeAndPreloadCanvasEvents(s.data,s)),("commands"in s.data?s.data.commands:[s.data]).forEach(r=>{this.preloadImages(r,s)}));return Promise.all(e)}preloadImages(e,s){if(e.property==="drawImage"&&typeof e.args[0]=="string"&&!this.imageMap.has(s)){const i=document.createElement("canvas"),r=i.getContext("2d"),o=r==null?void 0:r.createImageData(i.width,i.height);r==null||r.putImageData(o,0,0)}}async deserializeAndPreloadCanvasEvents(e,s){if(!this.canvasEventMap.has(s)){const i={isUnchanged:!0};if("commands"in e){const r=await Promise.all(e.commands.map(async o=>{const a=await Promise.all(o.args.map(be(this.imageMap,null,i)));return ue(G({},o),{args:a})}));i.isUnchanged===!1&&this.canvasEventMap.set(s,ue(G({},e),{commands:r}))}else{const r=await Promise.all(e.args.map(be(this.imageMap,null,i)));i.isUnchanged===!1&&this.canvasEventMap.set(s,ue(G({},e),{args:r}))}}}applyIncremental(e,s){var i,r,o;const{data:a}=e;switch(a.source){case M.Mutation:{try{this.applyMutation(a,s)}catch(n){this.warn(`Exception in mutation ${n.message||n}`,a)}break}case M.Drag:case M.TouchMove:case M.MouseMove:if(s){const n=a.positions[a.positions.length-1];this.mousePos={x:n.x,y:n.y,id:n.id,debugData:a}}else a.positions.forEach(n=>{const c={doAction:()=>{this.moveAndHover(n.x,n.y,n.id,s,a)},delay:n.timeOffset+e.timestamp-this.service.state.context.baselineTime};this.timer.addAction(c)}),this.timer.addAction({doAction(){},delay:e.delay-((i=a.positions[0])==null?void 0:i.timeOffset)});break;case M.MouseInteraction:{if(a.id===-1)break;const n=new Event(Se(L[a.type])),c=this.mirror.getNode(a.id);if(!c)return this.debugNodeNotFound(a,a.id);this.emitter.emit(_.MouseInteraction,{type:a.type,target:c});const{triggerFocus:l}=this.config;switch(a.type){case L.Blur:"blur"in c&&c.blur();break;case L.Focus:l&&c.focus&&c.focus({preventScroll:!0});break;case L.Click:case L.TouchStart:case L.TouchEnd:case L.MouseDown:case L.MouseUp:s?(a.type===L.TouchStart?this.touchActive=!0:a.type===L.TouchEnd&&(this.touchActive=!1),a.type===L.MouseDown?this.lastMouseDownEvent=[c,n]:a.type===L.MouseUp&&(this.lastMouseDownEvent=null),this.mousePos={x:a.x||0,y:a.y||0,id:a.id,debugData:a}):(a.type===L.TouchStart&&(this.tailPositions.length=0),this.moveAndHover(a.x||0,a.y||0,a.id,s,a),a.type===L.Click?(this.mouse.classList.remove("active"),this.mouse.offsetWidth,this.mouse.classList.add("active")):a.type===L.TouchStart?(this.mouse.offsetWidth,this.mouse.classList.add("touch-active")):a.type===L.TouchEnd?this.mouse.classList.remove("touch-active"):c.dispatchEvent(n));break;case L.TouchCancel:s?this.touchActive=!1:this.mouse.classList.remove("touch-active");break;default:c.dispatchEvent(n)}break}case M.Scroll:{if(a.id===-1)break;if(this.usingVirtualDom){const n=this.virtualDom.mirror.getNode(a.id);if(!n)return this.debugNodeNotFound(a,a.id);n.scrollData=a;break}this.applyScroll(a,s);break}case M.ViewportResize:this.emitter.emit(_.Resize,{width:a.width,height:a.height});break;case M.Input:{if(a.id===-1)break;if(this.usingVirtualDom){const n=this.virtualDom.mirror.getNode(a.id);if(!n)return this.debugNodeNotFound(a,a.id);n.inputData=a;break}this.applyInput(a);break}case M.MediaInteraction:{const n=this.usingVirtualDom?this.virtualDom.mirror.getNode(a.id):this.mirror.getNode(a.id);if(!n)return this.debugNodeNotFound(a,a.id);const c=n,{events:l}=this.service.state.context;this.mediaManager.mediaMutation({target:c,timeOffset:e.timestamp-l[0].timestamp,mutation:a});break}case M.StyleSheetRule:case M.StyleDeclaration:{this.usingVirtualDom?a.styleId?this.constructedStyleMutations.push(a):a.id&&((r=this.virtualDom.mirror.getNode(a.id))==null||r.rules.push(a)):this.applyStyleSheetMutation(a);break}case M.CanvasMutation:{if(!this.config.UNSAFE_replayCanvas)return;if(this.usingVirtualDom){const n=this.virtualDom.mirror.getNode(a.id);if(!n)return this.debugNodeNotFound(a,a.id);n.canvasMutations.push({event:e,mutation:a})}else{const n=this.mirror.getNode(a.id);if(!n)return this.debugNodeNotFound(a,a.id);wt({event:e,mutation:a,target:n,imageMap:this.imageMap,canvasEventMap:this.canvasEventMap,errorHandler:this.warnCanvasMutationFailed.bind(this)})}break}case M.Font:{try{const n=new FontFace(a.family,a.buffer?new Uint8Array(JSON.parse(a.fontSource)):a.fontSource,a.descriptors);(o=this.iframe.contentDocument)==null||o.fonts.add(n)}catch(n){this.warn(n)}break}case M.Selection:{if(s){this.lastSelectionData=a;break}this.applySelection(a);break}case M.AdoptedStyleSheet:{this.usingVirtualDom?this.adoptedStyleSheets.push(a):this.applyAdoptedStyleSheet(a);break}}}applyMutation(e,s){if(this.config.useVirtualDom&&!this.usingVirtualDom&&s&&(this.usingVirtualDom=!0,sn(this.iframe.contentDocument,this.mirror,this.virtualDom),Object.keys(this.legacy_missingNodeRetryMap).length))for(const l in this.legacy_missingNodeRetryMap)try{const u=this.legacy_missingNodeRetryMap[l],d=ti(u.node,this.virtualDom,this.mirror);d&&(u.node=d)}catch(u){this.warn(u)}const i=this.usingVirtualDom?this.virtualDom.mirror:this.mirror;e.removes=e.removes.filter(l=>i.getNode(l.id)?!0:(this.warnNodeNotFound(e,l.id),!1)),e.removes.forEach(l=>{var u;const d=i.getNode(l.id);if(!d)return;let h=i.getNode(l.parentId);if(!h)return this.warnNodeNotFound(e,l.parentId);if(l.isShadow&&ve(h)&&(h=h.shadowRoot),i.removeNodeFromMap(d),h)try{h.removeChild(d),this.usingVirtualDom&&d.nodeName==="#text"&&h.nodeName==="STYLE"&&((u=h.rules)==null?void 0:u.length)>0&&(h.rules=[])}catch(p){if(p instanceof DOMException)this.warn("parent could not remove child in mutation",h,d,e);else throw p}});const r=G({},this.legacy_missingNodeRetryMap),o=[],a=l=>{let u=null;return l.nextId&&(u=i.getNode(l.nextId)),l.nextId!==null&&l.nextId!==void 0&&l.nextId!==-1&&!u},n=l=>{var u,d;if(!this.iframe.contentDocument)return this.warn("Looks like your replayer has been destroyed.");let h=i.getNode(l.parentId);if(!h)return l.node.type===D.Document?this.newDocumentQueue.push(l):o.push(l);l.node.isShadow&&(ve(h)||h.attachShadow({mode:"open"}),h=h.shadowRoot);let p=null,m=null;if(l.previousId&&(p=i.getNode(l.previousId)),l.nextId&&(m=i.getNode(l.nextId)),a(l))return o.push(l);if(l.node.rootId&&!i.getNode(l.node.rootId))return;const f=l.node.rootId?i.getNode(l.node.rootId):this.usingVirtualDom?this.virtualDom:this.iframe.contentDocument;if(Fe(h,i)){this.attachDocumentToIframe(l,h);return}const v=(y,I)=>{if(!this.usingVirtualDom)for(const T of this.config.plugins||[])T.onBuild&&T.onBuild(y,{id:I,replayer:this})},g=He(l.node,{doc:f,mirror:i,skipChild:!0,hackCss:!0,cache:this.cache,afterAppend:v});if(l.previousId===-1||l.nextId===-1){r[l.node.id]={node:g,mutation:l};return}const S=i.getMeta(h);if(S&&S.type===D.Element&&S.tagName==="textarea"&&l.node.type===D.Text){const y=Array.isArray(h.childNodes)?h.childNodes:Array.from(h.childNodes);for(const I of y)I.nodeType===h.TEXT_NODE&&h.removeChild(I)}else if((S==null?void 0:S.type)===D.Document){const y=h;l.node.type===D.DocumentType&&((u=y.childNodes[0])==null?void 0:u.nodeType)===Node.DOCUMENT_TYPE_NODE&&y.removeChild(y.childNodes[0]),g.nodeName==="HTML"&&y.documentElement&&y.removeChild(y.documentElement)}if(p&&p.nextSibling&&p.nextSibling.parentNode?h.insertBefore(g,p.nextSibling):m&&m.parentNode?h.contains(m)?h.insertBefore(g,m):h.insertBefore(g,null):h.appendChild(g),v(g,l.node.id),this.usingVirtualDom&&g.nodeName==="#text"&&h.nodeName==="STYLE"&&((d=h.rules)==null?void 0:d.length)>0&&(h.rules=[]),Fe(g,this.mirror)){const y=this.mirror.getId(g),I=this.newDocumentQueue.find(T=>T.parentId===y);I&&(this.attachDocumentToIframe(I,g),this.newDocumentQueue=this.newDocumentQueue.filter(T=>T!==I))}(l.previousId||l.nextId)&&this.legacy_resolveMissingNode(r,h,g,l)};e.adds.forEach(l=>{n(l)});const c=Date.now();for(;o.length;){const l=Fs(o);if(o.length=0,Date.now()-c>500){this.warn("Timeout in the loop, please check the resolve tree data:",l);break}for(const u of l)i.getNode(u.value.parentId)?_t(u,h=>{n(h)}):this.debug("Drop resolve tree since there is no parent for the root node.",u)}Object.keys(r).length&&Object.assign(this.legacy_missingNodeRetryMap,r),Ps(e.texts).forEach(l=>{var u;const d=i.getNode(l.id);if(!d)return e.removes.find(h=>h.id===l.id)?void 0:this.warnNodeNotFound(e,l.id);if(d.textContent=l.value,this.usingVirtualDom){const h=d.parentNode;((u=h==null?void 0:h.rules)==null?void 0:u.length)>0&&(h.rules=[])}}),e.attributes.forEach(l=>{var u;const d=i.getNode(l.id);if(!d)return e.removes.find(h=>h.id===l.id)?void 0:this.warnNodeNotFound(e,l.id);for(const h in l.attributes)if(typeof h=="string"){const p=l.attributes[h];if(p===null)d.removeAttribute(h);else if(typeof p=="string")try{if(h==="_cssText"&&(d.nodeName==="LINK"||d.nodeName==="STYLE"))try{const m=i.getMeta(d);Object.assign(m.attributes,l.attributes);const f=He(m,{doc:d.ownerDocument,mirror:i,skipChild:!0,hackCss:!0,cache:this.cache}),v=d.nextSibling,g=d.parentNode;if(f&&g){g.removeChild(d),g.insertBefore(f,v),i.replace(l.id,f);break}}catch(m){}if(h==="value"&&d.nodeName==="TEXTAREA"){const m=d;m.childNodes.forEach(v=>m.removeChild(v));const f=(u=d.ownerDocument)==null?void 0:u.createTextNode(p);f&&m.appendChild(f)}else d.setAttribute(h,p)}catch(m){this.warn("An error occurred may due to the checkout feature.",m)}else if(h==="style"){const m=p,f=d;for(const v in m)if(m[v]===!1)f.style.removeProperty(v);else if(m[v]instanceof Array){const g=m[v];f.style.setProperty(v,g[0],g[1])}else{const g=m[v];f.style.setProperty(v,g)}}}})}applyScroll(e,s){var i,r;const o=this.mirror.getNode(e.id);if(!o)return this.debugNodeNotFound(e,e.id);const a=this.mirror.getMeta(o);if(o===this.iframe.contentDocument)(i=this.iframe.contentWindow)==null||i.scrollTo({top:e.y,left:e.x,behavior:s?"auto":"smooth"});else if((a==null?void 0:a.type)===D.Document)(r=o.defaultView)==null||r.scrollTo({top:e.y,left:e.x,behavior:s?"auto":"smooth"});else try{o.scrollTo({top:e.y,left:e.x,behavior:s?"auto":"smooth"})}catch(n){}}applyInput(e){const s=this.mirror.getNode(e.id);if(!s)return this.debugNodeNotFound(e,e.id);try{s.checked=e.isChecked,s.value=e.text}catch(i){}}applySelection(e){try{const s=new Set,i=e.ranges.map(({start:r,startOffset:o,end:a,endOffset:n})=>{const c=this.mirror.getNode(r),l=this.mirror.getNode(a);if(!c||!l)return;const u=new Range;u.setStart(c,o),u.setEnd(l,n);const d=c.ownerDocument,h=d==null?void 0:d.getSelection();return h&&s.add(h),{range:u,selection:h}});s.forEach(r=>r.removeAllRanges()),i.forEach(r=>{var o;return r&&((o=r.selection)==null?void 0:o.addRange(r.range))})}catch(s){}}applyStyleSheetMutation(e){var s;let i=null;e.styleId?i=this.styleMirror.getStyle(e.styleId):e.id&&(i=((s=this.mirror.getNode(e.id))==null?void 0:s.sheet)||null),i&&(e.source===M.StyleSheetRule?this.applyStyleSheetRule(e,i):e.source===M.StyleDeclaration&&this.applyStyleDeclaration(e,i))}applyStyleSheetRule(e,s){var i,r,o,a;if((i=e.adds)==null||i.forEach(({rule:n,index:c})=>{try{if(Array.isArray(c)){const{positions:l,index:u}=St(c);Oe(s.cssRules,l).insertRule(n,u)}else{const l=c===void 0?void 0:Math.min(c,s.cssRules.length);s==null||s.insertRule(n,l)}}catch(l){}}),(r=e.removes)==null||r.forEach(({index:n})=>{try{if(Array.isArray(n)){const{positions:c,index:l}=St(n);Oe(s.cssRules,c).deleteRule(l||0)}else s==null||s.deleteRule(n)}catch(c){}}),e.replace)try{(o=s.replace)==null||o.call(s,e.replace)}catch(n){}if(e.replaceSync)try{(a=s.replaceSync)==null||a.call(s,e.replaceSync)}catch(n){}}applyStyleDeclaration(e,s){e.set&&Oe(s.rules,e.index).style.setProperty(e.set.property,e.set.value,e.set.priority),e.remove&&Oe(s.rules,e.index).style.removeProperty(e.remove.property)}applyAdoptedStyleSheet(e){var s;const i=this.mirror.getNode(e.id);if(!i)return;(s=e.styles)==null||s.forEach(n=>{var c;let l=null,u=null;if(ve(i)?u=((c=i.ownerDocument)==null?void 0:c.defaultView)||null:i.nodeName==="#document"&&(u=i.defaultView),!!u)try{l=new u.CSSStyleSheet,this.styleMirror.add(l,n.styleId),this.applyStyleSheetRule({source:M.StyleSheetRule,adds:n.rules},l)}catch(d){}});const r=10;let o=0;const a=(n,c)=>{const l=c.map(u=>this.styleMirror.getStyle(u)).filter(u=>u!==null);ve(n)?n.shadowRoot.adoptedStyleSheets=l:n.nodeName==="#document"&&(n.adoptedStyleSheets=l),l.length!==c.length&&o<r&&(setTimeout(()=>a(n,c),0+100*o),o++)};a(i,e.styleIds)}legacy_resolveMissingNode(e,s,i,r){const{previousId:o,nextId:a}=r,n=o&&e[o],c=a&&e[a];if(n){const{node:l,mutation:u}=n;s.insertBefore(l,i),delete e[u.node.id],delete this.legacy_missingNodeRetryMap[u.node.id],(u.previousId||u.nextId)&&this.legacy_resolveMissingNode(e,s,l,u)}if(c){const{node:l,mutation:u}=c;s.insertBefore(l,i.nextSibling),delete e[u.node.id],delete this.legacy_missingNodeRetryMap[u.node.id],(u.previousId||u.nextId)&&this.legacy_resolveMissingNode(e,s,l,u)}}moveAndHover(e,s,i,r,o){const a=this.mirror.getNode(i);if(!a)return this.debugNodeNotFound(o,i);const n=Ft(a,this.iframe),c=e*n.absoluteScale+n.x,l=s*n.absoluteScale+n.y;this.mouse.style.left=`${c}px`,this.mouse.style.top=`${l}px`,r||this.drawMouseTail({x:c,y:l}),this.hoverElements(a)}drawMouseTail(e){if(!this.mouseTail)return;const{lineCap:s,lineWidth:i,strokeStyle:r,duration:o}=this.config.mouseTail===!0?vt:Object.assign({},vt,this.config.mouseTail),a=()=>{if(!this.mouseTail)return;const n=this.mouseTail.getContext("2d");!n||!this.tailPositions.length||(n.clearRect(0,0,this.mouseTail.width,this.mouseTail.height),n.beginPath(),n.lineWidth=i,n.lineCap=s,n.strokeStyle=r,n.moveTo(this.tailPositions[0].x,this.tailPositions[0].y),this.tailPositions.forEach(c=>n.lineTo(c.x,c.y)),n.stroke())};this.tailPositions.push(e),a(),setTimeout(()=>{this.tailPositions=this.tailPositions.filter(n=>n!==e),a()},o/this.speedService.state.context.timer.speed)}hoverElements(e){var s;(s=this.lastHoveredRootNode||this.iframe.contentDocument)==null||s.querySelectorAll(".\\:hover").forEach(r=>{r.classList.remove(":hover")}),this.lastHoveredRootNode=e.getRootNode();let i=e;for(;i;)i.classList&&i.classList.add(":hover"),i=i.parentElement}isUserInteraction(e){return e.type!==E.IncrementalSnapshot?!1:e.data.source>M.Mutation&&e.data.source<=M.Input}backToNormal(){this.nextUserInteractionEvent=null,!this.speedService.state.matches("normal")&&(this.speedService.send({type:"BACK_TO_NORMAL"}),this.emitter.emit(_.SkipEnd,{speed:this.speedService.state.context.normalSpeed}))}warnNodeNotFound(e,s){this.warn(`Node with id '${s}' not found. `,e)}warnCanvasMutationFailed(e,s){this.warn("Has error on canvas update",s,"canvas mutation:",e)}debugNodeNotFound(e,s){this.debug(`Node with id '${s}' not found. `,e)}warn(...e){this.config.showWarning&&this.config.logger.warn(Is,...e)}debug(...e){this.config.showDebug&&this.config.logger.log(Is,...e)}}const{addCustomEvent:In}=Ee,{freezePage:Mn}=Ee;exports.EventType=E;exports.IncrementalSource=M;exports.MouseInteractions=L;exports.Replayer=Cn;exports.ReplayerEvents=_;exports.addCustomEvent=In;exports.canvasMutation=wt;exports.freezePage=Mn;exports.record=Ee;exports.utils=Qi;
if (typeof module.exports == "object" && typeof exports == "object") {
  var __cp = (to, from, except, desc) => {
    if ((from && typeof from === "object") || typeof from === "function") {
      for (let key of Object.getOwnPropertyNames(from)) {
        if (!Object.prototype.hasOwnProperty.call(to, key) && key !== except)
        Object.defineProperty(to, key, {
          get: () => from[key],
          enumerable: !(desc = Object.getOwnPropertyDescriptor(from, key)) || desc.enumerable,
        });
      }
    }
    return to;
  };
  module.exports = __cp(module.exports, exports);
}
return module.exports;
}))
//# sourceMappingURL=rrweb.umd.min.cjs.map
